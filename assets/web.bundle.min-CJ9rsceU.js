var jn=Object.defineProperty;var Dn=(t,e,r)=>e in t?jn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var j=(t,e,r)=>(Dn(t,typeof e!="symbol"?e+"":e,r),r);var Kn=Object.create,Qe=Object.defineProperty,Wn=Object.getOwnPropertyDescriptor,Fn=Object.getOwnPropertyNames,Vn=Object.getPrototypeOf,Gn=Object.prototype.hasOwnProperty,qn=(t,e,r)=>e in t?Qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hn=(t,e)=>()=>(t&&(e=t(t=0)),e),pt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),zn=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Fn(e))!Gn.call(t,a)&&a!==r&&Qe(t,a,{get:()=>e[a],enumerable:!(i=Wn(e,a))||i.enumerable});return t},Lt=(t,e,r)=>(r=t!=null?Kn(Vn(t)):{},zn(e||!t||!t.__esModule?Qe(r,"default",{value:t,enumerable:!0}):r,t)),he=(t,e,r)=>(qn(t,typeof e!="symbol"?e+"":e,r),r),Ur=pt(t=>{at(),t.byteLength=p,t.toByteArray=E,t.fromByteArray=k;var e=[],r=[],i=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(c=0,l=a.length;c<l;++c)e[c]=a[c],r[a.charCodeAt(c)]=c;var c,l;r[45]=62,r[95]=63;function n(b){var U=b.length;if(U%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var C=b.indexOf("=");C===-1&&(C=U);var K=C===U?0:4-C%4;return[C,K]}function p(b){var U=n(b),C=U[0],K=U[1];return(C+K)*3/4-K}function S(b,U,C){return(U+C)*3/4-C}function E(b){var U,C=n(b),K=C[0],z=C[1],x=new i(S(b,K,z)),v=0,w=z>0?K-4:K,u;for(u=0;u<w;u+=4)U=r[b.charCodeAt(u)]<<18|r[b.charCodeAt(u+1)]<<12|r[b.charCodeAt(u+2)]<<6|r[b.charCodeAt(u+3)],x[v++]=U>>16&255,x[v++]=U>>8&255,x[v++]=U&255;return z===2&&(U=r[b.charCodeAt(u)]<<2|r[b.charCodeAt(u+1)]>>4,x[v++]=U&255),z===1&&(U=r[b.charCodeAt(u)]<<10|r[b.charCodeAt(u+1)]<<4|r[b.charCodeAt(u+2)]>>2,x[v++]=U>>8&255,x[v++]=U&255),x}function L(b){return e[b>>18&63]+e[b>>12&63]+e[b>>6&63]+e[b&63]}function y(b,U,C){for(var K,z=[],x=U;x<C;x+=3)K=(b[x]<<16&16711680)+(b[x+1]<<8&65280)+(b[x+2]&255),z.push(L(K));return z.join("")}function k(b){for(var U,C=b.length,K=C%3,z=[],x=16383,v=0,w=C-K;v<w;v+=x)z.push(y(b,v,v+x>w?w:v+x));return K===1?(U=b[C-1],z.push(e[U>>2]+e[U<<4&63]+"==")):K===2&&(U=(b[C-2]<<8)+b[C-1],z.push(e[U>>10]+e[U>>4&63]+e[U<<2&63]+"=")),z.join("")}}),Jn=pt(t=>{at(),t.read=function(e,r,i,a,c){var l,n,p=c*8-a-1,S=(1<<p)-1,E=S>>1,L=-7,y=i?c-1:0,k=i?-1:1,b=e[r+y];for(y+=k,l=b&(1<<-L)-1,b>>=-L,L+=p;L>0;l=l*256+e[r+y],y+=k,L-=8);for(n=l&(1<<-L)-1,l>>=-L,L+=a;L>0;n=n*256+e[r+y],y+=k,L-=8);if(l===0)l=1-E;else{if(l===S)return n?NaN:(b?-1:1)*(1/0);n=n+Math.pow(2,a),l=l-E}return(b?-1:1)*n*Math.pow(2,l-a)},t.write=function(e,r,i,a,c,l){var n,p,S,E=l*8-c-1,L=(1<<E)-1,y=L>>1,k=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=a?0:l-1,U=a?1:-1,C=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(p=isNaN(r)?1:0,n=L):(n=Math.floor(Math.log(r)/Math.LN2),r*(S=Math.pow(2,-n))<1&&(n--,S*=2),n+y>=1?r+=k/S:r+=k*Math.pow(2,1-y),r*S>=2&&(n++,S/=2),n+y>=L?(p=0,n=L):n+y>=1?(p=(r*S-1)*Math.pow(2,c),n=n+y):(p=r*Math.pow(2,y-1)*Math.pow(2,c),n=0));c>=8;e[i+b]=p&255,b+=U,p/=256,c-=8);for(n=n<<c|p,E+=c;E>0;e[i+b]=n&255,b+=U,n/=256,E-=8);e[i+b-U]|=C*128}}),oe=pt(t=>{at();var e=Ur(),r=Jn(),i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=n,t.SlowBuffer=z,t.INSPECT_MAX_BYTES=50;var a=2147483647;t.kMaxLength=a,n.TYPED_ARRAY_SUPPORT=c(),!n.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{var s=new Uint8Array(1),h={foo:function(){return 42}};return Object.setPrototypeOf(h,Uint8Array.prototype),Object.setPrototypeOf(s,h),s.foo()===42}catch{return!1}}Object.defineProperty(n.prototype,"parent",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.buffer}}),Object.defineProperty(n.prototype,"offset",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.byteOffset}});function l(s){if(s>a)throw new RangeError('The value "'+s+'" is invalid for option "size"');var h=new Uint8Array(s);return Object.setPrototypeOf(h,n.prototype),h}function n(s,h,d){if(typeof s=="number"){if(typeof h=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(s)}return p(s,h,d)}n.poolSize=8192;function p(s,h,d){if(typeof s=="string")return y(s,h);if(ArrayBuffer.isView(s))return b(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(M(s,ArrayBuffer)||s&&M(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(M(s,SharedArrayBuffer)||s&&M(s.buffer,SharedArrayBuffer)))return U(s,h,d);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var A=s.valueOf&&s.valueOf();if(A!=null&&A!==s)return n.from(A,h,d);var R=C(s);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return n.from(s[Symbol.toPrimitive]("string"),h,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}n.from=function(s,h,d){return p(s,h,d)},Object.setPrototypeOf(n.prototype,Uint8Array.prototype),Object.setPrototypeOf(n,Uint8Array);function S(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function E(s,h,d){return S(s),s<=0?l(s):h!==void 0?typeof d=="string"?l(s).fill(h,d):l(s).fill(h):l(s)}n.alloc=function(s,h,d){return E(s,h,d)};function L(s){return S(s),l(s<0?0:K(s)|0)}n.allocUnsafe=function(s){return L(s)},n.allocUnsafeSlow=function(s){return L(s)};function y(s,h){if((typeof h!="string"||h==="")&&(h="utf8"),!n.isEncoding(h))throw new TypeError("Unknown encoding: "+h);var d=x(s,h)|0,A=l(d),R=A.write(s,h);return R!==d&&(A=A.slice(0,R)),A}function k(s){for(var h=s.length<0?0:K(s.length)|0,d=l(h),A=0;A<h;A+=1)d[A]=s[A]&255;return d}function b(s){if(M(s,Uint8Array)){var h=new Uint8Array(s);return U(h.buffer,h.byteOffset,h.byteLength)}return k(s)}function U(s,h,d){if(h<0||s.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<h+(d||0))throw new RangeError('"length" is outside of buffer bounds');var A;return h===void 0&&d===void 0?A=new Uint8Array(s):d===void 0?A=new Uint8Array(s,h):A=new Uint8Array(s,h,d),Object.setPrototypeOf(A,n.prototype),A}function C(s){if(n.isBuffer(s)){var h=K(s.length)|0,d=l(h);return d.length===0||s.copy(d,0,0,h),d}if(s.length!==void 0)return typeof s.length!="number"||X(s.length)?l(0):k(s);if(s.type==="Buffer"&&Array.isArray(s.data))return k(s.data)}function K(s){if(s>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return s|0}function z(s){return+s!=s&&(s=0),n.alloc(+s)}n.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==n.prototype},n.compare=function(s,h){if(M(s,Uint8Array)&&(s=n.from(s,s.offset,s.byteLength)),M(h,Uint8Array)&&(h=n.from(h,h.offset,h.byteLength)),!n.isBuffer(s)||!n.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===h)return 0;for(var d=s.length,A=h.length,R=0,f=Math.min(d,A);R<f;++R)if(s[R]!==h[R]){d=s[R],A=h[R];break}return d<A?-1:A<d?1:0},n.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(s,h){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return n.alloc(0);var d;if(h===void 0)for(h=0,d=0;d<s.length;++d)h+=s[d].length;var A=n.allocUnsafe(h),R=0;for(d=0;d<s.length;++d){var f=s[d];if(M(f,Uint8Array))R+f.length>A.length?n.from(f).copy(A,R):Uint8Array.prototype.set.call(A,f,R);else if(n.isBuffer(f))f.copy(A,R);else throw new TypeError('"list" argument must be an Array of Buffers');R+=f.length}return A};function x(s,h){if(n.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||M(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var d=s.length,A=arguments.length>2&&arguments[2]===!0;if(!A&&d===0)return 0;for(var R=!1;;)switch(h){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return dt(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d*2;case"hex":return d>>>1;case"base64":return N(s).length;default:if(R)return A?-1:dt(s).length;h=(""+h).toLowerCase(),R=!0}}n.byteLength=x;function v(s,h,d){var A=!1;if((h===void 0||h<0)&&(h=0),h>this.length||((d===void 0||d>this.length)&&(d=this.length),d<=0)||(d>>>=0,h>>>=0,d<=h))return"";for(s||(s="utf8");;)switch(s){case"hex":return W(this,h,d);case"utf8":case"utf-8":return tt(this,h,d);case"ascii":return B(this,h,d);case"latin1":case"binary":return O(this,h,d);case"base64":return J(this,h,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,h,d);default:if(A)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),A=!0}}n.prototype._isBuffer=!0;function w(s,h,d){var A=s[h];s[h]=s[d],s[d]=A}n.prototype.swap16=function(){var s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<s;h+=2)w(this,h,h+1);return this},n.prototype.swap32=function(){var s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<s;h+=4)w(this,h,h+3),w(this,h+1,h+2);return this},n.prototype.swap64=function(){var s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<s;h+=8)w(this,h,h+7),w(this,h+1,h+6),w(this,h+2,h+5),w(this,h+3,h+4);return this},n.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?tt(this,0,s):v.apply(this,arguments)},n.prototype.toLocaleString=n.prototype.toString,n.prototype.equals=function(s){if(!n.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:n.compare(this,s)===0},n.prototype.inspect=function(){var s="",h=t.INSPECT_MAX_BYTES;return s=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(s+=" ... "),"<Buffer "+s+">"},i&&(n.prototype[i]=n.prototype.inspect),n.prototype.compare=function(s,h,d,A,R){if(M(s,Uint8Array)&&(s=n.from(s,s.offset,s.byteLength)),!n.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(h===void 0&&(h=0),d===void 0&&(d=s?s.length:0),A===void 0&&(A=0),R===void 0&&(R=this.length),h<0||d>s.length||A<0||R>this.length)throw new RangeError("out of range index");if(A>=R&&h>=d)return 0;if(A>=R)return-1;if(h>=d)return 1;if(h>>>=0,d>>>=0,A>>>=0,R>>>=0,this===s)return 0;for(var f=R-A,_=d-h,D=Math.min(f,_),Y=this.slice(A,R),lt=s.slice(h,d),ft=0;ft<D;++ft)if(Y[ft]!==lt[ft]){f=Y[ft],_=lt[ft];break}return f<_?-1:_<f?1:0};function u(s,h,d,A,R){if(s.length===0)return-1;if(typeof d=="string"?(A=d,d=0):d>2147483647?d=2147483647:d<-2147483648&&(d=-2147483648),d=+d,X(d)&&(d=R?0:s.length-1),d<0&&(d=s.length+d),d>=s.length){if(R)return-1;d=s.length-1}else if(d<0)if(R)d=0;else return-1;if(typeof h=="string"&&(h=n.from(h,A)),n.isBuffer(h))return h.length===0?-1:T(s,h,d,A,R);if(typeof h=="number")return h=h&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(s,h,d):Uint8Array.prototype.lastIndexOf.call(s,h,d):T(s,[h],d,A,R);throw new TypeError("val must be string, number or Buffer")}function T(s,h,d,A,R){var f=1,_=s.length,D=h.length;if(A!==void 0&&(A=String(A).toLowerCase(),A==="ucs2"||A==="ucs-2"||A==="utf16le"||A==="utf-16le")){if(s.length<2||h.length<2)return-1;f=2,_/=2,D/=2,d/=2}function Y(m,V){return f===1?m[V]:m.readUInt16BE(V*f)}var lt;if(R){var ft=-1;for(lt=d;lt<_;lt++)if(Y(s,lt)===Y(h,ft===-1?0:lt-ft)){if(ft===-1&&(ft=lt),lt-ft+1===D)return ft*f}else ft!==-1&&(lt-=lt-ft),ft=-1}else for(d+D>_&&(d=_-D),lt=d;lt>=0;lt--){for(var o=!0,g=0;g<D;g++)if(Y(s,lt+g)!==Y(h,g)){o=!1;break}if(o)return lt}return-1}n.prototype.includes=function(s,h,d){return this.indexOf(s,h,d)!==-1},n.prototype.indexOf=function(s,h,d){return u(this,s,h,d,!0)},n.prototype.lastIndexOf=function(s,h,d){return u(this,s,h,d,!1)};function I(s,h,d,A){d=Number(d)||0;var R=s.length-d;A?(A=Number(A),A>R&&(A=R)):A=R;var f=h.length;A>f/2&&(A=f/2);for(var _=0;_<A;++_){var D=parseInt(h.substr(_*2,2),16);if(X(D))return _;s[d+_]=D}return _}function P(s,h,d,A){return $(dt(h,s.length-d),s,d,A)}function q(s,h,d,A){return $(wt(h),s,d,A)}function G(s,h,d,A){return $(N(h),s,d,A)}function et(s,h,d,A){return $(St(h,s.length-d),s,d,A)}n.prototype.write=function(s,h,d,A){if(h===void 0)A="utf8",d=this.length,h=0;else if(d===void 0&&typeof h=="string")A=h,d=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(d)?(d=d>>>0,A===void 0&&(A="utf8")):(A=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-h;if((d===void 0||d>R)&&(d=R),s.length>0&&(d<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");A||(A="utf8");for(var f=!1;;)switch(A){case"hex":return I(this,s,h,d);case"utf8":case"utf-8":return P(this,s,h,d);case"ascii":case"latin1":case"binary":return q(this,s,h,d);case"base64":return G(this,s,h,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,s,h,d);default:if(f)throw new TypeError("Unknown encoding: "+A);A=(""+A).toLowerCase(),f=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(s,h,d){return h===0&&d===s.length?e.fromByteArray(s):e.fromByteArray(s.slice(h,d))}function tt(s,h,d){d=Math.min(s.length,d);for(var A=[],R=h;R<d;){var f=s[R],_=null,D=f>239?4:f>223?3:f>191?2:1;if(R+D<=d){var Y,lt,ft,o;switch(D){case 1:f<128&&(_=f);break;case 2:Y=s[R+1],(Y&192)===128&&(o=(f&31)<<6|Y&63,o>127&&(_=o));break;case 3:Y=s[R+1],lt=s[R+2],(Y&192)===128&&(lt&192)===128&&(o=(f&15)<<12|(Y&63)<<6|lt&63,o>2047&&(o<55296||o>57343)&&(_=o));break;case 4:Y=s[R+1],lt=s[R+2],ft=s[R+3],(Y&192)===128&&(lt&192)===128&&(ft&192)===128&&(o=(f&15)<<18|(Y&63)<<12|(lt&63)<<6|ft&63,o>65535&&o<1114112&&(_=o))}}_===null?(_=65533,D=1):_>65535&&(_-=65536,A.push(_>>>10&1023|55296),_=56320|_&1023),A.push(_),R+=D}return nt(A)}var st=4096;function nt(s){var h=s.length;if(h<=st)return String.fromCharCode.apply(String,s);for(var d="",A=0;A<h;)d+=String.fromCharCode.apply(String,s.slice(A,A+=st));return d}function B(s,h,d){var A="";d=Math.min(s.length,d);for(var R=h;R<d;++R)A+=String.fromCharCode(s[R]&127);return A}function O(s,h,d){var A="";d=Math.min(s.length,d);for(var R=h;R<d;++R)A+=String.fromCharCode(s[R]);return A}function W(s,h,d){var A=s.length;(!h||h<0)&&(h=0),(!d||d<0||d>A)&&(d=A);for(var R="",f=h;f<d;++f)R+=H[s[f]];return R}function F(s,h,d){for(var A=s.slice(h,d),R="",f=0;f<A.length-1;f+=2)R+=String.fromCharCode(A[f]+A[f+1]*256);return R}n.prototype.slice=function(s,h){var d=this.length;s=~~s,h=h===void 0?d:~~h,s<0?(s+=d,s<0&&(s=0)):s>d&&(s=d),h<0?(h+=d,h<0&&(h=0)):h>d&&(h=d),h<s&&(h=s);var A=this.subarray(s,h);return Object.setPrototypeOf(A,n.prototype),A};function Z(s,h,d){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+h>d)throw new RangeError("Trying to access beyond buffer length")}n.prototype.readUintLE=n.prototype.readUIntLE=function(s,h,d){s=s>>>0,h=h>>>0,d||Z(s,h,this.length);for(var A=this[s],R=1,f=0;++f<h&&(R*=256);)A+=this[s+f]*R;return A},n.prototype.readUintBE=n.prototype.readUIntBE=function(s,h,d){s=s>>>0,h=h>>>0,d||Z(s,h,this.length);for(var A=this[s+--h],R=1;h>0&&(R*=256);)A+=this[s+--h]*R;return A},n.prototype.readUint8=n.prototype.readUInt8=function(s,h){return s=s>>>0,h||Z(s,1,this.length),this[s]},n.prototype.readUint16LE=n.prototype.readUInt16LE=function(s,h){return s=s>>>0,h||Z(s,2,this.length),this[s]|this[s+1]<<8},n.prototype.readUint16BE=n.prototype.readUInt16BE=function(s,h){return s=s>>>0,h||Z(s,2,this.length),this[s]<<8|this[s+1]},n.prototype.readUint32LE=n.prototype.readUInt32LE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},n.prototype.readUint32BE=n.prototype.readUInt32BE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},n.prototype.readIntLE=function(s,h,d){s=s>>>0,h=h>>>0,d||Z(s,h,this.length);for(var A=this[s],R=1,f=0;++f<h&&(R*=256);)A+=this[s+f]*R;return R*=128,A>=R&&(A-=Math.pow(2,8*h)),A},n.prototype.readIntBE=function(s,h,d){s=s>>>0,h=h>>>0,d||Z(s,h,this.length);for(var A=h,R=1,f=this[s+--A];A>0&&(R*=256);)f+=this[s+--A]*R;return R*=128,f>=R&&(f-=Math.pow(2,8*h)),f},n.prototype.readInt8=function(s,h){return s=s>>>0,h||Z(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},n.prototype.readInt16LE=function(s,h){s=s>>>0,h||Z(s,2,this.length);var d=this[s]|this[s+1]<<8;return d&32768?d|4294901760:d},n.prototype.readInt16BE=function(s,h){s=s>>>0,h||Z(s,2,this.length);var d=this[s+1]|this[s]<<8;return d&32768?d|4294901760:d},n.prototype.readInt32LE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},n.prototype.readInt32BE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},n.prototype.readFloatLE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),r.read(this,s,!0,23,4)},n.prototype.readFloatBE=function(s,h){return s=s>>>0,h||Z(s,4,this.length),r.read(this,s,!1,23,4)},n.prototype.readDoubleLE=function(s,h){return s=s>>>0,h||Z(s,8,this.length),r.read(this,s,!0,52,8)},n.prototype.readDoubleBE=function(s,h){return s=s>>>0,h||Z(s,8,this.length),r.read(this,s,!1,52,8)};function ot(s,h,d,A,R,f){if(!n.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>R||h<f)throw new RangeError('"value" argument is out of bounds');if(d+A>s.length)throw new RangeError("Index out of range")}n.prototype.writeUintLE=n.prototype.writeUIntLE=function(s,h,d,A){if(s=+s,h=h>>>0,d=d>>>0,!A){var R=Math.pow(2,8*d)-1;ot(this,s,h,d,R,0)}var f=1,_=0;for(this[h]=s&255;++_<d&&(f*=256);)this[h+_]=s/f&255;return h+d},n.prototype.writeUintBE=n.prototype.writeUIntBE=function(s,h,d,A){if(s=+s,h=h>>>0,d=d>>>0,!A){var R=Math.pow(2,8*d)-1;ot(this,s,h,d,R,0)}var f=d-1,_=1;for(this[h+f]=s&255;--f>=0&&(_*=256);)this[h+f]=s/_&255;return h+d},n.prototype.writeUint8=n.prototype.writeUInt8=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,1,255,0),this[h]=s&255,h+1},n.prototype.writeUint16LE=n.prototype.writeUInt16LE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,2,65535,0),this[h]=s&255,this[h+1]=s>>>8,h+2},n.prototype.writeUint16BE=n.prototype.writeUInt16BE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,2,65535,0),this[h]=s>>>8,this[h+1]=s&255,h+2},n.prototype.writeUint32LE=n.prototype.writeUInt32LE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,4,4294967295,0),this[h+3]=s>>>24,this[h+2]=s>>>16,this[h+1]=s>>>8,this[h]=s&255,h+4},n.prototype.writeUint32BE=n.prototype.writeUInt32BE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,4,4294967295,0),this[h]=s>>>24,this[h+1]=s>>>16,this[h+2]=s>>>8,this[h+3]=s&255,h+4},n.prototype.writeIntLE=function(s,h,d,A){if(s=+s,h=h>>>0,!A){var R=Math.pow(2,8*d-1);ot(this,s,h,d,R-1,-R)}var f=0,_=1,D=0;for(this[h]=s&255;++f<d&&(_*=256);)s<0&&D===0&&this[h+f-1]!==0&&(D=1),this[h+f]=(s/_>>0)-D&255;return h+d},n.prototype.writeIntBE=function(s,h,d,A){if(s=+s,h=h>>>0,!A){var R=Math.pow(2,8*d-1);ot(this,s,h,d,R-1,-R)}var f=d-1,_=1,D=0;for(this[h+f]=s&255;--f>=0&&(_*=256);)s<0&&D===0&&this[h+f+1]!==0&&(D=1),this[h+f]=(s/_>>0)-D&255;return h+d},n.prototype.writeInt8=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,1,127,-128),s<0&&(s=255+s+1),this[h]=s&255,h+1},n.prototype.writeInt16LE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,2,32767,-32768),this[h]=s&255,this[h+1]=s>>>8,h+2},n.prototype.writeInt16BE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,2,32767,-32768),this[h]=s>>>8,this[h+1]=s&255,h+2},n.prototype.writeInt32LE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,4,2147483647,-2147483648),this[h]=s&255,this[h+1]=s>>>8,this[h+2]=s>>>16,this[h+3]=s>>>24,h+4},n.prototype.writeInt32BE=function(s,h,d){return s=+s,h=h>>>0,d||ot(this,s,h,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[h]=s>>>24,this[h+1]=s>>>16,this[h+2]=s>>>8,this[h+3]=s&255,h+4};function ut(s,h,d,A,R,f){if(d+A>s.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("Index out of range")}function gt(s,h,d,A,R){return h=+h,d=d>>>0,R||ut(s,h,d,4),r.write(s,h,d,A,23,4),d+4}n.prototype.writeFloatLE=function(s,h,d){return gt(this,s,h,!0,d)},n.prototype.writeFloatBE=function(s,h,d){return gt(this,s,h,!1,d)};function rt(s,h,d,A,R){return h=+h,d=d>>>0,R||ut(s,h,d,8),r.write(s,h,d,A,52,8),d+8}n.prototype.writeDoubleLE=function(s,h,d){return rt(this,s,h,!0,d)},n.prototype.writeDoubleBE=function(s,h,d){return rt(this,s,h,!1,d)},n.prototype.copy=function(s,h,d,A){if(!n.isBuffer(s))throw new TypeError("argument should be a Buffer");if(d||(d=0),!A&&A!==0&&(A=this.length),h>=s.length&&(h=s.length),h||(h=0),A>0&&A<d&&(A=d),A===d||s.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("sourceEnd out of bounds");A>this.length&&(A=this.length),s.length-h<A-d&&(A=s.length-h+d);var R=A-d;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,d,A):Uint8Array.prototype.set.call(s,this.subarray(d,A),h),R},n.prototype.fill=function(s,h,d,A){if(typeof s=="string"){if(typeof h=="string"?(A=h,h=0,d=this.length):typeof d=="string"&&(A=d,d=this.length),A!==void 0&&typeof A!="string")throw new TypeError("encoding must be a string");if(typeof A=="string"&&!n.isEncoding(A))throw new TypeError("Unknown encoding: "+A);if(s.length===1){var R=s.charCodeAt(0);(A==="utf8"&&R<128||A==="latin1")&&(s=R)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(h<0||this.length<h||this.length<d)throw new RangeError("Out of range index");if(d<=h)return this;h=h>>>0,d=d===void 0?this.length:d>>>0,s||(s=0);var f;if(typeof s=="number")for(f=h;f<d;++f)this[f]=s;else{var _=n.isBuffer(s)?s:n.from(s,A),D=_.length;if(D===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(f=0;f<d-h;++f)this[f+h]=_[f%D]}return this};var ht=/[^+/0-9A-Za-z-_]/g;function mt(s){if(s=s.split("=")[0],s=s.trim().replace(ht,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function dt(s,h){h=h||1/0;for(var d,A=s.length,R=null,f=[],_=0;_<A;++_){if(d=s.charCodeAt(_),d>55295&&d<57344){if(!R){if(d>56319){(h-=3)>-1&&f.push(239,191,189);continue}else if(_+1===A){(h-=3)>-1&&f.push(239,191,189);continue}R=d;continue}if(d<56320){(h-=3)>-1&&f.push(239,191,189),R=d;continue}d=(R-55296<<10|d-56320)+65536}else R&&(h-=3)>-1&&f.push(239,191,189);if(R=null,d<128){if((h-=1)<0)break;f.push(d)}else if(d<2048){if((h-=2)<0)break;f.push(d>>6|192,d&63|128)}else if(d<65536){if((h-=3)<0)break;f.push(d>>12|224,d>>6&63|128,d&63|128)}else if(d<1114112){if((h-=4)<0)break;f.push(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}else throw new Error("Invalid code point")}return f}function wt(s){for(var h=[],d=0;d<s.length;++d)h.push(s.charCodeAt(d)&255);return h}function St(s,h){for(var d,A,R,f=[],_=0;_<s.length&&!((h-=2)<0);++_)d=s.charCodeAt(_),A=d>>8,R=d%256,f.push(R),f.push(A);return f}function N(s){return e.toByteArray(mt(s))}function $(s,h,d,A){for(var R=0;R<A&&!(R+d>=h.length||R>=s.length);++R)h[R+d]=s[R];return R}function M(s,h){return s instanceof h||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===h.name}function X(s){return s!==s}var H=function(){for(var s="0123456789abcdef",h=new Array(256),d=0;d<16;++d)for(var A=d*16,R=0;R<16;++R)h[A+R]=s[d]+s[R];return h}()}),Qn=pt((t,e)=>{at();var r=e.exports={},i,a;function c(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?i=setTimeout:i=c}catch{i=c}try{typeof clearTimeout=="function"?a=clearTimeout:a=l}catch{a=l}})();function n(K){if(i===setTimeout)return setTimeout(K,0);if((i===c||!i)&&setTimeout)return i=setTimeout,setTimeout(K,0);try{return i(K,0)}catch{try{return i.call(null,K,0)}catch{return i.call(this,K,0)}}}function p(K){if(a===clearTimeout)return clearTimeout(K);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(K);try{return a(K)}catch{try{return a.call(null,K)}catch{return a.call(this,K)}}}var S=[],E=!1,L,y=-1;function k(){!E||!L||(E=!1,L.length?S=L.concat(S):y=-1,S.length&&b())}function b(){if(!E){var K=n(k);E=!0;for(var z=S.length;z;){for(L=S,S=[];++y<z;)L&&L[y].run();y=-1,z=S.length}L=null,E=!1,p(K)}}r.nextTick=function(K){var z=new Array(arguments.length-1);if(arguments.length>1)for(var x=1;x<arguments.length;x++)z[x-1]=arguments[x];S.push(new U(K,z)),S.length===1&&!E&&n(b)};function U(K,z){this.fun=K,this.array=z}U.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={};function C(){}r.on=C,r.addListener=C,r.once=C,r.off=C,r.removeListener=C,r.removeAllListeners=C,r.emit=C,r.prependListener=C,r.prependOnceListener=C,r.listeners=function(K){return[]},r.binding=function(K){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(K){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}),Ct,Jt,fr,Yt,at=Hn(()=>{Ct=Lt(oe()),Jt=Lt(Qn()),fr=function(t){function e(){var i=this||self;return delete t.prototype.__magic__,i}if(typeof globalThis=="object")return globalThis;if(this)return e();t.defineProperty(t.prototype,"__magic__",{configurable:!0,get:e});var r=__magic__;return r}(Object),Yt=fr}),Yn=pt(t=>{at(),t.supports=function(...e){let r=e.reduce((i,a)=>Object.assign(i,a),{});return Object.assign(r,{snapshots:r.snapshots||!1,permanence:r.permanence||!1,seek:r.seek||!1,clear:r.clear||!1,getMany:r.getMany||!1,keyIterator:r.keyIterator||!1,valueIterator:r.valueIterator||!1,iteratorNextv:r.iteratorNextv||!1,iteratorAll:r.iteratorAll||!1,status:r.status||!1,createIfMissing:r.createIfMissing||!1,errorIfExists:r.errorIfExists||!1,deferredOpen:r.deferredOpen||!1,promises:r.promises||!1,streams:r.streams||!1,encodings:Object.assign({},r.encodings),events:Object.assign({},r.events),additionalMethods:Object.assign({},r.additionalMethods)})}}),jt=pt((t,e)=>{at(),e.exports=class extends Error{constructor(r,i){super(r||""),typeof i=="object"&&i!==null&&(i.code&&(this.code=String(i.code)),i.expected&&(this.expected=!0),i.transient&&(this.transient=!0),i.cause&&(this.cause=i.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}}),$r=pt((t,e)=>{at();var r=null;e.exports=function(){return r===null&&(r={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),r}}),Pr=pt(t=>{at();var e=jt(),r=new Set(["buffer","view","utf8"]),i=class{constructor(a){if(this.encode=a.encode||this.encode,this.decode=a.decode||this.decode,this.name=a.name||this.name,this.format=a.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!r.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");a.createViewTranscoder&&(this.createViewTranscoder=a.createViewTranscoder),a.createBufferTranscoder&&(this.createBufferTranscoder=a.createBufferTranscoder),a.createUTF8Transcoder&&(this.createUTF8Transcoder=a.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};t.Encoding=i}),Mr=pt(t=>{at();var{Buffer:e}=oe()||{},{Encoding:r}=Pr(),i=$r(),a=class extends r{constructor(n){super({...n,format:"buffer"})}createViewTranscoder(){return new c({encode:this.encode,decode:n=>this.decode(e.from(n.buffer,n.byteOffset,n.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},c=class extends r{constructor(n){super({...n,format:"view"})}createBufferTranscoder(){return new a({encode:n=>{let p=this.encode(n);return e.from(p.buffer,p.byteOffset,p.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},l=class extends r{constructor(n){super({...n,format:"utf8"})}createBufferTranscoder(){return new a({encode:n=>e.from(this.encode(n),"utf8"),decode:n=>this.decode(n.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:n,textDecoder:p}=i();return new c({encode:S=>n.encode(this.encode(S)),decode:S=>this.decode(p.decode(S)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};t.BufferFormat=a,t.ViewFormat=c,t.UTF8Format=l}),Xn=pt(t=>{at();var{Buffer:e}=oe()||{Buffer:{isBuffer:()=>!1}},{textEncoder:r,textDecoder:i}=$r()(),{BufferFormat:a,ViewFormat:c,UTF8Format:l}=Mr(),n=p=>p;t.utf8=new l({encode:function(p){return e.isBuffer(p)?p.toString("utf8"):ArrayBuffer.isView(p)?i.decode(p):String(p)},decode:n,name:"utf8",createViewTranscoder(){return new c({encode:function(p){return ArrayBuffer.isView(p)?p:r.encode(p)},decode:function(p){return i.decode(p)},name:`${this.name}+view`})},createBufferTranscoder(){return new a({encode:function(p){return e.isBuffer(p)?p:ArrayBuffer.isView(p)?e.from(p.buffer,p.byteOffset,p.byteLength):e.from(String(p),"utf8")},decode:function(p){return p.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new l({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new a({encode:function(p){return e.isBuffer(p)?p:ArrayBuffer.isView(p)?e.from(p.buffer,p.byteOffset,p.byteLength):e.from(String(p),"utf8")},decode:n,name:"buffer",createViewTranscoder(){return new c({encode:function(p){return ArrayBuffer.isView(p)?p:e.from(String(p),"utf8")},decode:function(p){return e.from(p.buffer,p.byteOffset,p.byteLength)},name:`${this.name}+view`})}}),t.view=new c({encode:function(p){return ArrayBuffer.isView(p)?p:r.encode(p)},decode:n,name:"view",createBufferTranscoder(){return new a({encode:function(p){return e.isBuffer(p)?p:ArrayBuffer.isView(p)?e.from(p.buffer,p.byteOffset,p.byteLength):e.from(String(p),"utf8")},decode:n,name:`${this.name}+buffer`})}}),t.hex=new a({encode:function(p){return e.isBuffer(p)?p:e.from(String(p),"hex")},decode:function(p){return p.toString("hex")},name:"hex"}),t.base64=new a({encode:function(p){return e.isBuffer(p)?p:e.from(String(p),"base64")},decode:function(p){return p.toString("base64")},name:"base64"})}),Zn=pt(t=>{at();var e=jt(),r=Xn(),{Encoding:i}=Pr(),{BufferFormat:a,ViewFormat:c,UTF8Format:l}=Mr(),n=Symbol("formats"),p=Symbol("encodings"),S=new Set(["buffer","view","utf8"]),E=class{constructor(C){if(Array.isArray(C)){if(!C.every(K=>S.has(K)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[p]=new Map,this[n]=new Set(C);for(let K in r)try{this.encoding(K)}catch(z){if(z.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw z}}encodings(){return Array.from(new Set(this[p].values()))}encoding(C){let K=this[p].get(C);if(K===void 0){if(typeof C=="string"&&C!==""){if(K=b[C],!K)throw new e(`Encoding '${C}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof C!="object"||C===null)throw new TypeError("First argument 'encoding' must be a string or object");K=L(C)}let{name:z,format:x}=K;if(!this[n].has(x))if(this[n].has("view"))K=K.createViewTranscoder();else if(this[n].has("buffer"))K=K.createBufferTranscoder();else if(this[n].has("utf8"))K=K.createUTF8Transcoder();else throw new e(`Encoding '${z}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let v of[C,z,K.name,K.commonName])this[p].set(v,K)}return K}};t.Transcoder=E;function L(C){if(C instanceof i)return C;let K="type"in C&&typeof C.type=="string"?C.type:void 0,z=C.name||K||`anonymous-${U++}`;switch(y(C)){case"view":return new c({...C,name:z});case"utf8":return new l({...C,name:z});case"buffer":return new a({...C,name:z});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function y(C){return"format"in C&&C.format!==void 0?C.format:"buffer"in C&&typeof C.buffer=="boolean"?C.buffer?"buffer":"utf8":"code"in C&&Number.isInteger(C.code)?"view":"buffer"}var k={binary:r.buffer,"utf-8":r.utf8},b={...r,...k},U=0}),ti=pt((t,e)=>{at();var r=typeof Reflect=="object"?Reflect:null,i=r&&typeof r.apply=="function"?r.apply:function(u,T,I){return Function.prototype.apply.call(u,T,I)},a;r&&typeof r.ownKeys=="function"?a=r.ownKeys:Object.getOwnPropertySymbols?a=function(u){return Object.getOwnPropertyNames(u).concat(Object.getOwnPropertySymbols(u))}:a=function(u){return Object.getOwnPropertyNames(u)};function c(u){console&&console.warn&&console.warn(u)}var l=Number.isNaN||function(u){return u!==u};function n(){n.init.call(this)}e.exports=n,e.exports.once=x,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var p=10;function S(u){if(typeof u!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof u)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(u){if(typeof u!="number"||u<0||l(u))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+u+".");p=u}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(u){if(typeof u!="number"||u<0||l(u))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+u+".");return this._maxListeners=u,this};function E(u){return u._maxListeners===void 0?n.defaultMaxListeners:u._maxListeners}n.prototype.getMaxListeners=function(){return E(this)},n.prototype.emit=function(u){for(var T=[],I=1;I<arguments.length;I++)T.push(arguments[I]);var P=u==="error",q=this._events;if(q!==void 0)P=P&&q.error===void 0;else if(!P)return!1;if(P){var G;if(T.length>0&&(G=T[0]),G instanceof Error)throw G;var et=new Error("Unhandled error."+(G?" ("+G.message+")":""));throw et.context=G,et}var J=q[u];if(J===void 0)return!1;if(typeof J=="function")i(J,this,T);else for(var tt=J.length,st=C(J,tt),I=0;I<tt;++I)i(st[I],this,T);return!0};function L(u,T,I,P){var q,G,et;if(S(I),G=u._events,G===void 0?(G=u._events=Object.create(null),u._eventsCount=0):(G.newListener!==void 0&&(u.emit("newListener",T,I.listener?I.listener:I),G=u._events),et=G[T]),et===void 0)et=G[T]=I,++u._eventsCount;else if(typeof et=="function"?et=G[T]=P?[I,et]:[et,I]:P?et.unshift(I):et.push(I),q=E(u),q>0&&et.length>q&&!et.warned){et.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+et.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=u,J.type=T,J.count=et.length,c(J)}return u}n.prototype.addListener=function(u,T){return L(this,u,T,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(u,T){return L(this,u,T,!0)};function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(u,T,I){var P={fired:!1,wrapFn:void 0,target:u,type:T,listener:I},q=y.bind(P);return q.listener=I,P.wrapFn=q,q}n.prototype.once=function(u,T){return S(T),this.on(u,k(this,u,T)),this},n.prototype.prependOnceListener=function(u,T){return S(T),this.prependListener(u,k(this,u,T)),this},n.prototype.removeListener=function(u,T){var I,P,q,G,et;if(S(T),P=this._events,P===void 0)return this;if(I=P[u],I===void 0)return this;if(I===T||I.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete P[u],P.removeListener&&this.emit("removeListener",u,I.listener||T));else if(typeof I!="function"){for(q=-1,G=I.length-1;G>=0;G--)if(I[G]===T||I[G].listener===T){et=I[G].listener,q=G;break}if(q<0)return this;q===0?I.shift():K(I,q),I.length===1&&(P[u]=I[0]),P.removeListener!==void 0&&this.emit("removeListener",u,et||T)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(u){var T,I,P;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[u]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[u]),this;if(arguments.length===0){var q=Object.keys(I),G;for(P=0;P<q.length;++P)G=q[P],G!=="removeListener"&&this.removeAllListeners(G);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=I[u],typeof T=="function")this.removeListener(u,T);else if(T!==void 0)for(P=T.length-1;P>=0;P--)this.removeListener(u,T[P]);return this};function b(u,T,I){var P=u._events;if(P===void 0)return[];var q=P[T];return q===void 0?[]:typeof q=="function"?I?[q.listener||q]:[q]:I?z(q):C(q,q.length)}n.prototype.listeners=function(u){return b(this,u,!0)},n.prototype.rawListeners=function(u){return b(this,u,!1)},n.listenerCount=function(u,T){return typeof u.listenerCount=="function"?u.listenerCount(T):U.call(u,T)},n.prototype.listenerCount=U;function U(u){var T=this._events;if(T!==void 0){var I=T[u];if(typeof I=="function")return 1;if(I!==void 0)return I.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]};function C(u,T){for(var I=new Array(T),P=0;P<T;++P)I[P]=u[P];return I}function K(u,T){for(;T+1<u.length;T++)u[T]=u[T+1];u.pop()}function z(u){for(var T=new Array(u.length),I=0;I<T.length;++I)T[I]=u[I].listener||u[I];return T}function x(u,T){return new Promise(function(I,P){function q(et){u.removeListener(T,G),P(et)}function G(){typeof u.removeListener=="function"&&u.removeListener("error",q),I([].slice.call(arguments))}w(u,T,G,{once:!0}),T!=="error"&&v(u,q,{once:!0})})}function v(u,T,I){typeof u.on=="function"&&w(u,"error",T,I)}function w(u,T,I,P){if(typeof u.on=="function")P.once?u.once(T,I):u.on(T,I);else if(typeof u.addEventListener=="function")u.addEventListener(T,function q(G){P.once&&u.removeEventListener(T,q),I(G)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof u)}}),ei=pt((t,e)=>{at(),e.exports=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r)}),ke=pt(t=>{at();var e=ei();t.fromCallback=function(r,i){if(r===void 0){var a=new Promise(function(c,l){r=function(n,p){n?l(n):c(p)}});r[i!==void 0?i:"promise"]=a}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r},t.fromPromise=function(r,i){if(i===void 0)return r;r.then(function(a){e(()=>i(null,a))}).catch(function(a){e(()=>i(a))})}}),Ye=pt(t=>{at(),t.getCallback=function(e,r){return typeof e=="function"?e:r},t.getOptions=function(e,r){return typeof e=="object"&&e!==null?e:r!==void 0?r:{}}}),Xt=pt(t=>{at();var{fromCallback:e}=ke(),r=jt(),{getOptions:i,getCallback:a}=Ye(),c=Symbol("promise"),l=Symbol("callback"),n=Symbol("working"),p=Symbol("handleOne"),S=Symbol("handleMany"),E=Symbol("autoClose"),L=Symbol("finishWork"),y=Symbol("returnMany"),k=Symbol("closing"),b=Symbol("handleClose"),U=Symbol("closed"),C=Symbol("closeCallbacks"),K=Symbol("keyEncoding"),z=Symbol("valueEncoding"),x=Symbol("abortOnClose"),v=Symbol("legacy"),w=Symbol("keys"),u=Symbol("values"),T=Symbol("limit"),I=Symbol("count"),P=Object.freeze({}),q=()=>{},G=!1,et=class{constructor(B,O,W){if(typeof B!="object"||B===null){let F=B===null?"null":typeof B;throw new TypeError(`The first argument must be an abstract-level database, received ${F}`)}if(typeof O!="object"||O===null)throw new TypeError("The second argument must be an options object");this[U]=!1,this[C]=[],this[n]=!1,this[k]=!1,this[E]=!1,this[l]=null,this[p]=this[p].bind(this),this[S]=this[S].bind(this),this[b]=this[b].bind(this),this[K]=O[K],this[z]=O[z],this[v]=W,this[T]=Number.isInteger(O.limit)&&O.limit>=0?O.limit:1/0,this[I]=0,this[x]=!!O.abortOnClose,this.db=B,this.db.attachResource(this),this.nextTick=B.nextTick}get count(){return this[I]}get limit(){return this[T]}next(B){let O;if(B===void 0)O=new Promise((W,F)=>{B=(Z,ot,ut)=>{Z?F(Z):this[v]?ot===void 0&&ut===void 0?W():W([ot,ut]):W(ot)}});else if(typeof B!="function")throw new TypeError("Callback must be a function");return this[k]?this.nextTick(B,new r("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[n]?this.nextTick(B,new r("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[n]=!0,this[l]=B,this[I]>=this[T]?this.nextTick(this[p],null):this._next(this[p])),O}_next(B){this.nextTick(B)}nextv(B,O,W){return W=a(O,W),W=e(W,c),O=i(O,P),Number.isInteger(B)?(this[k]?this.nextTick(W,new r("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[n]?this.nextTick(W,new r("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(B<1&&(B=1),this[T]<1/0&&(B=Math.min(B,this[T]-this[I])),this[n]=!0,this[l]=W,B<=0?this.nextTick(this[S],null,[]):this._nextv(B,O,this[S])),W[c]):(this.nextTick(W,new TypeError("The first argument 'size' must be an integer")),W[c])}_nextv(B,O,W){let F=[],Z=(ot,ut,gt)=>{if(ot)return W(ot);if(this[v]?ut===void 0&&gt===void 0:ut===void 0)return W(null,F);F.push(this[v]?[ut,gt]:ut),F.length===B?W(null,F):this._next(Z)};this._next(Z)}all(B,O){return O=a(B,O),O=e(O,c),B=i(B,P),this[k]?this.nextTick(O,new r("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[n]?this.nextTick(O,new r("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[n]=!0,this[l]=O,this[E]=!0,this[I]>=this[T]?this.nextTick(this[S],null,[]):this._all(B,this[S])),O[c]}_all(B,O){let W=this[I],F=[],Z=()=>{let ut=this[T]<1/0?Math.min(1e3,this[T]-W):1e3;ut<=0?this.nextTick(O,null,F):this._nextv(ut,P,ot)},ot=(ut,gt)=>{ut?O(ut):gt.length===0?O(null,F):(F.push.apply(F,gt),W+=gt.length,Z())};Z()}[L](){let B=this[l];return this[x]&&B===null?q:(this[n]=!1,this[l]=null,this[k]&&this._close(this[b]),B)}[y](B,O,W){this[E]?this.close(B.bind(null,O,W)):B(O,W)}seek(B,O){if(O=i(O,P),!this[k]){if(this[n])throw new r("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let W=this.db.keyEncoding(O.keyEncoding||this[K]),F=W.format;O.keyEncoding!==F&&(O={...O,keyEncoding:F});let Z=this.db.prefixKey(W.encode(B),F);this._seek(Z,O)}}}_seek(B,O){throw new r("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(B){return B=e(B,c),this[U]?this.nextTick(B):this[k]?this[C].push(B):(this[k]=!0,this[C].push(B),this[n]?this[x]&&this[L]()(new r("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[b])),B[c]}_close(B){this.nextTick(B)}[b](){this[U]=!0,this.db.detachResource(this);let B=this[C];this[C]=[];for(let O of B)O()}async*[Symbol.asyncIterator](){try{let B;for(;(B=await this.next())!==void 0;)yield B}finally{this[U]||await this.close()}}},J=class extends et{constructor(B,O){super(B,O,!0),this[w]=O.keys!==!1,this[u]=O.values!==!1}[p](B,O,W){let F=this[L]();if(B)return F(B);try{O=this[w]&&O!==void 0?this[K].decode(O):void 0,W=this[u]&&W!==void 0?this[z].decode(W):void 0}catch(Z){return F(new nt("entry",Z))}O===void 0&&W===void 0||this[I]++,F(null,O,W)}[S](B,O){let W=this[L]();if(B)return this[y](W,B);try{for(let F of O){let Z=F[0],ot=F[1];F[0]=this[w]&&Z!==void 0?this[K].decode(Z):void 0,F[1]=this[u]&&ot!==void 0?this[z].decode(ot):void 0}}catch(F){return this[y](W,new nt("entries",F))}this[I]+=O.length,this[y](W,null,O)}end(B){return!G&&typeof console<"u"&&(G=!0,console.warn(new r("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(B)}},tt=class extends et{constructor(B,O){super(B,O,!1)}[p](B,O){let W=this[L]();if(B)return W(B);try{O=O!==void 0?this[K].decode(O):void 0}catch(F){return W(new nt("key",F))}O!==void 0&&this[I]++,W(null,O)}[S](B,O){let W=this[L]();if(B)return this[y](W,B);try{for(let F=0;F<O.length;F++){let Z=O[F];O[F]=Z!==void 0?this[K].decode(Z):void 0}}catch(F){return this[y](W,new nt("keys",F))}this[I]+=O.length,this[y](W,null,O)}},st=class extends et{constructor(B,O){super(B,O,!1)}[p](B,O){let W=this[L]();if(B)return W(B);try{O=O!==void 0?this[z].decode(O):void 0}catch(F){return W(new nt("value",F))}O!==void 0&&this[I]++,W(null,O)}[S](B,O){let W=this[L]();if(B)return this[y](W,B);try{for(let F=0;F<O.length;F++){let Z=O[F];O[F]=Z!==void 0?this[z].decode(Z):void 0}}catch(F){return this[y](W,new nt("values",F))}this[I]+=O.length,this[y](W,null,O)}},nt=class extends r{constructor(B,O){super(`Iterator could not decode ${B}`,{code:"LEVEL_DECODE_ERROR",cause:O})}};for(let B of["_ended property","_nexting property","_end method"])Object.defineProperty(J.prototype,B.split(" ")[0],{get(){throw new r(`The ${B} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new r(`The ${B} has been removed`,{code:"LEVEL_LEGACY"})}});J.keyEncoding=K,J.valueEncoding=z,t.AbstractIterator=J,t.AbstractKeyIterator=tt,t.AbstractValueIterator=st}),ri=pt(t=>{at();var{AbstractKeyIterator:e,AbstractValueIterator:r}=Xt(),i=Symbol("iterator"),a=Symbol("callback"),c=Symbol("handleOne"),l=Symbol("handleMany"),n=class extends e{constructor(S,E){super(S,E),this[i]=S.iterator({...E,keys:!0,values:!1}),this[c]=this[c].bind(this),this[l]=this[l].bind(this)}},p=class extends r{constructor(S,E){super(S,E),this[i]=S.iterator({...E,keys:!1,values:!0}),this[c]=this[c].bind(this),this[l]=this[l].bind(this)}};for(let S of[n,p]){let E=S===n,L=E?y=>y[0]:y=>y[1];S.prototype._next=function(y){this[a]=y,this[i].next(this[c])},S.prototype[c]=function(y,k,b){let U=this[a];y?U(y):U(null,E?k:b)},S.prototype._nextv=function(y,k,b){this[a]=b,this[i].nextv(y,k,this[l])},S.prototype._all=function(y,k){this[a]=k,this[i].all(y,this[l])},S.prototype[l]=function(y,k){let b=this[a];y?b(y):b(null,k.map(L))},S.prototype._seek=function(y,k){this[i].seek(y,k)},S.prototype._close=function(y){this[i].close(y)}}t.DefaultKeyIterator=n,t.DefaultValueIterator=p}),ni=pt(t=>{at();var{AbstractIterator:e,AbstractKeyIterator:r,AbstractValueIterator:i}=Xt(),a=jt(),c=Symbol("nut"),l=Symbol("undefer"),n=Symbol("factory"),p=class extends e{constructor(L,y){super(L,y),this[c]=null,this[n]=()=>L.iterator(y),this.db.defer(()=>this[l]())}},S=class extends r{constructor(L,y){super(L,y),this[c]=null,this[n]=()=>L.keys(y),this.db.defer(()=>this[l]())}},E=class extends i{constructor(L,y){super(L,y),this[c]=null,this[n]=()=>L.values(y),this.db.defer(()=>this[l]())}};for(let L of[p,S,E])L.prototype[l]=function(){this.db.status==="open"&&(this[c]=this[n]())},L.prototype._next=function(y){this[c]!==null?this[c].next(y):this.db.status==="opening"?this.db.defer(()=>this._next(y)):this.nextTick(y,new a("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},L.prototype._nextv=function(y,k,b){this[c]!==null?this[c].nextv(y,k,b):this.db.status==="opening"?this.db.defer(()=>this._nextv(y,k,b)):this.nextTick(b,new a("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},L.prototype._all=function(y,k){this[c]!==null?this[c].all(k):this.db.status==="opening"?this.db.defer(()=>this._all(y,k)):this.nextTick(k,new a("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},L.prototype._seek=function(y,k){this[c]!==null?this[c]._seek(y,k):this.db.status==="opening"&&this.db.defer(()=>this._seek(y,k))},L.prototype._close=function(y){this[c]!==null?this[c].close(y):this.db.status==="opening"?this.db.defer(()=>this._close(y)):this.nextTick(y)};t.DeferredIterator=p,t.DeferredKeyIterator=S,t.DeferredValueIterator=E}),jr=pt(t=>{at();var{fromCallback:e}=ke(),r=jt(),{getCallback:i,getOptions:a}=Ye(),c=Symbol("promise"),l=Symbol("status"),n=Symbol("operations"),p=Symbol("finishClose"),S=Symbol("closeCallbacks"),E=class{constructor(L){if(typeof L!="object"||L===null){let y=L===null?"null":typeof L;throw new TypeError(`The first argument must be an abstract-level database, received ${y}`)}this[n]=[],this[S]=[],this[l]="open",this[p]=this[p].bind(this),this.db=L,this.db.attachResource(this),this.nextTick=L.nextTick}get length(){return this[n].length}put(L,y,k){if(this[l]!=="open")throw new r("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let b=this.db._checkKey(L)||this.db._checkValue(y);if(b)throw b;let U=k&&k.sublevel!=null?k.sublevel:this.db,C=k,K=U.keyEncoding(k&&k.keyEncoding),z=U.valueEncoding(k&&k.valueEncoding),x=K.format;k={...k,keyEncoding:x,valueEncoding:z.format},U!==this.db&&(k.sublevel=null);let v=U.prefixKey(K.encode(L),x),w=z.encode(y);return this._put(v,w,k),this[n].push({...C,type:"put",key:L,value:y}),this}_put(L,y,k){}del(L,y){if(this[l]!=="open")throw new r("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let k=this.db._checkKey(L);if(k)throw k;let b=y&&y.sublevel!=null?y.sublevel:this.db,U=y,C=b.keyEncoding(y&&y.keyEncoding),K=C.format;return y={...y,keyEncoding:K},b!==this.db&&(y.sublevel=null),this._del(b.prefixKey(C.encode(L),K),y),this[n].push({...U,type:"del",key:L}),this}_del(L,y){}clear(){if(this[l]!=="open")throw new r("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[n]=[],this}_clear(){}write(L,y){return y=i(L,y),y=e(y,c),L=a(L),this[l]!=="open"?this.nextTick(y,new r("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(y):(this[l]="writing",this._write(L,k=>{this[l]="closing",this[S].push(()=>y(k)),k||this.db.emit("batch",this[n]),this._close(this[p])})),y[c]}_write(L,y){}close(L){return L=e(L,c),this[l]==="closing"?this[S].push(L):this[l]==="closed"?this.nextTick(L):(this[S].push(L),this[l]!=="writing"&&(this[l]="closing",this._close(this[p]))),L[c]}_close(L){this.nextTick(L)}[p](){this[l]="closed",this.db.detachResource(this);let L=this[S];this[S]=[];for(let y of L)y()}};t.AbstractChainedBatch=E}),ii=pt(t=>{at();var{AbstractChainedBatch:e}=jr(),r=jt(),i=Symbol("encoded"),a=class extends e{constructor(c){super(c),this[i]=[]}_put(c,l,n){this[i].push({...n,type:"put",key:c,value:l})}_del(c,l){this[i].push({...l,type:"del",key:c})}_clear(){this[i]=[]}_write(c,l){this.db.status==="opening"?this.db.defer(()=>this._write(c,l)):this.db.status==="open"?this[i].length===0?this.nextTick(l):this.db._batch(this[i],c,l):this.nextTick(l,new r("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};t.DefaultChainedBatch=a}),ai=pt((t,e)=>{at();var r=jt(),i=Object.prototype.hasOwnProperty,a=new Set(["lt","lte","gt","gte"]);e.exports=function(c,l){let n={};for(let p in c)if(i.call(c,p)&&!(p==="keyEncoding"||p==="valueEncoding")){if(p==="start"||p==="end")throw new r(`The legacy range option '${p}' has been removed`,{code:"LEVEL_LEGACY"});if(p==="encoding")throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});a.has(p)?n[p]=l.encode(c[p]):n[p]=c[p]}return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n}}),Dr=pt((t,e)=>{at();var r;e.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Yt):i=>(r||(r=Promise.resolve())).then(i).catch(a=>setTimeout(()=>{throw a},0))}),oi=pt((t,e)=>{at();var r=Dr();e.exports=function(i,...a){a.length===0?r(i):r(()=>i(...a))}}),si=pt(t=>{at();var{AbstractIterator:e,AbstractKeyIterator:r,AbstractValueIterator:i}=Xt(),a=Symbol("unfix"),c=Symbol("iterator"),l=Symbol("handleOne"),n=Symbol("handleMany"),p=Symbol("callback"),S=class extends e{constructor(y,k,b,U){super(y,k),this[c]=b,this[a]=U,this[l]=this[l].bind(this),this[n]=this[n].bind(this),this[p]=null}[l](y,k,b){let U=this[p];if(y)return U(y);k!==void 0&&(k=this[a](k)),U(y,k,b)}[n](y,k){let b=this[p];if(y)return b(y);for(let U of k){let C=U[0];C!==void 0&&(U[0]=this[a](C))}b(y,k)}},E=class extends r{constructor(y,k,b,U){super(y,k),this[c]=b,this[a]=U,this[l]=this[l].bind(this),this[n]=this[n].bind(this),this[p]=null}[l](y,k){let b=this[p];if(y)return b(y);k!==void 0&&(k=this[a](k)),b(y,k)}[n](y,k){let b=this[p];if(y)return b(y);for(let U=0;U<k.length;U++){let C=k[U];C!==void 0&&(k[U]=this[a](C))}b(y,k)}},L=class extends i{constructor(y,k,b){super(y,k),this[c]=b}};for(let y of[S,E])y.prototype._next=function(k){this[p]=k,this[c].next(this[l])},y.prototype._nextv=function(k,b,U){this[p]=U,this[c].nextv(k,b,this[n])},y.prototype._all=function(k,b){this[p]=b,this[c].all(k,this[n])};for(let y of[L])y.prototype._next=function(k){this[c].next(k)},y.prototype._nextv=function(k,b,U){this[c].nextv(k,b,U)},y.prototype._all=function(k,b){this[c].all(k,b)};for(let y of[S,E,L])y.prototype._seek=function(k,b){this[c].seek(k,b)},y.prototype._close=function(k){this[c].close(k)};t.AbstractSublevelIterator=S,t.AbstractSublevelKeyIterator=E,t.AbstractSublevelValueIterator=L}),li=pt((t,e)=>{at();var r=jt(),{Buffer:i}=oe()||{},{AbstractSublevelIterator:a,AbstractSublevelKeyIterator:c,AbstractSublevelValueIterator:l}=si(),n=Symbol("prefix"),p=Symbol("upperBound"),S=Symbol("prefixRange"),E=Symbol("parent"),L=Symbol("unfix"),y=new TextEncoder,k={separator:"!"};e.exports=function({AbstractLevel:x}){class v extends x{static defaults(u){if(typeof u=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(u&&u.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return u==null?k:u.separator?u:{...u,separator:"!"}}constructor(u,T,I){let{separator:P,manifest:q,...G}=v.defaults(I);T=z(T,P);let et=P.charCodeAt(0)+1,J=u[E]||u;if(!y.encode(T).every(nt=>nt>et&&nt<127))throw new r(`Prefix must use bytes > ${et} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(b(J,q),G);let tt=(u.prefix||"")+P+T+P,st=tt.slice(0,-1)+String.fromCharCode(et);this[E]=J,this[n]=new C(tt),this[p]=new C(st),this[L]=new K,this.nextTick=J.nextTick}prefixKey(u,T){if(T==="utf8")return this[n].utf8+u;if(u.byteLength===0)return this[n][T];if(T==="view"){let I=this[n].view,P=new Uint8Array(I.byteLength+u.byteLength);return P.set(I,0),P.set(u,I.byteLength),P}else{let I=this[n].buffer;return i.concat([I,u],I.byteLength+u.byteLength)}}[S](u,T){u.gte!==void 0?u.gte=this.prefixKey(u.gte,T):u.gt!==void 0?u.gt=this.prefixKey(u.gt,T):u.gte=this[n][T],u.lte!==void 0?u.lte=this.prefixKey(u.lte,T):u.lt!==void 0?u.lt=this.prefixKey(u.lt,T):u.lte=this[p][T]}get prefix(){return this[n].utf8}get db(){return this[E]}_open(u,T){this[E].open({passive:!0},T)}_put(u,T,I,P){this[E].put(u,T,I,P)}_get(u,T,I){this[E].get(u,T,I)}_getMany(u,T,I){this[E].getMany(u,T,I)}_del(u,T,I){this[E].del(u,T,I)}_batch(u,T,I){this[E].batch(u,T,I)}_clear(u,T){this[S](u,u.keyEncoding),this[E].clear(u,T)}_iterator(u){this[S](u,u.keyEncoding);let T=this[E].iterator(u),I=this[L].get(this[n].utf8.length,u.keyEncoding);return new a(this,u,T,I)}_keys(u){this[S](u,u.keyEncoding);let T=this[E].keys(u),I=this[L].get(this[n].utf8.length,u.keyEncoding);return new c(this,u,T,I)}_values(u){this[S](u,u.keyEncoding);let T=this[E].values(u);return new l(this,u,T)}}return{AbstractSublevel:v}};var b=function(x,v){return{...x.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...v,encodings:{utf8:U(x,"utf8"),buffer:U(x,"buffer"),view:U(x,"view")}}},U=function(x,v){return x.supports.encodings[v]?x.keyEncoding(v).name===v:!1},C=class{constructor(x){this.utf8=x,this.view=y.encode(x),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}},K=class{constructor(){this.cache=new Map}get(x,v){let w=this.cache.get(v);return w===void 0&&(v==="view"?w=(function(u,T){return T.subarray(u)}).bind(null,x):w=(function(u,T){return T.slice(u)}).bind(null,x),this.cache.set(v,w)),w}},z=function(x,v){let w=0,u=x.length;for(;w<u&&x[w]===v;)w++;for(;u>w&&x[u-1]===v;)u--;return x.slice(w,u)}}),gr=pt(t=>{at();var{supports:e}=Yn(),{Transcoder:r}=Zn(),{EventEmitter:i}=ti(),{fromCallback:a}=ke(),c=jt(),{AbstractIterator:l}=Xt(),{DefaultKeyIterator:n,DefaultValueIterator:p}=ri(),{DeferredIterator:S,DeferredKeyIterator:E,DeferredValueIterator:L}=ni(),{DefaultChainedBatch:y}=ii(),{getCallback:k,getOptions:b}=Ye(),U=ai(),C=Symbol("promise"),K=Symbol("landed"),z=Symbol("resources"),x=Symbol("closeResources"),v=Symbol("operations"),w=Symbol("undefer"),u=Symbol("deferOpen"),T=Symbol("options"),I=Symbol("status"),P=Symbol("defaultOptions"),q=Symbol("transcoder"),G=Symbol("keyEncoding"),et=Symbol("valueEncoding"),J=()=>{},tt=class extends i{constructor(O,W){if(super(),typeof O!="object"||O===null)throw new TypeError("The first argument 'manifest' must be an object");W=b(W);let{keyEncoding:F,valueEncoding:Z,passive:ot,...ut}=W;this[z]=new Set,this[v]=[],this[u]=!0,this[T]=ut,this[I]="opening",this.supports=e(O,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:O.snapshots!==!1,permanence:O.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:O.encodings||{},events:Object.assign({},O.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[q]=new r(B(this)),this[G]=this[q].encoding(F||"utf8"),this[et]=this[q].encoding(Z||"utf8");for(let gt of this[q].encodings())this.supports.encodings[gt.commonName]||(this.supports.encodings[gt.commonName]=!0);this[P]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[G].commonName,valueEncoding:this[et].commonName}),key:Object.freeze({keyEncoding:this[G].commonName})},this.nextTick(()=>{this[u]&&this.open({passive:!1},J)})}get status(){return this[I]}keyEncoding(O){return this[q].encoding(O??this[G])}valueEncoding(O){return this[q].encoding(O??this[et])}open(O,W){W=k(O,W),W=a(W,C),O={...this[T],...b(O)},O.createIfMissing=O.createIfMissing!==!1,O.errorIfExists=!!O.errorIfExists;let F=Z=>{this[I]==="closing"||this[I]==="opening"?this.once(K,Z?()=>F(Z):F):this[I]!=="open"?W(new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:Z})):W()};return O.passive?this[I]==="opening"?this.once(K,F):this.nextTick(F):this[I]==="closed"||this[u]?(this[u]=!1,this[I]="opening",this.emit("opening"),this._open(O,Z=>{if(Z){this[I]="closed",this[x](()=>{this.emit(K),F(Z)}),this[w]();return}this[I]="open",this[w](),this.emit(K),this[I]==="open"&&this.emit("open"),this[I]==="open"&&this.emit("ready"),F()})):this[I]==="open"?this.nextTick(F):this.once(K,()=>this.open(O,W)),W[C]}_open(O,W){this.nextTick(W)}close(O){O=a(O,C);let W=F=>{this[I]==="opening"||this[I]==="closing"?this.once(K,F?W(F):W):this[I]!=="closed"?O(new c("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:F})):O()};if(this[I]==="open"){this[I]="closing",this.emit("closing");let F=Z=>{this[I]="open",this[w](),this.emit(K),W(Z)};this[x](()=>{this._close(Z=>{if(Z)return F(Z);this[I]="closed",this[w](),this.emit(K),this[I]==="closed"&&this.emit("closed"),W()})})}else this[I]==="closed"?this.nextTick(W):this.once(K,()=>this.close(O));return O[C]}[x](O){if(this[z].size===0)return this.nextTick(O);let W=this[z].size,F=!0,Z=()=>{--W===0&&(F?this.nextTick(O):O())};for(let ot of this[z])ot.close(Z);F=!1,this[z].clear()}_close(O){this.nextTick(O)}get(O,W,F){if(F=k(W,F),F=a(F,C),W=b(W,this[P].entry),this[I]==="opening")return this.defer(()=>this.get(O,W,F)),F[C];if(nt(this,F))return F[C];let Z=this._checkKey(O);if(Z)return this.nextTick(F,Z),F[C];let ot=this.keyEncoding(W.keyEncoding),ut=this.valueEncoding(W.valueEncoding),gt=ot.format,rt=ut.format;return(W.keyEncoding!==gt||W.valueEncoding!==rt)&&(W=Object.assign({},W,{keyEncoding:gt,valueEncoding:rt})),this._get(this.prefixKey(ot.encode(O),gt),W,(ht,mt)=>{if(ht)return(ht.code==="LEVEL_NOT_FOUND"||ht.notFound||/NotFound/i.test(ht))&&(ht.code||(ht.code="LEVEL_NOT_FOUND"),ht.notFound||(ht.notFound=!0),ht.status||(ht.status=404)),F(ht);try{mt=ut.decode(mt)}catch(dt){return F(new c("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:dt}))}F(null,mt)}),F[C]}_get(O,W,F){this.nextTick(F,new Error("NotFound"))}getMany(O,W,F){if(F=k(W,F),F=a(F,C),W=b(W,this[P].entry),this[I]==="opening")return this.defer(()=>this.getMany(O,W,F)),F[C];if(nt(this,F))return F[C];if(!Array.isArray(O))return this.nextTick(F,new TypeError("The first argument 'keys' must be an array")),F[C];if(O.length===0)return this.nextTick(F,null,[]),F[C];let Z=this.keyEncoding(W.keyEncoding),ot=this.valueEncoding(W.valueEncoding),ut=Z.format,gt=ot.format;(W.keyEncoding!==ut||W.valueEncoding!==gt)&&(W=Object.assign({},W,{keyEncoding:ut,valueEncoding:gt}));let rt=new Array(O.length);for(let ht=0;ht<O.length;ht++){let mt=O[ht],dt=this._checkKey(mt);if(dt)return this.nextTick(F,dt),F[C];rt[ht]=this.prefixKey(Z.encode(mt),ut)}return this._getMany(rt,W,(ht,mt)=>{if(ht)return F(ht);try{for(let dt=0;dt<mt.length;dt++)mt[dt]!==void 0&&(mt[dt]=ot.decode(mt[dt]))}catch(dt){return F(new c(`Could not decode one or more of ${mt.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:dt}))}F(null,mt)}),F[C]}_getMany(O,W,F){this.nextTick(F,null,new Array(O.length).fill(void 0))}put(O,W,F,Z){if(Z=k(F,Z),Z=a(Z,C),F=b(F,this[P].entry),this[I]==="opening")return this.defer(()=>this.put(O,W,F,Z)),Z[C];if(nt(this,Z))return Z[C];let ot=this._checkKey(O)||this._checkValue(W);if(ot)return this.nextTick(Z,ot),Z[C];let ut=this.keyEncoding(F.keyEncoding),gt=this.valueEncoding(F.valueEncoding),rt=ut.format,ht=gt.format;(F.keyEncoding!==rt||F.valueEncoding!==ht)&&(F=Object.assign({},F,{keyEncoding:rt,valueEncoding:ht}));let mt=this.prefixKey(ut.encode(O),rt),dt=gt.encode(W);return this._put(mt,dt,F,wt=>{if(wt)return Z(wt);this.emit("put",O,W),Z()}),Z[C]}_put(O,W,F,Z){this.nextTick(Z)}del(O,W,F){if(F=k(W,F),F=a(F,C),W=b(W,this[P].key),this[I]==="opening")return this.defer(()=>this.del(O,W,F)),F[C];if(nt(this,F))return F[C];let Z=this._checkKey(O);if(Z)return this.nextTick(F,Z),F[C];let ot=this.keyEncoding(W.keyEncoding),ut=ot.format;return W.keyEncoding!==ut&&(W=Object.assign({},W,{keyEncoding:ut})),this._del(this.prefixKey(ot.encode(O),ut),W,gt=>{if(gt)return F(gt);this.emit("del",O),F()}),F[C]}_del(O,W,F){this.nextTick(F)}batch(O,W,F){if(!arguments.length){if(this[I]==="opening")return new y(this);if(this[I]!=="open")throw new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof O=="function"?F=O:F=k(W,F),F=a(F,C),W=b(W,this[P].empty),this[I]==="opening")return this.defer(()=>this.batch(O,W,F)),F[C];if(nt(this,F))return F[C];if(!Array.isArray(O))return this.nextTick(F,new TypeError("The first argument 'operations' must be an array")),F[C];if(O.length===0)return this.nextTick(F),F[C];let Z=new Array(O.length),{keyEncoding:ot,valueEncoding:ut,...gt}=W;for(let rt=0;rt<O.length;rt++){if(typeof O[rt]!="object"||O[rt]===null)return this.nextTick(F,new TypeError("A batch operation must be an object")),F[C];let ht=Object.assign({},O[rt]);if(ht.type!=="put"&&ht.type!=="del")return this.nextTick(F,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),F[C];let mt=this._checkKey(ht.key);if(mt)return this.nextTick(F,mt),F[C];let dt=ht.sublevel!=null?ht.sublevel:this,wt=dt.keyEncoding(ht.keyEncoding||ot),St=wt.format;if(ht.key=dt.prefixKey(wt.encode(ht.key),St),ht.keyEncoding=St,ht.type==="put"){let N=this._checkValue(ht.value);if(N)return this.nextTick(F,N),F[C];let $=dt.valueEncoding(ht.valueEncoding||ut);ht.value=$.encode(ht.value),ht.valueEncoding=$.format}dt!==this&&(ht.sublevel=null),Z[rt]=ht}return this._batch(Z,gt,rt=>{if(rt)return F(rt);this.emit("batch",O),F()}),F[C]}_batch(O,W,F){this.nextTick(F)}sublevel(O,W){return this._sublevel(O,st.defaults(W))}_sublevel(O,W){return new st(this,O,W)}prefixKey(O,W){return O}clear(O,W){if(W=k(O,W),W=a(W,C),O=b(O,this[P].empty),this[I]==="opening")return this.defer(()=>this.clear(O,W)),W[C];if(nt(this,W))return W[C];let F=O,Z=this.keyEncoding(O.keyEncoding);return O=U(O,Z),O.keyEncoding=Z.format,O.limit===0?this.nextTick(W):this._clear(O,ot=>{if(ot)return W(ot);this.emit("clear",F),W()}),W[C]}_clear(O,W){this.nextTick(W)}iterator(O){let W=this.keyEncoding(O&&O.keyEncoding),F=this.valueEncoding(O&&O.valueEncoding);if(O=U(O,W),O.keys=O.keys!==!1,O.values=O.values!==!1,O[l.keyEncoding]=W,O[l.valueEncoding]=F,O.keyEncoding=W.format,O.valueEncoding=F.format,this[I]==="opening")return new S(this,O);if(this[I]!=="open")throw new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(O)}_iterator(O){return new l(this,O)}keys(O){let W=this.keyEncoding(O&&O.keyEncoding),F=this.valueEncoding(O&&O.valueEncoding);if(O=U(O,W),O[l.keyEncoding]=W,O[l.valueEncoding]=F,O.keyEncoding=W.format,O.valueEncoding=F.format,this[I]==="opening")return new E(this,O);if(this[I]!=="open")throw new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(O)}_keys(O){return new n(this,O)}values(O){let W=this.keyEncoding(O&&O.keyEncoding),F=this.valueEncoding(O&&O.valueEncoding);if(O=U(O,W),O[l.keyEncoding]=W,O[l.valueEncoding]=F,O.keyEncoding=W.format,O.valueEncoding=F.format,this[I]==="opening")return new L(this,O);if(this[I]!=="open")throw new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(O)}_values(O){return new p(this,O)}defer(O){if(typeof O!="function")throw new TypeError("The first argument must be a function");this[v].push(O)}[w](){if(this[v].length===0)return;let O=this[v];this[v]=[];for(let W of O)W()}attachResource(O){if(typeof O!="object"||O===null||typeof O.close!="function")throw new TypeError("The first argument must be a resource object");this[z].add(O)}detachResource(O){this[z].delete(O)}_chainedBatch(){return new y(this)}_checkKey(O){if(O==null)return new c("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(O){if(O==null)return new c("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};tt.prototype.nextTick=oi();var{AbstractSublevel:st}=li()({AbstractLevel:tt});t.AbstractLevel=tt,t.AbstractSublevel=st;var nt=function(O,W){return O[I]!=="open"?(O.nextTick(W,new c("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},B=function(O){return Object.keys(O.supports.encodings).filter(W=>!!O.supports.encodings[W])}}),Xe=pt(t=>{at(),t.AbstractLevel=gr().AbstractLevel,t.AbstractSublevel=gr().AbstractSublevel,t.AbstractIterator=Xt().AbstractIterator,t.AbstractKeyIterator=Xt().AbstractKeyIterator,t.AbstractValueIterator=Xt().AbstractValueIterator,t.AbstractChainedBatch=jr().AbstractChainedBatch}),ci=pt((t,e)=>{at(),e.exports=i;var r=Dr();function i(a,c,l){if(typeof c!="number")throw new Error("second argument must be a Number");let n,p,S,E,L,y=!0,k;Array.isArray(a)?(n=[],S=p=a.length):(E=Object.keys(a),n={},S=p=E.length);function b(C){function K(){l&&l(C,n),l=null}y?r(K):K()}function U(C,K,z){if(n[C]=z,K&&(L=!0),--S===0||K)b(K);else if(!L&&k<p){let x;E?(x=E[k],k+=1,a[x](function(v,w){U(x,v,w)})):(x=k,k+=1,a[x](function(v,w){U(x,v,w)}))}}k=c,S?E?E.some(function(C,K){return a[C](function(z,x){U(C,z,x)}),K===c-1}):a.some(function(C,K){return C(function(z,x){U(K,z,x)}),K===c-1}):b(null),y=!1}}),Kr=pt((t,e)=>{at(),e.exports=function(r){let i=r.gte!==void 0?r.gte:r.gt!==void 0?r.gt:void 0,a=r.lte!==void 0?r.lte:r.lt!==void 0?r.lt:void 0,c=r.gte===void 0,l=r.lte===void 0;return i!==void 0&&a!==void 0?IDBKeyRange.bound(i,a,c,l):i!==void 0?IDBKeyRange.lowerBound(i,c):a!==void 0?IDBKeyRange.upperBound(a,l):null}}),Wr=pt((t,e)=>{at();var r=new TextEncoder;e.exports=function(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):r.encode(i)}}),ui=pt(t=>{at();var{AbstractIterator:e}=Xe(),r=Kr(),i=Wr(),a=Symbol("cache"),c=Symbol("finished"),l=Symbol("options"),n=Symbol("currentOptions"),p=Symbol("position"),S=Symbol("location"),E=Symbol("first"),L={},y=class extends e{constructor(b,U,C){super(b,C),this[a]=[],this[c]=this.limit===0,this[l]=C,this[n]={...C},this[p]=void 0,this[S]=U,this[E]=!0}_nextv(b,U,C){if(this[E]=!1,this[c])return this.nextTick(C,null,[]);if(this[a].length>0)return b=Math.min(b,this[a].length),this.nextTick(C,null,this[a].splice(0,b));this[p]!==void 0&&(this[l].reverse?(this[n].lt=this[p],this[n].lte=void 0):(this[n].gt=this[p],this[n].gte=void 0));let K;try{K=r(this[n])}catch{return this[c]=!0,this.nextTick(C,null,[])}let z=this.db.db.transaction([this[S]],"readonly"),x=z.objectStore(this[S]),v=[];if(this[l].reverse){let w=!this[l].values&&x.openKeyCursor?"openKeyCursor":"openCursor";x[w](K,"prev").onsuccess=u=>{let T=u.target.result;if(T){let{key:I,value:P}=T;this[p]=I,v.push([this[l].keys&&I!==void 0?i(I):void 0,this[l].values&&P!==void 0?i(P):void 0]),v.length<b?T.continue():k(z)}else this[c]=!0}}else{let w,u,T=()=>{if(w===void 0||u===void 0)return;let I=Math.max(w.length,u.length);I===0||b===1/0?this[c]=!0:this[p]=w[I-1],v.length=I;for(let P=0;P<I;P++){let q=w[P],G=u[P];v[P]=[this[l].keys&&q!==void 0?i(q):void 0,this[l].values&&G!==void 0?i(G):void 0]}k(z)};this[l].keys||b<1/0?x.getAllKeys(K,b<1/0?b:void 0).onsuccess=I=>{w=I.target.result,T()}:(w=[],this.nextTick(T)),this[l].values?x.getAll(K,b<1/0?b:void 0).onsuccess=I=>{u=I.target.result,T()}:(u=[],this.nextTick(T))}z.onabort=()=>{C(z.error||new Error("aborted by user")),C=null},z.oncomplete=()=>{C(null,v),C=null}}_next(b){if(this[a].length>0){let[U,C]=this[a].shift();this.nextTick(b,null,U,C)}else if(this[c])this.nextTick(b);else{let U=Math.min(100,this.limit-this.count);this[E]&&(this[E]=!1,U=1),this._nextv(U,L,(C,K)=>{if(C)return b(C);this[a]=K,this._next(b)})}}_all(b,U){this[E]=!1;let C=this[a].splice(0,this[a].length),K=this.limit-this.count-C.length;if(K<=0)return this.nextTick(U,null,C);this._nextv(K,L,(z,x)=>{if(z)return U(z);C.length>0&&(x=C.concat(x)),U(null,x)})}_seek(b,U){this[E]=!0,this[a]=[],this[c]=!1,this[p]=void 0,this[n]={...this[l]};let C;try{C=r(this[l])}catch{this[c]=!0;return}C!==null&&!C.includes(b)?this[c]=!0:this[l].reverse?this[n].lte=b:this[n].gte=b}};t.Iterator=y;function k(b){typeof b.commit=="function"&&b.commit()}}),hi=pt((t,e)=>{at(),e.exports=function(r,i,a,c,l){if(c.limit===0)return r.nextTick(l);let n=r.db.transaction([i],"readwrite"),p=n.objectStore(i),S=0;n.oncomplete=function(){l()},n.onabort=function(){l(n.error||new Error("aborted by user"))};let E=p.openKeyCursor?"openKeyCursor":"openCursor",L=c.reverse?"prev":"next";p[E](a,L).onsuccess=function(y){let k=y.target.result;k&&(p.delete(k.key).onsuccess=function(){(c.limit<=0||++S<c.limit)&&k.continue()})}}}),fi=pt(t=>{at();var{AbstractLevel:e}=Xe(),r=jt(),i=ci(),{fromCallback:a}=ke(),{Iterator:c}=ui(),l=Wr(),n=hi(),p=Kr(),S="level-js-",E=Symbol("idb"),L=Symbol("namePrefix"),y=Symbol("location"),k=Symbol("version"),b=Symbol("store"),U=Symbol("onComplete"),C=Symbol("promise"),K=class extends e{constructor(z,x,v){if(typeof x=="function"||typeof v=="function")throw new r("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:w,version:u,...T}=x||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},T),typeof z!="string")throw new Error("constructor requires a location string argument");this[y]=z,this[L]=w??S,this[k]=parseInt(u||1,10),this[E]=null}get location(){return this[y]}get namePrefix(){return this[L]}get version(){return this[k]}get db(){return this[E]}get type(){return"browser-level"}_open(z,x){let v=indexedDB.open(this[L]+this[y],this[k]);v.onerror=function(){x(v.error||new Error("unknown error"))},v.onsuccess=()=>{this[E]=v.result,x()},v.onupgradeneeded=w=>{let u=w.target.result;u.objectStoreNames.contains(this[y])||u.createObjectStore(this[y])}}[b](z){return this[E].transaction([this[y]],z).objectStore(this[y])}[U](z,x){let v=z.transaction;v.onabort=function(){x(v.error||new Error("aborted by user"))},v.oncomplete=function(){x(null,z.result)}}_get(z,x,v){let w=this[b]("readonly"),u;try{u=w.get(z)}catch(T){return this.nextTick(v,T)}this[U](u,function(T,I){if(T)return v(T);if(I===void 0)return v(new r("Entry not found",{code:"LEVEL_NOT_FOUND"}));v(null,l(I))})}_getMany(z,x,v){let w=this[b]("readonly"),u=z.map(T=>I=>{let P;try{P=w.get(T)}catch(q){return I(q)}P.onsuccess=()=>{let q=P.result;I(null,q===void 0?q:l(q))},P.onerror=q=>{q.stopPropagation(),I(P.error)}});i(u,16,v)}_del(z,x,v){let w=this[b]("readwrite"),u;try{u=w.delete(z)}catch(T){return this.nextTick(v,T)}this[U](u,v)}_put(z,x,v,w){let u=this[b]("readwrite"),T;try{T=u.put(x,z)}catch(I){return this.nextTick(w,I)}this[U](T,w)}_iterator(z){return new c(this,this[y],z)}_batch(z,x,v){let w=this[b]("readwrite"),u=w.transaction,T=0,I;u.onabort=function(){v(I||u.error||new Error("aborted by user"))},u.oncomplete=function(){v()};function P(){let q=z[T++],G=q.key,et;try{et=q.type==="del"?w.delete(G):w.put(q.value,G)}catch(J){I=J,u.abort();return}T<z.length?et.onsuccess=P:typeof u.commit=="function"&&u.commit()}P()}_clear(z,x){let v,w;try{v=p(z)}catch{return this.nextTick(x)}if(z.limit>=0)return n(this,this[y],v,z,x);try{let u=this[b]("readwrite");w=v?u.delete(v):u.clear()}catch(u){return this.nextTick(x,u)}this[U](w,x)}_close(z){this[E].close(),this.nextTick(z)}};K.destroy=function(z,x,v){typeof x=="function"&&(v=x,x=S),v=a(v,C);let w=indexedDB.deleteDatabase(x+z);return w.onsuccess=function(){v()},w.onerror=function(u){v(u)},v[C]},t.BrowserLevel=K}),gi=pt(t=>{at(),t.Level=fi().BrowserLevel}),di=pt((t,e)=>{at(),e.exports=z;var r=0,i=1;function a(x,v,w,u,T,I){this._color=x,this.key=v,this.value=w,this.left=u,this.right=T,this._count=I}function c(x){return new a(x._color,x.key,x.value,x.left,x.right,x._count)}function l(x,v){return new a(x,v.key,v.value,v.left,v.right,v._count)}function n(x){x._count=1+(x.left?x.left._count:0)+(x.right?x.right._count:0)}function p(x,v){this._compare=x,this.root=v}var S=p.prototype;Object.defineProperty(S,"keys",{get:function(){var x=[];return this.forEach(function(v,w){x.push(v)}),x}}),Object.defineProperty(S,"values",{get:function(){var x=[];return this.forEach(function(v,w){x.push(w)}),x}}),Object.defineProperty(S,"length",{get:function(){return this.root?this.root._count:0}}),S.insert=function(x,v){for(var w=this._compare,u=this.root,T=[],I=[];u;){var P=w(x,u.key);T.push(u),I.push(P),P<=0?u=u.left:u=u.right}T.push(new a(r,x,v,null,null,1));for(var q=T.length-2;q>=0;--q){var u=T[q];I[q]<=0?T[q]=new a(u._color,u.key,u.value,T[q+1],u.right,u._count+1):T[q]=new a(u._color,u.key,u.value,u.left,T[q+1],u._count+1)}for(var q=T.length-1;q>1;--q){var G=T[q-1],u=T[q];if(G._color===i||u._color===i)break;var et=T[q-2];if(et.left===G)if(G.left===u){var J=et.right;if(J&&J._color===r)G._color=i,et.right=l(i,J),et._color=r,q-=1;else{if(et._color=r,et.left=G.right,G._color=i,G.right=et,T[q-2]=G,T[q-1]=u,n(et),n(G),q>=3){var tt=T[q-3];tt.left===et?tt.left=G:tt.right=G}break}}else{var J=et.right;if(J&&J._color===r)G._color=i,et.right=l(i,J),et._color=r,q-=1;else{if(G.right=u.left,et._color=r,et.left=u.right,u._color=i,u.left=G,u.right=et,T[q-2]=u,T[q-1]=G,n(et),n(G),n(u),q>=3){var tt=T[q-3];tt.left===et?tt.left=u:tt.right=u}break}}else if(G.right===u){var J=et.left;if(J&&J._color===r)G._color=i,et.left=l(i,J),et._color=r,q-=1;else{if(et._color=r,et.right=G.left,G._color=i,G.left=et,T[q-2]=G,T[q-1]=u,n(et),n(G),q>=3){var tt=T[q-3];tt.right===et?tt.right=G:tt.left=G}break}}else{var J=et.left;if(J&&J._color===r)G._color=i,et.left=l(i,J),et._color=r,q-=1;else{if(G.left=u.right,et._color=r,et.right=u.left,u._color=i,u.right=G,u.left=et,T[q-2]=u,T[q-1]=G,n(et),n(G),n(u),q>=3){var tt=T[q-3];tt.right===et?tt.right=u:tt.left=u}break}}}return T[0]._color=i,new p(w,T[0])};function E(x,v){if(v.left){var w=E(x,v.left);if(w)return w}var w=x(v.key,v.value);if(w)return w;if(v.right)return E(x,v.right)}function L(x,v,w,u){var T=v(x,u.key);if(T<=0){if(u.left){var I=L(x,v,w,u.left);if(I)return I}var I=w(u.key,u.value);if(I)return I}if(u.right)return L(x,v,w,u.right)}function y(x,v,w,u,T){var I=w(x,T.key),P=w(v,T.key),q;if(I<=0&&(T.left&&(q=y(x,v,w,u,T.left),q)||P>0&&(q=u(T.key,T.value),q)))return q;if(P>0&&T.right)return y(x,v,w,u,T.right)}S.forEach=function(x,v,w){if(this.root)switch(arguments.length){case 1:return E(x,this.root);case 2:return L(v,this._compare,x,this.root);case 3:return this._compare(v,w)>=0?void 0:y(v,w,this._compare,x,this.root)}},Object.defineProperty(S,"begin",{get:function(){for(var x=[],v=this.root;v;)x.push(v),v=v.left;return new k(this,x)}}),Object.defineProperty(S,"end",{get:function(){for(var x=[],v=this.root;v;)x.push(v),v=v.right;return new k(this,x)}}),S.at=function(x){if(x<0)return new k(this,[]);for(var v=this.root,w=[];;){if(w.push(v),v.left){if(x<v.left._count){v=v.left;continue}x-=v.left._count}if(!x)return new k(this,w);if(x-=1,v.right){if(x>=v.right._count)break;v=v.right}else break}return new k(this,[])},S.ge=function(x){for(var v=this._compare,w=this.root,u=[],T=0;w;){var I=v(x,w.key);u.push(w),I<=0&&(T=u.length),I<=0?w=w.left:w=w.right}return u.length=T,new k(this,u)},S.gt=function(x){for(var v=this._compare,w=this.root,u=[],T=0;w;){var I=v(x,w.key);u.push(w),I<0&&(T=u.length),I<0?w=w.left:w=w.right}return u.length=T,new k(this,u)},S.lt=function(x){for(var v=this._compare,w=this.root,u=[],T=0;w;){var I=v(x,w.key);u.push(w),I>0&&(T=u.length),I<=0?w=w.left:w=w.right}return u.length=T,new k(this,u)},S.le=function(x){for(var v=this._compare,w=this.root,u=[],T=0;w;){var I=v(x,w.key);u.push(w),I>=0&&(T=u.length),I<0?w=w.left:w=w.right}return u.length=T,new k(this,u)},S.find=function(x){for(var v=this._compare,w=this.root,u=[];w;){var T=v(x,w.key);if(u.push(w),T===0)return new k(this,u);T<=0?w=w.left:w=w.right}return new k(this,[])},S.remove=function(x){var v=this.find(x);return v?v.remove():this},S.get=function(x){for(var v=this._compare,w=this.root;w;){var u=v(x,w.key);if(u===0)return w.value;u<=0?w=w.left:w=w.right}};function k(x,v){this.tree=x,this._stack=v}var b=k.prototype;Object.defineProperty(b,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(b,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),b.clone=function(){return new k(this.tree,this._stack.slice())};function U(x,v){x.key=v.key,x.value=v.value,x.left=v.left,x.right=v.right,x._color=v._color,x._count=v._count}function C(x){for(var v,w,u,T,I=x.length-1;I>=0;--I){if(v=x[I],I===0){v._color=i;return}if(w=x[I-1],w.left===v){if(u=w.right,u.right&&u.right._color===r){if(u=w.right=c(u),T=u.right=c(u.right),w.right=u.left,u.left=w,u.right=T,u._color=w._color,v._color=i,w._color=i,T._color=i,n(w),n(u),I>1){var P=x[I-2];P.left===w?P.left=u:P.right=u}x[I-1]=u;return}else if(u.left&&u.left._color===r){if(u=w.right=c(u),T=u.left=c(u.left),w.right=T.left,u.left=T.right,T.left=w,T.right=u,T._color=w._color,w._color=i,u._color=i,v._color=i,n(w),n(u),n(T),I>1){var P=x[I-2];P.left===w?P.left=T:P.right=T}x[I-1]=T;return}if(u._color===i)if(w._color===r){w._color=i,w.right=l(r,u);return}else{w.right=l(r,u);continue}else{if(u=c(u),w.right=u.left,u.left=w,u._color=w._color,w._color=r,n(w),n(u),I>1){var P=x[I-2];P.left===w?P.left=u:P.right=u}x[I-1]=u,x[I]=w,I+1<x.length?x[I+1]=v:x.push(v),I=I+2}}else{if(u=w.left,u.left&&u.left._color===r){if(u=w.left=c(u),T=u.left=c(u.left),w.left=u.right,u.right=w,u.left=T,u._color=w._color,v._color=i,w._color=i,T._color=i,n(w),n(u),I>1){var P=x[I-2];P.right===w?P.right=u:P.left=u}x[I-1]=u;return}else if(u.right&&u.right._color===r){if(u=w.left=c(u),T=u.right=c(u.right),w.left=T.right,u.right=T.left,T.right=w,T.left=u,T._color=w._color,w._color=i,u._color=i,v._color=i,n(w),n(u),n(T),I>1){var P=x[I-2];P.right===w?P.right=T:P.left=T}x[I-1]=T;return}if(u._color===i)if(w._color===r){w._color=i,w.left=l(r,u);return}else{w.left=l(r,u);continue}else{if(u=c(u),w.left=u.right,u.right=w,u._color=w._color,w._color=r,n(w),n(u),I>1){var P=x[I-2];P.right===w?P.right=u:P.left=u}x[I-1]=u,x[I]=w,I+1<x.length?x[I+1]=v:x.push(v),I=I+2}}}}b.remove=function(){var x=this._stack;if(x.length===0)return this.tree;var v=new Array(x.length),w=x[x.length-1];v[v.length-1]=new a(w._color,w.key,w.value,w.left,w.right,w._count);for(var u=x.length-2;u>=0;--u){var w=x[u];w.left===x[u+1]?v[u]=new a(w._color,w.key,w.value,v[u+1],w.right,w._count):v[u]=new a(w._color,w.key,w.value,w.left,v[u+1],w._count)}if(w=v[v.length-1],w.left&&w.right){var T=v.length;for(w=w.left;w.right;)v.push(w),w=w.right;var I=v[T-1];v.push(new a(w._color,I.key,I.value,w.left,w.right,w._count)),v[T-1].key=w.key,v[T-1].value=w.value;for(var u=v.length-2;u>=T;--u)w=v[u],v[u]=new a(w._color,w.key,w.value,w.left,v[u+1],w._count);v[T-1].left=v[T]}if(w=v[v.length-1],w._color===r){var P=v[v.length-2];P.left===w?P.left=null:P.right===w&&(P.right=null),v.pop();for(var u=0;u<v.length;++u)v[u]._count--;return new p(this.tree._compare,v[0])}else if(w.left||w.right){w.left?U(w,w.left):w.right&&U(w,w.right),w._color=i;for(var u=0;u<v.length-1;++u)v[u]._count--;return new p(this.tree._compare,v[0])}else{if(v.length===1)return new p(this.tree._compare,null);for(var u=0;u<v.length;++u)v[u]._count--;var q=v[v.length-2];C(v),q.left===w?q.left=null:q.right=null}return new p(this.tree._compare,v[0])},Object.defineProperty(b,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(b,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(b,"index",{get:function(){var x=0,v=this._stack;if(v.length===0){var w=this.tree.root;return w?w._count:0}else v[v.length-1].left&&(x=v[v.length-1].left._count);for(var u=v.length-2;u>=0;--u)v[u+1]===v[u].right&&(++x,v[u].left&&(x+=v[u].left._count));return x},enumerable:!0}),b.next=function(){var x=this._stack;if(x.length!==0){var v=x[x.length-1];if(v.right)for(v=v.right;v;)x.push(v),v=v.left;else for(x.pop();x.length>0&&x[x.length-1].right===v;)v=x[x.length-1],x.pop()}},Object.defineProperty(b,"hasNext",{get:function(){var x=this._stack;if(x.length===0)return!1;if(x[x.length-1].right)return!0;for(var v=x.length-1;v>0;--v)if(x[v-1].left===x[v])return!0;return!1}}),b.update=function(x){var v=this._stack;if(v.length===0)throw new Error("Can't update empty node!");var w=new Array(v.length),u=v[v.length-1];w[w.length-1]=new a(u._color,u.key,x,u.left,u.right,u._count);for(var T=v.length-2;T>=0;--T)u=v[T],u.left===v[T+1]?w[T]=new a(u._color,u.key,u.value,w[T+1],u.right,u._count):w[T]=new a(u._color,u.key,u.value,u.left,w[T+1],u._count);return new p(this.tree._compare,w[0])},b.prev=function(){var x=this._stack;if(x.length!==0){var v=x[x.length-1];if(v.left)for(v=v.left;v;)x.push(v),v=v.right;else for(x.pop();x.length>0&&x[x.length-1].left===v;)v=x[x.length-1],x.pop()}},Object.defineProperty(b,"hasPrev",{get:function(){var x=this._stack;if(x.length===0)return!1;if(x[x.length-1].left)return!0;for(var v=x.length-1;v>0;--v)if(x[v-1].right===x[v])return!0;return!1}});function K(x,v){return x<v?-1:x>v?1:0}function z(x){return new p(x||K,null)}}),pi=pt(t=>{at();var{AbstractLevel:e,AbstractIterator:r,AbstractKeyIterator:i,AbstractValueIterator:a}=Xe(),c=jt(),l=di(),n=new Set(["gt","gte","lt","lte"]),p=Symbol("none"),S=Symbol("tree"),E=Symbol("iterator"),L=Symbol("lowerBound"),y=Symbol("upperBound"),k=Symbol("outOfRange"),b=Symbol("reverse"),U=Symbol("options"),C=Symbol("test"),K=Symbol("advance"),z=Symbol("init");function x(J,tt){if(typeof J=="string")return J<tt?-1:J>tt?1:0;let st=Math.min(J.byteLength,tt.byteLength);for(let nt=0;nt<st;nt++){let B=J[nt]-tt[nt];if(B!==0)return B}return J.byteLength-tt.byteLength}function v(J){return x(J,this[y])>0}function w(J){return x(J,this[y])>=0}function u(J){return x(J,this[y])<0}function T(J){return x(J,this[y])<=0}var I=class extends r{constructor(J,tt){super(J,tt),this[z](J[S],tt)}_next(J){if(!this[E].valid)return this.nextTick(J);let tt=this[E].key,st=this[E].value;if(!this[C](tt))return this.nextTick(J);this[E][this[K]](),this.nextTick(J,null,tt,st)}_nextv(J,tt,st){let nt=this[E],B=[];for(;nt.valid&&B.length<J&&this[C](nt.key);)B.push([nt.key,nt.value]),nt[this[K]]();this.nextTick(st,null,B)}_all(J,tt){let st=this.limit-this.count,nt=this[E],B=[];for(;nt.valid&&B.length<st&&this[C](nt.key);)B.push([nt.key,nt.value]),nt[this[K]]();this.nextTick(tt,null,B)}},P=class extends i{constructor(J,tt){super(J,tt),this[z](J[S],tt)}_next(J){if(!this[E].valid)return this.nextTick(J);let tt=this[E].key;if(!this[C](tt))return this.nextTick(J);this[E][this[K]](),this.nextTick(J,null,tt)}_nextv(J,tt,st){let nt=this[E],B=[];for(;nt.valid&&B.length<J&&this[C](nt.key);)B.push(nt.key),nt[this[K]]();this.nextTick(st,null,B)}_all(J,tt){let st=this.limit-this.count,nt=this[E],B=[];for(;nt.valid&&B.length<st&&this[C](nt.key);)B.push(nt.key),nt[this[K]]();this.nextTick(tt,null,B)}},q=class extends a{constructor(J,tt){super(J,tt),this[z](J[S],tt)}_next(J){if(!this[E].valid)return this.nextTick(J);let tt=this[E].key,st=this[E].value;if(!this[C](tt))return this.nextTick(J);this[E][this[K]](),this.nextTick(J,null,st)}_nextv(J,tt,st){let nt=this[E],B=[];for(;nt.valid&&B.length<J&&this[C](nt.key);)B.push(nt.value),nt[this[K]]();this.nextTick(st,null,B)}_all(J,tt){let st=this.limit-this.count,nt=this[E],B=[];for(;nt.valid&&B.length<st&&this[C](nt.key);)B.push(nt.value),nt[this[K]]();this.nextTick(tt,null,B)}};for(let J of[I,P,q])J.prototype[z]=function(tt,st){this[b]=st.reverse,this[U]=st,this[b]?(this[K]="prev",this[L]="lte"in st?st.lte:"lt"in st?st.lt:p,this[y]="gte"in st?st.gte:"gt"in st?st.gt:p,this[L]===p?this[E]=tt.end:"lte"in st?this[E]=tt.le(this[L]):this[E]=tt.lt(this[L]),this[y]!==p&&(this[C]="gte"in st?w:v)):(this[K]="next",this[L]="gte"in st?st.gte:"gt"in st?st.gt:p,this[y]="lte"in st?st.lte:"lt"in st?st.lt:p,this[L]===p?this[E]=tt.begin:"gte"in st?this[E]=tt.ge(this[L]):this[E]=tt.gt(this[L]),this[y]!==p&&(this[C]="lte"in st?T:u))},J.prototype[C]=function(){return!0},J.prototype[k]=function(tt){return this[C](tt)?this[L]===p?!1:this[b]?"lte"in this[U]?x(tt,this[L])>0:x(tt,this[L])>=0:"gte"in this[U]?x(tt,this[L])<0:x(tt,this[L])<=0:!0},J.prototype._seek=function(tt,st){this[k](tt)?(this[E]=this[E].tree.end,this[E].next()):this[b]?this[E]=this[E].tree.le(tt):this[E]=this[E].tree.ge(tt)};var G=class extends e{constructor(J,tt,st){if(typeof J=="object"&&J!==null&&(tt=J),typeof J=="function"||typeof tt=="function"||typeof st=="function")throw new c("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{storeEncoding:nt,...B}=tt||{};if(nt=nt||"buffer",!["buffer","view","utf8"].includes(nt))throw new c("The storeEncoding option must be 'buffer', 'view' or 'utf8'",{code:"LEVEL_ENCODING_NOT_SUPPORTED"});super({seek:!0,permanence:!1,createIfMissing:!1,errorIfExists:!1,encodings:{[nt]:!0}},B),this[S]=l(x)}_put(J,tt,st,nt){let B=this[S].find(J);B.valid?this[S]=B.update(tt):this[S]=this[S].insert(J,tt),this.nextTick(nt)}_get(J,tt,st){let nt=this[S].get(J);if(typeof nt>"u")return this.nextTick(st,new Error("NotFound"));this.nextTick(st,null,nt)}_getMany(J,tt,st){this.nextTick(st,null,J.map(nt=>this[S].get(nt)))}_del(J,tt,st){this[S]=this[S].remove(J),this.nextTick(st)}_batch(J,tt,st){let nt=this[S];for(let B of J){let O=B.key,W=nt.find(O);B.type==="put"?nt=W.valid?W.update(B.value):nt.insert(O,B.value):nt=W.remove()}this[S]=nt,this.nextTick(st)}_clear(J,tt){if(J.limit===-1&&!Object.keys(J).some(et))return this[S]=l(x),this.nextTick(tt);let st=this._keys({...J}),nt=st.limit,B=0,O=()=>{for(let W=0;W<500;W++){if(++B>nt||!st[E].valid||!st[C](st[E].key))return tt();this[S]=this[S].remove(st[E].key),st[E][st[K]]()}this.nextTick(O)};this.nextTick(O)}_iterator(J){return new I(this,J)}_keys(J){return new P(this,J)}_values(J){return new q(this,J)}};if(t.MemoryLevel=G,typeof Jt.default<"u"&&!Jt.default.browser&&typeof Yt<"u"&&typeof Yt.setImmediate=="function"){let J=Yt.setImmediate;G.prototype.nextTick=function(tt,...st){st.length===0?J(tt):J(()=>tt(...st))}}function et(J){return n.has(J)}}),te=pt((t,e)=>{at(),typeof window<"u"?(window.global=window,Yt.fetch=window.fetch,e.exports={Buffer:oe().Buffer,Crypto:window.crypto}):e.exports={Buffer:oe().Buffer,Crypto:crypto}}),Fr=pt((t,e)=>{at(),function(r){var i,a=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,c=Math.ceil,l=Math.floor,n="[BigNumber Error] ",p=n+"Number primitive has more than 15 significant digits: ",S=1e14,E=14,L=9007199254740991,y=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],k=1e7,b=1e9;function U(T){var I,P,q,G=rt.prototype={constructor:rt,toString:null,valueOf:null},et=new rt(1),J=20,tt=4,st=-7,nt=21,B=-1e7,O=1e7,W=!1,F=1,Z=0,ot={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},ut="0123456789abcdefghijklmnopqrstuvwxyz",gt=!0;function rt(N,$){var M,X,H,s,h,d,A,R,f=this;if(!(f instanceof rt))return new rt(N,$);if($==null){if(N&&N._isBigNumber===!0){f.s=N.s,!N.c||N.e>O?f.c=f.e=null:N.e<B?f.c=[f.e=0]:(f.e=N.e,f.c=N.c.slice());return}if((d=typeof N=="number")&&N*0==0){if(f.s=1/N<0?(N=-N,-1):1,N===~~N){for(s=0,h=N;h>=10;h/=10,s++);s>O?f.c=f.e=null:(f.e=s,f.c=[N]);return}R=String(N)}else{if(!a.test(R=String(N)))return q(f,R,d);f.s=R.charCodeAt(0)==45?(R=R.slice(1),-1):1}(s=R.indexOf("."))>-1&&(R=R.replace(".","")),(h=R.search(/e/i))>0?(s<0&&(s=h),s+=+R.slice(h+1),R=R.substring(0,h)):s<0&&(s=R.length)}else{if(x($,2,ut.length,"Base"),$==10&&gt)return f=new rt(N),wt(f,J+f.e+1,tt);if(R=String(N),d=typeof N=="number"){if(N*0!=0)return q(f,R,d,$);if(f.s=1/N<0?(R=R.slice(1),-1):1,rt.DEBUG&&R.replace(/^0\.0*|\./,"").length>15)throw Error(p+N)}else f.s=R.charCodeAt(0)===45?(R=R.slice(1),-1):1;for(M=ut.slice(0,$),s=h=0,A=R.length;h<A;h++)if(M.indexOf(X=R.charAt(h))<0){if(X=="."){if(h>s){s=A;continue}}else if(!H&&(R==R.toUpperCase()&&(R=R.toLowerCase())||R==R.toLowerCase()&&(R=R.toUpperCase()))){H=!0,h=-1,s=0;continue}return q(f,String(N),d,$)}d=!1,R=P(R,$,10,f.s),(s=R.indexOf("."))>-1?R=R.replace(".",""):s=R.length}for(h=0;R.charCodeAt(h)===48;h++);for(A=R.length;R.charCodeAt(--A)===48;);if(R=R.slice(h,++A)){if(A-=h,d&&rt.DEBUG&&A>15&&(N>L||N!==l(N)))throw Error(p+f.s*N);if((s=s-h-1)>O)f.c=f.e=null;else if(s<B)f.c=[f.e=0];else{if(f.e=s,f.c=[],h=(s+1)%E,s<0&&(h+=E),h<A){for(h&&f.c.push(+R.slice(0,h)),A-=E;h<A;)f.c.push(+R.slice(h,h+=E));h=E-(R=R.slice(h)).length}else h-=A;for(;h--;R+="0");f.c.push(+R)}}else f.c=[f.e=0]}rt.clone=U,rt.ROUND_UP=0,rt.ROUND_DOWN=1,rt.ROUND_CEIL=2,rt.ROUND_FLOOR=3,rt.ROUND_HALF_UP=4,rt.ROUND_HALF_DOWN=5,rt.ROUND_HALF_EVEN=6,rt.ROUND_HALF_CEIL=7,rt.ROUND_HALF_FLOOR=8,rt.EUCLID=9,rt.config=rt.set=function(N){var $,M;if(N!=null)if(typeof N=="object"){if(N.hasOwnProperty($="DECIMAL_PLACES")&&(M=N[$],x(M,0,b,$),J=M),N.hasOwnProperty($="ROUNDING_MODE")&&(M=N[$],x(M,0,8,$),tt=M),N.hasOwnProperty($="EXPONENTIAL_AT")&&(M=N[$],M&&M.pop?(x(M[0],-b,0,$),x(M[1],0,b,$),st=M[0],nt=M[1]):(x(M,-b,b,$),st=-(nt=M<0?-M:M))),N.hasOwnProperty($="RANGE"))if(M=N[$],M&&M.pop)x(M[0],-b,-1,$),x(M[1],1,b,$),B=M[0],O=M[1];else if(x(M,-b,b,$),M)B=-(O=M<0?-M:M);else throw Error(n+$+" cannot be zero: "+M);if(N.hasOwnProperty($="CRYPTO"))if(M=N[$],M===!!M)if(M)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))W=M;else throw W=!M,Error(n+"crypto unavailable");else W=M;else throw Error(n+$+" not true or false: "+M);if(N.hasOwnProperty($="MODULO_MODE")&&(M=N[$],x(M,0,9,$),F=M),N.hasOwnProperty($="POW_PRECISION")&&(M=N[$],x(M,0,b,$),Z=M),N.hasOwnProperty($="FORMAT"))if(M=N[$],typeof M=="object")ot=M;else throw Error(n+$+" not an object: "+M);if(N.hasOwnProperty($="ALPHABET"))if(M=N[$],typeof M=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(M))gt=M.slice(0,10)=="0123456789",ut=M;else throw Error(n+$+" invalid: "+M)}else throw Error(n+"Object expected: "+N);return{DECIMAL_PLACES:J,ROUNDING_MODE:tt,EXPONENTIAL_AT:[st,nt],RANGE:[B,O],CRYPTO:W,MODULO_MODE:F,POW_PRECISION:Z,FORMAT:ot,ALPHABET:ut}},rt.isBigNumber=function(N){if(!N||N._isBigNumber!==!0)return!1;if(!rt.DEBUG)return!0;var $,M,X=N.c,H=N.e,s=N.s;t:if({}.toString.call(X)=="[object Array]"){if((s===1||s===-1)&&H>=-b&&H<=b&&H===l(H)){if(X[0]===0){if(H===0&&X.length===1)return!0;break t}if($=(H+1)%E,$<1&&($+=E),String(X[0]).length==$){for($=0;$<X.length;$++)if(M=X[$],M<0||M>=S||M!==l(M))break t;if(M!==0)return!0}}}else if(X===null&&H===null&&(s===null||s===1||s===-1))return!0;throw Error(n+"Invalid BigNumber: "+N)},rt.maximum=rt.max=function(){return mt(arguments,G.lt)},rt.minimum=rt.min=function(){return mt(arguments,G.gt)},rt.random=function(){var N=9007199254740992,$=Math.random()*N&2097151?function(){return l(Math.random()*N)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(M){var X,H,s,h,d,A=0,R=[],f=new rt(et);if(M==null?M=J:x(M,0,b),h=c(M/E),W)if(crypto.getRandomValues){for(X=crypto.getRandomValues(new Uint32Array(h*=2));A<h;)d=X[A]*131072+(X[A+1]>>>11),d>=9e15?(H=crypto.getRandomValues(new Uint32Array(2)),X[A]=H[0],X[A+1]=H[1]):(R.push(d%1e14),A+=2);A=h/2}else if(crypto.randomBytes){for(X=crypto.randomBytes(h*=7);A<h;)d=(X[A]&31)*281474976710656+X[A+1]*1099511627776+X[A+2]*4294967296+X[A+3]*16777216+(X[A+4]<<16)+(X[A+5]<<8)+X[A+6],d>=9e15?crypto.randomBytes(7).copy(X,A):(R.push(d%1e14),A+=7);A=h/7}else throw W=!1,Error(n+"crypto unavailable");if(!W)for(;A<h;)d=$(),d<9e15&&(R[A++]=d%1e14);for(h=R[--A],M%=E,h&&M&&(d=y[E-M],R[A]=l(h/d)*d);R[A]===0;R.pop(),A--);if(A<0)R=[s=0];else{for(s=-1;R[0]===0;R.splice(0,1),s-=E);for(A=1,d=R[0];d>=10;d/=10,A++);A<E&&(s-=E-A)}return f.e=s,f.c=R,f}}(),rt.sum=function(){for(var N=1,$=arguments,M=new rt($[0]);N<$.length;)M=M.plus($[N++]);return M},P=function(){var N="0123456789";function $(M,X,H,s){for(var h,d=[0],A,R=0,f=M.length;R<f;){for(A=d.length;A--;d[A]*=X);for(d[0]+=s.indexOf(M.charAt(R++)),h=0;h<d.length;h++)d[h]>H-1&&(d[h+1]==null&&(d[h+1]=0),d[h+1]+=d[h]/H|0,d[h]%=H)}return d.reverse()}return function(M,X,H,s,h){var d,A,R,f,_,D,Y,lt,ft=M.indexOf("."),o=J,g=tt;for(ft>=0&&(f=Z,Z=0,M=M.replace(".",""),lt=new rt(X),D=lt.pow(M.length-ft),Z=f,lt.c=$(u(K(D.c),D.e,"0"),10,H,N),lt.e=lt.c.length),Y=$(M,X,H,h?(d=ut,N):(d=N,ut)),R=f=Y.length;Y[--f]==0;Y.pop());if(!Y[0])return d.charAt(0);if(ft<0?--R:(D.c=Y,D.e=R,D.s=s,D=I(D,lt,o,g,H),Y=D.c,_=D.r,R=D.e),A=R+o+1,ft=Y[A],f=H/2,_=_||A<0||Y[A+1]!=null,_=g<4?(ft!=null||_)&&(g==0||g==(D.s<0?3:2)):ft>f||ft==f&&(g==4||_||g==6&&Y[A-1]&1||g==(D.s<0?8:7)),A<1||!Y[0])M=_?u(d.charAt(1),-o,d.charAt(0)):d.charAt(0);else{if(Y.length=A,_)for(--H;++Y[--A]>H;)Y[A]=0,A||(++R,Y=[1].concat(Y));for(f=Y.length;!Y[--f];);for(ft=0,M="";ft<=f;M+=d.charAt(Y[ft++]));M=u(M,R,d.charAt(0))}return M}}(),I=function(){function N(X,H,s){var h,d,A,R,f=0,_=X.length,D=H%k,Y=H/k|0;for(X=X.slice();_--;)A=X[_]%k,R=X[_]/k|0,h=Y*A+R*D,d=D*A+h%k*k+f,f=(d/s|0)+(h/k|0)+Y*R,X[_]=d%s;return f&&(X=[f].concat(X)),X}function $(X,H,s,h){var d,A;if(s!=h)A=s>h?1:-1;else for(d=A=0;d<s;d++)if(X[d]!=H[d]){A=X[d]>H[d]?1:-1;break}return A}function M(X,H,s,h){for(var d=0;s--;)X[s]-=d,d=X[s]<H[s]?1:0,X[s]=d*h+X[s]-H[s];for(;!X[0]&&X.length>1;X.splice(0,1));}return function(X,H,s,h,d){var A,R,f,_,D,Y,lt,ft,o,g,m,V,Q,it,ct,Et,kt,Tt=X.s==H.s?1:-1,vt=X.c,bt=H.c;if(!vt||!vt[0]||!bt||!bt[0])return new rt(!X.s||!H.s||(vt?bt&&vt[0]==bt[0]:!bt)?NaN:vt&&vt[0]==0||!bt?Tt*0:Tt/0);for(ft=new rt(Tt),o=ft.c=[],R=X.e-H.e,Tt=s+R+1,d||(d=S,R=C(X.e/E)-C(H.e/E),Tt=Tt/E|0),f=0;bt[f]==(vt[f]||0);f++);if(bt[f]>(vt[f]||0)&&R--,Tt<0)o.push(1),_=!0;else{for(it=vt.length,Et=bt.length,f=0,Tt+=2,D=l(d/(bt[0]+1)),D>1&&(bt=N(bt,D,d),vt=N(vt,D,d),Et=bt.length,it=vt.length),Q=Et,g=vt.slice(0,Et),m=g.length;m<Et;g[m++]=0);kt=bt.slice(),kt=[0].concat(kt),ct=bt[0],bt[1]>=d/2&&ct++;do{if(D=0,A=$(bt,g,Et,m),A<0){if(V=g[0],Et!=m&&(V=V*d+(g[1]||0)),D=l(V/ct),D>1)for(D>=d&&(D=d-1),Y=N(bt,D,d),lt=Y.length,m=g.length;$(Y,g,lt,m)==1;)D--,M(Y,Et<lt?kt:bt,lt,d),lt=Y.length,A=1;else D==0&&(A=D=1),Y=bt.slice(),lt=Y.length;if(lt<m&&(Y=[0].concat(Y)),M(g,Y,m,d),m=g.length,A==-1)for(;$(bt,g,Et,m)<1;)D++,M(g,Et<m?kt:bt,m,d),m=g.length}else A===0&&(D++,g=[0]);o[f++]=D,g[0]?g[m++]=vt[Q]||0:(g=[vt[Q]],m=1)}while((Q++<it||g[0]!=null)&&Tt--);_=g[0]!=null,o[0]||o.splice(0,1)}if(d==S){for(f=1,Tt=o[0];Tt>=10;Tt/=10,f++);wt(ft,s+(ft.e=f+R*E-1)+1,h,_)}else ft.e=R,ft.r=+_;return ft}}();function ht(N,$,M,X){var H,s,h,d,A;if(M==null?M=tt:x(M,0,8),!N.c)return N.toString();if(H=N.c[0],h=N.e,$==null)A=K(N.c),A=X==1||X==2&&(h<=st||h>=nt)?w(A,h):u(A,h,"0");else if(N=wt(new rt(N),$,M),s=N.e,A=K(N.c),d=A.length,X==1||X==2&&($<=s||s<=st)){for(;d<$;A+="0",d++);A=w(A,s)}else if($-=h,A=u(A,s,"0"),s+1>d){if(--$>0)for(A+=".";$--;A+="0");}else if($+=s-d,$>0)for(s+1==d&&(A+=".");$--;A+="0");return N.s<0&&H?"-"+A:A}function mt(N,$){for(var M,X=1,H=new rt(N[0]);X<N.length;X++)if(M=new rt(N[X]),M.s)$.call(H,M)&&(H=M);else{H=M;break}return H}function dt(N,$,M){for(var X=1,H=$.length;!$[--H];$.pop());for(H=$[0];H>=10;H/=10,X++);return(M=X+M*E-1)>O?N.c=N.e=null:M<B?N.c=[N.e=0]:(N.e=M,N.c=$),N}q=function(){var N=/^(-?)0([xbo])(?=\w[\w.]*$)/i,$=/^([^.]+)\.$/,M=/^\.([^.]+)$/,X=/^-?(Infinity|NaN)$/,H=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(s,h,d,A){var R,f=d?h:h.replace(H,"");if(X.test(f))s.s=isNaN(f)?null:f<0?-1:1;else{if(!d&&(f=f.replace(N,function(_,D,Y){return R=(Y=Y.toLowerCase())=="x"?16:Y=="b"?2:8,!A||A==R?D:_}),A&&(R=A,f=f.replace($,"$1").replace(M,"0.$1")),h!=f))return new rt(f,R);if(rt.DEBUG)throw Error(n+"Not a"+(A?" base "+A:"")+" number: "+h);s.s=null}s.c=s.e=null}}();function wt(N,$,M,X){var H,s,h,d,A,R,f,_=N.c,D=y;if(_){t:{for(H=1,d=_[0];d>=10;d/=10,H++);if(s=$-H,s<0)s+=E,h=$,A=_[R=0],f=A/D[H-h-1]%10|0;else if(R=c((s+1)/E),R>=_.length)if(X){for(;_.length<=R;_.push(0));A=f=0,H=1,s%=E,h=s-E+1}else break t;else{for(A=d=_[R],H=1;d>=10;d/=10,H++);s%=E,h=s-E+H,f=h<0?0:A/D[H-h-1]%10|0}if(X=X||$<0||_[R+1]!=null||(h<0?A:A%D[H-h-1]),X=M<4?(f||X)&&(M==0||M==(N.s<0?3:2)):f>5||f==5&&(M==4||X||M==6&&(s>0?h>0?A/D[H-h]:0:_[R-1])%10&1||M==(N.s<0?8:7)),$<1||!_[0])return _.length=0,X?($-=N.e+1,_[0]=D[(E-$%E)%E],N.e=-$||0):_[0]=N.e=0,N;if(s==0?(_.length=R,d=1,R--):(_.length=R+1,d=D[E-s],_[R]=h>0?l(A/D[H-h]%D[h])*d:0),X)for(;;)if(R==0){for(s=1,h=_[0];h>=10;h/=10,s++);for(h=_[0]+=d,d=1;h>=10;h/=10,d++);s!=d&&(N.e++,_[0]==S&&(_[0]=1));break}else{if(_[R]+=d,_[R]!=S)break;_[R--]=0,d=1}for(s=_.length;_[--s]===0;_.pop());}N.e>O?N.c=N.e=null:N.e<B&&(N.c=[N.e=0])}return N}function St(N){var $,M=N.e;return M===null?N.toString():($=K(N.c),$=M<=st||M>=nt?w($,M):u($,M,"0"),N.s<0?"-"+$:$)}return G.absoluteValue=G.abs=function(){var N=new rt(this);return N.s<0&&(N.s=1),N},G.comparedTo=function(N,$){return z(this,new rt(N,$))},G.decimalPlaces=G.dp=function(N,$){var M,X,H,s=this;if(N!=null)return x(N,0,b),$==null?$=tt:x($,0,8),wt(new rt(s),N+s.e+1,$);if(!(M=s.c))return null;if(X=((H=M.length-1)-C(this.e/E))*E,H=M[H])for(;H%10==0;H/=10,X--);return X<0&&(X=0),X},G.dividedBy=G.div=function(N,$){return I(this,new rt(N,$),J,tt)},G.dividedToIntegerBy=G.idiv=function(N,$){return I(this,new rt(N,$),0,1)},G.exponentiatedBy=G.pow=function(N,$){var M,X,H,s,h,d,A,R,f,_=this;if(N=new rt(N),N.c&&!N.isInteger())throw Error(n+"Exponent not an integer: "+St(N));if($!=null&&($=new rt($)),d=N.e>14,!_.c||!_.c[0]||_.c[0]==1&&!_.e&&_.c.length==1||!N.c||!N.c[0])return f=new rt(Math.pow(+St(_),d?N.s*(2-v(N)):+St(N))),$?f.mod($):f;if(A=N.s<0,$){if($.c?!$.c[0]:!$.s)return new rt(NaN);X=!A&&_.isInteger()&&$.isInteger(),X&&(_=_.mod($))}else{if(N.e>9&&(_.e>0||_.e<-1||(_.e==0?_.c[0]>1||d&&_.c[1]>=24e7:_.c[0]<8e13||d&&_.c[0]<=9999975e7)))return s=_.s<0&&v(N)?-0:0,_.e>-1&&(s=1/s),new rt(A?1/s:s);Z&&(s=c(Z/E+2))}for(d?(M=new rt(.5),A&&(N.s=1),R=v(N)):(H=Math.abs(+St(N)),R=H%2),f=new rt(et);;){if(R){if(f=f.times(_),!f.c)break;s?f.c.length>s&&(f.c.length=s):X&&(f=f.mod($))}if(H){if(H=l(H/2),H===0)break;R=H%2}else if(N=N.times(M),wt(N,N.e+1,1),N.e>14)R=v(N);else{if(H=+St(N),H===0)break;R=H%2}_=_.times(_),s?_.c&&_.c.length>s&&(_.c.length=s):X&&(_=_.mod($))}return X?f:(A&&(f=et.div(f)),$?f.mod($):s?wt(f,Z,tt,h):f)},G.integerValue=function(N){var $=new rt(this);return N==null?N=tt:x(N,0,8),wt($,$.e+1,N)},G.isEqualTo=G.eq=function(N,$){return z(this,new rt(N,$))===0},G.isFinite=function(){return!!this.c},G.isGreaterThan=G.gt=function(N,$){return z(this,new rt(N,$))>0},G.isGreaterThanOrEqualTo=G.gte=function(N,$){return($=z(this,new rt(N,$)))===1||$===0},G.isInteger=function(){return!!this.c&&C(this.e/E)>this.c.length-2},G.isLessThan=G.lt=function(N,$){return z(this,new rt(N,$))<0},G.isLessThanOrEqualTo=G.lte=function(N,$){return($=z(this,new rt(N,$)))===-1||$===0},G.isNaN=function(){return!this.s},G.isNegative=function(){return this.s<0},G.isPositive=function(){return this.s>0},G.isZero=function(){return!!this.c&&this.c[0]==0},G.minus=function(N,$){var M,X,H,s,h=this,d=h.s;if(N=new rt(N,$),$=N.s,!d||!$)return new rt(NaN);if(d!=$)return N.s=-$,h.plus(N);var A=h.e/E,R=N.e/E,f=h.c,_=N.c;if(!A||!R){if(!f||!_)return f?(N.s=-$,N):new rt(_?h:NaN);if(!f[0]||!_[0])return _[0]?(N.s=-$,N):new rt(f[0]?h:tt==3?-0:0)}if(A=C(A),R=C(R),f=f.slice(),d=A-R){for((s=d<0)?(d=-d,H=f):(R=A,H=_),H.reverse(),$=d;$--;H.push(0));H.reverse()}else for(X=(s=(d=f.length)<($=_.length))?d:$,d=$=0;$<X;$++)if(f[$]!=_[$]){s=f[$]<_[$];break}if(s&&(H=f,f=_,_=H,N.s=-N.s),$=(X=_.length)-(M=f.length),$>0)for(;$--;f[M++]=0);for($=S-1;X>d;){if(f[--X]<_[X]){for(M=X;M&&!f[--M];f[M]=$);--f[M],f[X]+=S}f[X]-=_[X]}for(;f[0]==0;f.splice(0,1),--R);return f[0]?dt(N,f,R):(N.s=tt==3?-1:1,N.c=[N.e=0],N)},G.modulo=G.mod=function(N,$){var M,X,H=this;return N=new rt(N,$),!H.c||!N.s||N.c&&!N.c[0]?new rt(NaN):!N.c||H.c&&!H.c[0]?new rt(H):(F==9?(X=N.s,N.s=1,M=I(H,N,0,3),N.s=X,M.s*=X):M=I(H,N,0,F),N=H.minus(M.times(N)),!N.c[0]&&F==1&&(N.s=H.s),N)},G.multipliedBy=G.times=function(N,$){var M,X,H,s,h,d,A,R,f,_,D,Y,lt,ft,o,g=this,m=g.c,V=(N=new rt(N,$)).c;if(!m||!V||!m[0]||!V[0])return!g.s||!N.s||m&&!m[0]&&!V||V&&!V[0]&&!m?N.c=N.e=N.s=null:(N.s*=g.s,!m||!V?N.c=N.e=null:(N.c=[0],N.e=0)),N;for(X=C(g.e/E)+C(N.e/E),N.s*=g.s,A=m.length,_=V.length,A<_&&(lt=m,m=V,V=lt,H=A,A=_,_=H),H=A+_,lt=[];H--;lt.push(0));for(ft=S,o=k,H=_;--H>=0;){for(M=0,D=V[H]%o,Y=V[H]/o|0,h=A,s=H+h;s>H;)R=m[--h]%o,f=m[h]/o|0,d=Y*R+f*D,R=D*R+d%o*o+lt[s]+M,M=(R/ft|0)+(d/o|0)+Y*f,lt[s--]=R%ft;lt[s]=M}return M?++X:lt.splice(0,1),dt(N,lt,X)},G.negated=function(){var N=new rt(this);return N.s=-N.s||null,N},G.plus=function(N,$){var M,X=this,H=X.s;if(N=new rt(N,$),$=N.s,!H||!$)return new rt(NaN);if(H!=$)return N.s=-$,X.minus(N);var s=X.e/E,h=N.e/E,d=X.c,A=N.c;if(!s||!h){if(!d||!A)return new rt(H/0);if(!d[0]||!A[0])return A[0]?N:new rt(d[0]?X:H*0)}if(s=C(s),h=C(h),d=d.slice(),H=s-h){for(H>0?(h=s,M=A):(H=-H,M=d),M.reverse();H--;M.push(0));M.reverse()}for(H=d.length,$=A.length,H-$<0&&(M=A,A=d,d=M,$=H),H=0;$;)H=(d[--$]=d[$]+A[$]+H)/S|0,d[$]=S===d[$]?0:d[$]%S;return H&&(d=[H].concat(d),++h),dt(N,d,h)},G.precision=G.sd=function(N,$){var M,X,H,s=this;if(N!=null&&N!==!!N)return x(N,1,b),$==null?$=tt:x($,0,8),wt(new rt(s),N,$);if(!(M=s.c))return null;if(H=M.length-1,X=H*E+1,H=M[H]){for(;H%10==0;H/=10,X--);for(H=M[0];H>=10;H/=10,X++);}return N&&s.e+1>X&&(X=s.e+1),X},G.shiftedBy=function(N){return x(N,-L,L),this.times("1e"+N)},G.squareRoot=G.sqrt=function(){var N,$,M,X,H,s=this,h=s.c,d=s.s,A=s.e,R=J+4,f=new rt("0.5");if(d!==1||!h||!h[0])return new rt(!d||d<0&&(!h||h[0])?NaN:h?s:1/0);if(d=Math.sqrt(+St(s)),d==0||d==1/0?($=K(h),($.length+A)%2==0&&($+="0"),d=Math.sqrt(+$),A=C((A+1)/2)-(A<0||A%2),d==1/0?$="5e"+A:($=d.toExponential(),$=$.slice(0,$.indexOf("e")+1)+A),M=new rt($)):M=new rt(d+""),M.c[0]){for(A=M.e,d=A+R,d<3&&(d=0);;)if(H=M,M=f.times(H.plus(I(s,H,R,1))),K(H.c).slice(0,d)===($=K(M.c)).slice(0,d))if(M.e<A&&--d,$=$.slice(d-3,d+1),$=="9999"||!X&&$=="4999"){if(!X&&(wt(H,H.e+J+2,0),H.times(H).eq(s))){M=H;break}R+=4,d+=4,X=1}else{(!+$||!+$.slice(1)&&$.charAt(0)=="5")&&(wt(M,M.e+J+2,1),N=!M.times(M).eq(s));break}}return wt(M,M.e+J+1,tt,N)},G.toExponential=function(N,$){return N!=null&&(x(N,0,b),N++),ht(this,N,$,1)},G.toFixed=function(N,$){return N!=null&&(x(N,0,b),N=N+this.e+1),ht(this,N,$)},G.toFormat=function(N,$,M){var X,H=this;if(M==null)N!=null&&$&&typeof $=="object"?(M=$,$=null):N&&typeof N=="object"?(M=N,N=$=null):M=ot;else if(typeof M!="object")throw Error(n+"Argument not an object: "+M);if(X=H.toFixed(N,$),H.c){var s,h=X.split("."),d=+M.groupSize,A=+M.secondaryGroupSize,R=M.groupSeparator||"",f=h[0],_=h[1],D=H.s<0,Y=D?f.slice(1):f,lt=Y.length;if(A&&(s=d,d=A,A=s,lt-=s),d>0&&lt>0){for(s=lt%d||d,f=Y.substr(0,s);s<lt;s+=d)f+=R+Y.substr(s,d);A>0&&(f+=R+Y.slice(s)),D&&(f="-"+f)}X=_?f+(M.decimalSeparator||"")+((A=+M.fractionGroupSize)?_.replace(new RegExp("\\d{"+A+"}\\B","g"),"$&"+(M.fractionGroupSeparator||"")):_):f}return(M.prefix||"")+X+(M.suffix||"")},G.toFraction=function(N){var $,M,X,H,s,h,d,A,R,f,_,D,Y=this,lt=Y.c;if(N!=null&&(d=new rt(N),!d.isInteger()&&(d.c||d.s!==1)||d.lt(et)))throw Error(n+"Argument "+(d.isInteger()?"out of range: ":"not an integer: ")+St(d));if(!lt)return new rt(Y);for($=new rt(et),R=M=new rt(et),X=A=new rt(et),D=K(lt),s=$.e=D.length-Y.e-1,$.c[0]=y[(h=s%E)<0?E+h:h],N=!N||d.comparedTo($)>0?s>0?$:R:d,h=O,O=1/0,d=new rt(D),A.c[0]=0;f=I(d,$,0,1),H=M.plus(f.times(X)),H.comparedTo(N)!=1;)M=X,X=H,R=A.plus(f.times(H=R)),A=H,$=d.minus(f.times(H=$)),d=H;return H=I(N.minus(M),X,0,1),A=A.plus(H.times(R)),M=M.plus(H.times(X)),A.s=R.s=Y.s,s=s*2,_=I(R,X,s,tt).minus(Y).abs().comparedTo(I(A,M,s,tt).minus(Y).abs())<1?[R,X]:[A,M],O=h,_},G.toNumber=function(){return+St(this)},G.toPrecision=function(N,$){return N!=null&&x(N,1,b),ht(this,N,$,2)},G.toString=function(N){var $,M=this,X=M.s,H=M.e;return H===null?X?($="Infinity",X<0&&($="-"+$)):$="NaN":(N==null?$=H<=st||H>=nt?w(K(M.c),H):u(K(M.c),H,"0"):N===10&&gt?(M=wt(new rt(M),J+H+1,tt),$=u(K(M.c),M.e,"0")):(x(N,2,ut.length,"Base"),$=P(u(K(M.c),H,"0"),10,N,X,!0)),X<0&&M.c[0]&&($="-"+$)),$},G.valueOf=G.toJSON=function(){return St(this)},G._isBigNumber=!0,T!=null&&rt.set(T),rt}function C(T){var I=T|0;return T>0||T===I?I:I-1}function K(T){for(var I,P,q=1,G=T.length,et=T[0]+"";q<G;){for(I=T[q++]+"",P=E-I.length;P--;I="0"+I);et+=I}for(G=et.length;et.charCodeAt(--G)===48;);return et.slice(0,G+1||1)}function z(T,I){var P,q,G=T.c,et=I.c,J=T.s,tt=I.s,st=T.e,nt=I.e;if(!J||!tt)return null;if(P=G&&!G[0],q=et&&!et[0],P||q)return P?q?0:-tt:J;if(J!=tt)return J;if(P=J<0,q=st==nt,!G||!et)return q?0:!G^P?1:-1;if(!q)return st>nt^P?1:-1;for(tt=(st=G.length)<(nt=et.length)?st:nt,J=0;J<tt;J++)if(G[J]!=et[J])return G[J]>et[J]^P?1:-1;return st==nt?0:st>nt^P?1:-1}function x(T,I,P,q){if(T<I||T>P||T!==l(T))throw Error(n+(q||"Argument")+(typeof T=="number"?T<I||T>P?" out of range: ":" not an integer: ":" not a primitive number: ")+String(T))}function v(T){var I=T.c.length-1;return C(T.e/E)==I&&T.c[I]%2!=0}function w(T,I){return(T.length>1?T.charAt(0)+"."+T.slice(1):T)+(I<0?"e":"e+")+I}function u(T,I,P){var q,G;if(I<0){for(G=P+".";++I;G+=P);T=G+T}else if(q=T.length,++I>q){for(G=P,I-=q;--I;G+=P);T+=G}else I<q&&(T=T.slice(0,I)+"."+T.slice(I));return T}i=U(),i.default=i.BigNumber=i,typeof define=="function"&&define.amd?define(function(){return i}):typeof e<"u"&&e.exports?e.exports=i:(r||(r=typeof self<"u"&&self?self:window),r.BigNumber=i)}(t)}),wi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Fr(),r=class{constructor(){j(this,"BigNum");this.BigNum=(i,a)=>{let c=e.BigNumber.clone({DECIMAL_PLACES:a});return new c(i)}}winstonToAr(i,{formatted:a=!1,decimals:c=12,trim:l=!0}={}){let n=this.stringToBigNum(i,c).shiftedBy(-12);return a?n.toFormat(c):n.toFixed(c)}arToWinston(i,{formatted:a=!1}={}){let c=this.stringToBigNum(i).shiftedBy(12);return a?c.toFormat():c.toFixed(0)}compare(i,a){let c=this.stringToBigNum(i),l=this.stringToBigNum(a);return c.comparedTo(l)}isEqual(i,a){return this.compare(i,a)===0}isLessThan(i,a){let c=this.stringToBigNum(i),l=this.stringToBigNum(a);return c.isLessThan(l)}isGreaterThan(i,a){let c=this.stringToBigNum(i),l=this.stringToBigNum(a);return c.isGreaterThan(l)}add(i,a){let c=this.stringToBigNum(i);return this.stringToBigNum(a),c.plus(a).toFixed(0)}sub(i,a){let c=this.stringToBigNum(i);return this.stringToBigNum(a),c.minus(a).toFixed(0)}stringToBigNum(i,a=12){return this.BigNum(i,a)}};t.default=r}),yi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=class{constructor(a){j(this,"METHOD_GET","GET");j(this,"METHOD_POST","POST");j(this,"config");this.applyConfig(a)}applyConfig(a){this.config=this.mergeDefaults(a)}getConfig(){return this.config}mergeDefaults(a){let c=a.protocol||"http",l=a.port||(c==="https"?443:80);return{host:a.host||"127.0.0.1",protocol:c,port:l,timeout:a.timeout||2e4,logging:a.logging||!1,logger:a.logger||console.log,network:a.network}}async get(a,c){return await this.request(a,{...c,method:this.METHOD_GET})}async post(a,c,l){var p;let n=new Headers((l==null?void 0:l.headers)||{});return(p=n.get("content-type"))!=null&&p.includes("application/json")||n.append("content-type","application/json"),n.append("accept","application/json, text/plain, */*"),await this.request(a,{...l,method:this.METHOD_POST,body:typeof c!="string"?JSON.stringify(c):c,headers:n})}async request(a,c){var k,b;let l=new Headers((c==null?void 0:c.headers)||{}),n=`${this.config.protocol}://${this.config.host}:${this.config.port}`,p=c==null?void 0:c.responseType;c==null||delete c.responseType,a.startsWith("/")&&(a=a.slice(1)),this.config.network&&l.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${n}/${a}`);let S=await fetch(`${n}/${a}`,{...c||{},headers:l});this.config.logging&&this.config.logger(`Response:   ${S.url} - ${S.status}`);let E=(b=(k=S.headers.get("content-type"))==null?void 0:k.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i))==null?void 0:b[1],L=S,y=async()=>{if(E)try{L.data=new TextDecoder(E).decode(await S.arrayBuffer())}catch{L.data=await S.text()}else L.data=await S.text()};if(p==="arraybuffer")L.data=await S.arrayBuffer();else if(p==="text")await y();else if(p==="webstream")L.data=r(S.body);else try{let U=await S.clone().json();typeof U!="object"?await y():L.data=await S.json(),U=null}catch{await y()}return L}};t.default=e;var r=a=>{let c=a;return typeof c[Symbol.asyncIterator]>"u"?(c[Symbol.asyncIterator]=i(a),c):a},i=function(a){return async function*(){let c=a.getReader();try{for(;;){let{done:l,value:n}=await c.read();if(l)return;yield n}}finally{c.releaseLock()}}}}),Ft=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.b64UrlDecode=t.b64UrlEncode=t.bufferTob64Url=t.bufferTob64=t.b64UrlToBuffer=t.stringToB64Url=t.stringToBuffer=t.bufferToString=t.b64UrlToString=t.concatBuffers=void 0;var e=Ur();function r(y){let k=0;for(let C=0;C<y.length;C++)k+=y[C].byteLength;let b=new Uint8Array(k),U=0;b.set(new Uint8Array(y[0]),U),U+=y[0].byteLength;for(let C=1;C<y.length;C++)b.set(new Uint8Array(y[C]),U),U+=y[C].byteLength;return b}t.concatBuffers=r;function i(y){let k=n(y);return a(k)}t.b64UrlToString=i;function a(y){return new TextDecoder("utf-8",{fatal:!0}).decode(y)}t.bufferToString=a;function c(y){return new TextEncoder().encode(y)}t.stringToBuffer=c;function l(y){return S(c(y))}t.stringToB64Url=l;function n(y){return new Uint8Array(e.toByteArray(L(y)))}t.b64UrlToBuffer=n;function p(y){return e.fromByteArray(new Uint8Array(y))}t.bufferTob64=p;function S(y){return E(p(y))}t.bufferTob64Url=S;function E(y){return y.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}t.b64UrlEncode=E;function L(y){y=y.replace(/\-/g,"+").replace(/\_/g,"/");let k;return y.length%4==0?k=0:k=4-y.length%4,y.concat("=".repeat(k))}t.b64UrlDecode=L}),mi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ft(),r=class{constructor(){j(this,"keyLength",4096);j(this,"publicExponent",65537);j(this,"hashAlgorithm","sha256");j(this,"driver");if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let i=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),a=await this.driver.exportKey("jwk",i.privateKey);return{kty:a.kty,e:a.e,n:a.n,d:a.d,p:a.p,q:a.q,dp:a.dp,dq:a.dq,qi:a.qi}}async sign(i,a,{saltLength:c}={}){let l=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(i),a);return new Uint8Array(l)}async hash(i,a="SHA-256"){let c=await this.driver.digest(a,i);return new Uint8Array(c)}async verify(i,a,c){let l={kty:"RSA",e:"AQAB",n:i},n=await this.jwkToPublicCryptoKey(l),p=await this.driver.digest("SHA-256",a),S=await this.driver.verify({name:"RSA-PSS",saltLength:0},n,c,a),E=await this.driver.verify({name:"RSA-PSS",saltLength:32},n,c,a),L=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((n.algorithm.modulusLength-1)/8)-p.byteLength-2},n,c,a);return S||E||L}async jwkToCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let i=crypto==null?void 0:crypto.subtle;return i===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(a=>typeof i[a]=="function")}async encrypt(i,a,c){let l=await this.driver.importKey("raw",typeof a=="string"?e.stringToBuffer(a):a,{name:"PBKDF2",length:32},!1,["deriveKey"]),n=await this.driver.deriveKey({name:"PBKDF2",salt:c?e.stringToBuffer(c):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},l,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),p=new Uint8Array(16);crypto.getRandomValues(p);let S=await this.driver.encrypt({name:"AES-CBC",iv:p},n,i);return e.concatBuffers([p,S])}async decrypt(i,a,c){let l=await this.driver.importKey("raw",typeof a=="string"?e.stringToBuffer(a):a,{name:"PBKDF2",length:32},!1,["deriveKey"]),n=await this.driver.deriveKey({name:"PBKDF2",salt:c?e.stringToBuffer(c):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},l,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),p=i.slice(0,16),S=await this.driver.decrypt({name:"AES-CBC",iv:p},n,i.slice(16));return e.concatBuffers([S])}};t.default=r}),bi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=class{constructor(r){j(this,"api");this.api=r}getInfo(){return this.api.get("info").then(r=>r.data)}getPeers(){return this.api.get("peers").then(r=>r.data)}};t.default=e}),Ae=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.getError=void 0;var e=class extends Error{constructor(c,l={}){var a=(...i)=>(super(...i),j(this,"type"),j(this,"response"),this);l.message?a(l.message):a(),this.type=c,this.response=l.response}getType(){return this.type}};t.default=e;function r(a){let c=a.data;if(typeof a.data=="string")try{c=JSON.parse(a.data)}catch{}if(a.data instanceof ArrayBuffer||a.data instanceof Uint8Array)try{c=JSON.parse(c.toString())}catch{}return c?c.error||c:a.statusText||"unknown"}t.getError=r}),vi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=_e();async function r(a){if(Array.isArray(a)){let n=e.default.utils.concatBuffers([e.default.utils.stringToBuffer("list"),e.default.utils.stringToBuffer(a.length.toString())]);return await i(a,await e.default.crypto.hash(n,"SHA-384"))}let c=e.default.utils.concatBuffers([e.default.utils.stringToBuffer("blob"),e.default.utils.stringToBuffer(a.byteLength.toString())]),l=e.default.utils.concatBuffers([await e.default.crypto.hash(c,"SHA-384"),await e.default.crypto.hash(a,"SHA-384")]);return await e.default.crypto.hash(l,"SHA-384")}t.default=r;async function i(a,c){if(a.length<1)return c;let l=e.default.utils.concatBuffers([c,await r(a[0])]),n=await e.default.crypto.hash(l,"SHA-384");return await i(a.slice(1),n)}}),Vr=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.validatePath=t.arrayCompare=t.bufferToInt=t.intToBuffer=t.arrayFlatten=t.generateProofs=t.buildLayers=t.generateTransactionChunks=t.generateTree=t.computeRootHash=t.generateLeaves=t.chunkData=t.MIN_CHUNK_SIZE=t.MAX_CHUNK_SIZE=void 0;var e=_e(),r=Ft();t.MAX_CHUNK_SIZE=256*1024,t.MIN_CHUNK_SIZE=32*1024;var i=32,a=32;async function c(w){let u=[],T=w,I=0;for(;T.byteLength>=t.MAX_CHUNK_SIZE;){let P=t.MAX_CHUNK_SIZE,q=T.byteLength-t.MAX_CHUNK_SIZE;q>0&&q<t.MIN_CHUNK_SIZE&&(P=Math.ceil(T.byteLength/2));let G=T.slice(0,P),et=await e.default.crypto.hash(G);I+=G.byteLength,u.push({dataHash:et,minByteRange:I-G.byteLength,maxByteRange:I}),T=T.slice(P)}return u.push({dataHash:await e.default.crypto.hash(T),minByteRange:I,maxByteRange:I+T.byteLength}),u}t.chunkData=c;async function l(w){return Promise.all(w.map(async({dataHash:u,minByteRange:T,maxByteRange:I})=>({type:"leaf",id:await U(await Promise.all([U(u),U(C(I))])),dataHash:u,minByteRange:T,maxByteRange:I})))}t.generateLeaves=l;async function n(w){return(await p(w)).id}t.computeRootHash=n;async function p(w){return await E(await l(await c(w)))}t.generateTree=p;async function S(w){let u=await c(w),T=await l(u),I=await E(T),P=await L(I),q=u.slice(-1)[0];return q.maxByteRange-q.minByteRange===0&&(u.splice(u.length-1,1),P.splice(P.length-1,1)),{data_root:I.id,chunks:u,proofs:P}}t.generateTransactionChunks=S;async function E(w,u=0){if(w.length<2)return w[0];let T=[];for(let I=0;I<w.length;I+=2)T.push(await b(w[I],w[I+1]));return E(T,u+1)}t.buildLayers=E;function L(w){let u=y(w);return Array.isArray(u)?k(u):[u]}t.generateProofs=L;function y(w,u=new Uint8Array,T=0){if(w.type=="leaf")return{offset:w.maxByteRange-1,proof:(0,r.concatBuffers)([u,w.dataHash,C(w.maxByteRange)])};if(w.type=="branch"){let I=(0,r.concatBuffers)([u,w.leftChild.id,w.rightChild.id,C(w.byteRange)]);return[y(w.leftChild,I,T+1),y(w.rightChild,I,T+1)]}throw new Error("Unexpected node type")}function k(w){let u=[];return w.forEach(T=>{Array.isArray(T)?u.push(...k(T)):u.push(T)}),u}t.arrayFlatten=k;async function b(w,u){return u?{type:"branch",id:await U([await U(w.id),await U(u.id),await U(C(w.maxByteRange))]),byteRange:w.maxByteRange,maxByteRange:u.maxByteRange,leftChild:w,rightChild:u}:w}async function U(w){return Array.isArray(w)&&(w=e.default.utils.concatBuffers(w)),new Uint8Array(await e.default.crypto.hash(w))}function C(w){let u=new Uint8Array(i);for(var T=u.length-1;T>=0;T--){var I=w%256;u[T]=I,w=(w-I)/256}return u}t.intToBuffer=C;function K(w){let u=0;for(var T=0;T<w.length;T++)u*=256,u+=w[T];return u}t.bufferToInt=K;var z=(w,u)=>w.every((T,I)=>u[I]===T);t.arrayCompare=z;async function x(w,u,T,I,P){if(I<=0)return!1;if(u>=I)return x(w,0,I-1,I,P);if(u<0)return x(w,0,0,I,P);if(P.length==a+i){let nt=P.slice(0,a),B=P.slice(nt.length,nt.length+i),O=await U([await U(nt),await U(B)]);return(0,t.arrayCompare)(w,O)?{offset:I-1,leftBound:T,rightBound:I,chunkSize:I-T}:!1}let q=P.slice(0,a),G=P.slice(q.length,q.length+a),et=P.slice(q.length+G.length,q.length+G.length+i),J=K(et),tt=P.slice(q.length+G.length+et.length),st=await U([await U(q),await U(G),await U(et)]);return(0,t.arrayCompare)(w,st)?u<J?await x(q,u,T,Math.min(I,J),tt):await x(G,u,Math.max(T,J),I,tt):!1}t.validatePath=x;async function v(w,u=""){if(w.byteLength<1)return u;let T=w.slice(0,a),I=w.slice(T.length,T.length+a),P=w.slice(T.length+I.length,T.length+I.length+i),q=K(P),G=w.slice(T.length+I.length+P.length),et=await U([await U(T),await U(I),await U(P)]),J=`${u}
${JSON.stringify(Ct.Buffer.from(T))},${JSON.stringify(Ct.Buffer.from(I))},${q} => ${JSON.stringify(et)}`;return v(G,J)}t.debug=v}),Ze=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=Ft(),r=vi(),i=Vr(),a=class{get(n,p){if(!Object.getOwnPropertyNames(this).includes(n))throw new Error(`Field "${n}" is not a property of the Arweave Transaction class.`);if(this[n]instanceof Uint8Array)return p&&p.decode&&p.string?e.bufferToString(this[n]):p&&p.decode&&!p.string?this[n]:e.bufferTob64Url(this[n]);if(this[n]instanceof Array){if((p==null?void 0:p.decode)!==void 0||(p==null?void 0:p.string)!==void 0)throw n==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[n]}return p&&p.decode==!0?p&&p.string?e.b64UrlToString(this[n]):e.b64UrlToBuffer(this[n]):this[n]}},c=class extends a{constructor(p,S,E=!1){super();j(this,"name");j(this,"value");this.name=p,this.value=S}};t.Tag=c;var l=class extends a{constructor(p={}){super();j(this,"format",2);j(this,"id","");j(this,"last_tx","");j(this,"owner","");j(this,"tags",[]);j(this,"target","");j(this,"quantity","0");j(this,"data_size","0");j(this,"data",new Uint8Array);j(this,"data_root","");j(this,"reward","0");j(this,"signature","");j(this,"chunks");Object.assign(this,p),typeof this.data=="string"&&(this.data=e.b64UrlToBuffer(this.data)),p.tags&&(this.tags=p.tags.map(S=>new c(S.name,S.value)))}addTag(p,S){this.tags.push(new c(e.stringToB64Url(p),e.stringToB64Url(S)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:e.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(p){this.owner=p}setSignature({id:p,owner:S,reward:E,tags:L,signature:y}){this.id=p,this.owner=S,E&&(this.reward=E),L&&(this.tags=L),this.signature=y}async prepareChunks(p){!this.chunks&&p.byteLength>0&&(this.chunks=await(0,i.generateTransactionChunks)(p),this.data_root=e.bufferTob64Url(this.chunks.data_root)),!this.chunks&&p.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(p,S){if(!this.chunks)throw new Error("Chunks have not been prepared");let E=this.chunks.proofs[p],L=this.chunks.chunks[p];return{data_root:this.data_root,data_size:this.data_size,data_path:e.bufferTob64Url(E.proof),offset:E.offset.toString(),chunk:e.bufferTob64Url(S.slice(L.minByteRange,L.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let p=this.tags.reduce((E,L)=>e.concatBuffers([E,L.get("name",{decode:!0,string:!1}),L.get("value",{decode:!0,string:!1})]),new Uint8Array);return e.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),e.stringToBuffer(this.quantity),e.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),p]);case 2:this.data_root||await this.prepareChunks(this.data);let S=this.tags.map(E=>[E.get("name",{decode:!0,string:!1}),E.get("value",{decode:!0,string:!1})]);return await(0,r.default)([e.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),e.stringToBuffer(this.quantity),e.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),S,e.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}};t.default=l}),_i=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionUploader=void 0;var e=Ze(),r=Ft(),i=Ae(),a=Vr(),c=1,l=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],n=1e3*40,p=class{constructor(S,E){j(this,"api");j(this,"chunkIndex",0);j(this,"txPosted",!1);j(this,"transaction");j(this,"lastRequestTimeEnd",0);j(this,"totalErrors",0);j(this,"data");j(this,"lastResponseStatus",0);j(this,"lastResponseError","");if(this.api=S,!E.id)throw new Error("Transaction is not signed");if(!E.chunks)throw new Error("Transaction chunks not prepared");this.data=E.data,this.transaction=new e.default(Object.assign({},E,{data:new Uint8Array(0)}))}get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}async uploadChunk(S){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let E=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+n-Date.now(),n);if(E>0&&(E=E-E*Math.random()*.3,await new Promise(k=>setTimeout(k,E))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}S&&(this.chunkIndex=S);let L=this.transaction.getChunk(S||this.chunkIndex,this.data);if(!await(0,a.validatePath)(this.transaction.chunks.data_root,parseInt(L.offset),0,parseInt(L.data_size),r.b64UrlToBuffer(L.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);let y=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(k=>(console.error(k.message),{status:-1,data:{error:k.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=y.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,i.getError)(y),l.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(S,E,L){if(!E||typeof E.chunkIndex!="number"||typeof E.transaction!="object")throw new Error("Serialized object does not match expected format.");var y=new e.default(E.transaction);y.chunks||await y.prepareChunks(L);let k=new p(S,y);if(k.chunkIndex=E.chunkIndex,k.lastRequestTimeEnd=E.lastRequestTimeEnd,k.lastResponseError=E.lastResponseError,k.lastResponseStatus=E.lastResponseStatus,k.txPosted=E.txPosted,k.data=L,k.transaction.data_root!==E.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return k}static async fromTransactionId(S,E){let L=await S.get(`tx/${E}`);if(L.status!==200)throw new Error(`Tx ${E} not found: ${L.status}`);let y=L.data;return y.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:y}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=c){this.transaction.data=this.data;let E=await this.api.post("tx",this.transaction).catch(L=>(console.error(L),{status:-1,data:{error:L.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=E.status,this.transaction.data=new Uint8Array(0),E.status>=200&&E.status<300){this.txPosted=!0,this.chunkIndex=c;return}throw this.lastResponseError=(0,i.getError)(E),new Error(`Unable to upload transaction: ${E.status}, ${this.lastResponseError}`)}let S=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=S.status,!(S.status>=200&&S.status<300))throw this.lastResponseError=(0,i.getError)(S),new Error(`Unable to upload transaction: ${S.status}, ${this.lastResponseError}`);this.txPosted=!0}};t.TransactionUploader=p}),tr=pt((t,e)=>{at(),e.exports={}}),Ei=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ae(),r=Ze(),i=Ft(),a=_i();tr();var c=class{constructor(l,n,p){j(this,"api");j(this,"crypto");j(this,"chunks");this.api=l,this.crypto=n,this.chunks=p}async getTransactionAnchor(){let l=await this.api.get("tx_anchor");if(!l.data.match(/^[a-z0-9_-]{43,}/i)||!l.ok)throw new Error(`Could not getTransactionAnchor. Received: ${l.data}. Status: ${l.status}, ${l.statusText}`);return l.data}async getPrice(l,n){let p=n?`price/${l}/${n}`:`price/${l}`,S=await this.api.get(p);if(!/^\d+$/.test(S.data)||!S.ok)throw new Error(`Could not getPrice. Received: ${S.data}. Status: ${S.status}, ${S.statusText}`);return S.data}async get(l){let n=await this.api.get(`tx/${l}`);if(n.status==200){let p=parseInt(n.data.data_size);if(n.data.format>=2&&p>0&&p<=1024*1024*12){let S=await this.getData(l);return new r.default({...n.data,data:S})}return new r.default({...n.data,format:n.data.format||1})}throw n.status==404?new e.default("TX_NOT_FOUND"):n.status==410?new e.default("TX_FAILED"):new e.default("TX_INVALID")}fromRaw(l){return new r.default(l)}async search(l,n){return this.api.post("arql",{op:"equals",expr1:l,expr2:n}).then(p=>p.data?p.data:[])}getStatus(l){return this.api.get(`tx/${l}/status`).then(n=>n.status==200?{status:200,confirmed:n.data}:{status:n.status,confirmed:null})}async getData(l,n){let p;try{p=await this.chunks.downloadChunkedData(l)}catch(S){console.error(`Error while trying to download chunked data for ${l}`),console.error(S)}if(!p){console.warn(`Falling back to gateway cache for ${l}`);try{let{data:S,ok:E,status:L,statusText:y}=await this.api.get(`/${l}`,{responseType:"arraybuffer"});if(!E)throw new Error("Bad http status code",{cause:{status:L,statusText:y}});p=S}catch(S){console.error(`Error while trying to download contiguous data from gateway cache for ${l}`),console.error(S)}}if(!p)throw new Error(`${l} data was not found!`);return n&&n.decode&&!n.string?p:n&&n.decode&&n.string?i.bufferToString(p):i.bufferTob64Url(p)}async sign(l,n,p){let S=typeof n=="object"&&(L=>{let y=!0;return["n","e","d","p","q","dp","dq","qi"].map(k=>!(k in L)&&(y=!1)),y})(n),E=typeof arweaveWallet=="object";if(!S&&!E)throw new Error("No valid JWK or external wallet found to sign transaction.");if(E){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let L=await arweaveWallet.sign(l,p);l.setSignature({id:L.id,owner:L.owner,reward:L.reward,tags:L.tags,signature:L.signature})}else if(S){l.setOwner(n.n);let L=await l.getSignatureData(),y=await this.crypto.sign(n,L,p),k=await this.crypto.hash(y);l.setSignature({id:i.bufferTob64Url(k),owner:n.n,signature:i.bufferTob64Url(y)})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(l){let n=await l.getSignatureData(),p=l.get("signature",{decode:!0,string:!1}),S=i.bufferTob64Url(await this.crypto.hash(p));if(l.id!==S)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(l.owner,n,p)}async post(l){if(typeof l=="string"?l=new r.default(JSON.parse(l)):typeof l.readInt32BE=="function"?l=new r.default(JSON.parse(l.toString())):typeof l=="object"&&!(l instanceof r.default)&&(l=new r.default(l)),!(l instanceof r.default))throw new Error("Must be Transaction object");l.chunks||await l.prepareChunks(l.data);let n=await this.getUploader(l,l.data);try{for(;!n.isComplete;)await n.uploadChunk()}catch(p){if(n.lastResponseStatus>0)return{status:n.lastResponseStatus,statusText:n.lastResponseError,data:{error:n.lastResponseError}};throw p}return{status:200,statusText:"OK",data:{}}}async getUploader(l,n){let p;if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),l instanceof r.default){if(n||(n=l.data),!(n instanceof Uint8Array))throw new Error("Data format is invalid");l.chunks||await l.prepareChunks(n),p=new a.TransactionUploader(this.api,l),(!p.data||p.data.length===0)&&(p.data=n)}else{if(typeof l=="string"&&(l=await a.TransactionUploader.fromTransactionId(this.api,l)),!n||!(n instanceof Uint8Array))throw new Error("Must provide data when resuming upload");p=await a.TransactionUploader.fromSerialized(this.api,l,n)}return p}async*upload(l,n){let p=await this.getUploader(l,n);for(;!p.isComplete;)await p.uploadChunk(),yield p;return p}};t.default=c}),Ti=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ft();tr();var r=class{constructor(i,a){j(this,"api");j(this,"crypto");this.api=i,this.crypto=a}getBalance(i){return this.api.get(`wallet/${i}/balance`).then(a=>a.data)}getLastTransactionID(i){return this.api.get(`wallet/${i}/last_tx`).then(a=>a.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(i){return!i||i==="use_wallet"?this.getAddress():this.getAddress(i)}async getAddress(i){if(!i||i==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(i.n)}async ownerToAddress(i){return e.bufferTob64Url(await this.crypto.hash(e.b64UrlToBuffer(i)))}};t.default=r}),Si=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.SiloResource=void 0;var e=Ft(),r=class{constructor(a,c,l){j(this,"api");j(this,"crypto");j(this,"transactions");this.api=a,this.crypto=c,this.transactions=l}async get(a){if(!a)throw new Error("No Silo URI specified");let c=await this.parseUri(a),l=await this.transactions.search("Silo-Name",c.getAccessKey());if(l.length==0)throw new Error(`No data could be found for the Silo URI: ${a}`);let n=await this.transactions.get(l[0]);if(!n)throw new Error(`No data could be found for the Silo URI: ${a}`);let p=n.get("data",{decode:!0,string:!1});return this.crypto.decrypt(p,c.getEncryptionKey())}async readTransactionData(a,c){if(!c)throw new Error("No Silo URI specified");let l=await this.parseUri(c),n=a.get("data",{decode:!0,string:!1});return this.crypto.decrypt(n,l.getEncryptionKey())}async parseUri(a){let c=a.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!c)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let l=c[1],n=Math.pow(2,parseInt(c[2])),p=await this.hash(e.stringToBuffer(l),n),S=e.bufferTob64(p.slice(0,15)),E=await this.hash(p.slice(16,31),1);return new i(a,S,E)}async hash(a,c){let l=await this.crypto.hash(a);for(let n=0;n<c-1;n++)l=await this.crypto.hash(l);return l}};t.default=r;var i=class{constructor(a,c,l){j(this,"uri");j(this,"accessKey");j(this,"encryptionKey");this.uri=a,this.accessKey=c,this.encryptionKey=l}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};t.SiloResource=i}),xi=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ae(),r=Ft(),i=class{constructor(a){j(this,"api");this.api=a}async getTransactionOffset(a){let c=await this.api.get(`tx/${a}/offset`);if(c.status===200)return c.data;throw new Error(`Unable to get transaction offset: ${(0,e.getError)(c)}`)}async getChunk(a){let c=await this.api.get(`chunk/${a}`);if(c.status===200)return c.data;throw new Error(`Unable to get chunk: ${(0,e.getError)(c)}`)}async getChunkData(a){let c=await this.getChunk(a);return r.b64UrlToBuffer(c.chunk)}firstChunkOffset(a){return parseInt(a.offset)-parseInt(a.size)+1}async downloadChunkedData(a){let c=await this.getTransactionOffset(a),l=parseInt(c.size),n=parseInt(c.offset)-l+1,p=new Uint8Array(l),S=0;for(;S<l;){this.api.config.logging&&console.log(`[chunk] ${S}/${l}`);let E;try{E=await this.getChunkData(n+S)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${n+S}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(E)p.set(E,S),S+=E.length;else throw new Error(`Couldn't complete data download at ${S}/${l}`)}return p}};t.default=i}),ki=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ae();tr();var r=class{constructor(a,c){j(this,"api");j(this,"network");this.api=a,this.network=c}async get(a){let c=await this.api.get(`${r.ENDPOINT}${a}`);if(c.status===200)return c.data;throw c.status===404?new e.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${c}`)}async getCurrent(){let{current:a}=await this.network.getInfo();return await this.get(a)}},i=r;he(i,"ENDPOINT","block/hash/"),t.default=i}),_e=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0});var e=wi(),r=yi(),i=mi(),a=bi(),c=Ei(),l=Ti(),n=Ze(),p=Ft(),S=Si(),E=xi(),L=ki(),y=class{constructor(b){j(this,"api");j(this,"wallets");j(this,"transactions");j(this,"network");j(this,"blocks");j(this,"ar");j(this,"silo");j(this,"chunks");this.api=new r.default(b),this.wallets=new l.default(this.api,y.crypto),this.chunks=new E.default(this.api),this.transactions=new c.default(this.api,y.crypto,this.chunks),this.silo=new S.default(this.api,this.crypto,this.transactions),this.network=new a.default(this.api),this.blocks=new L.default(this.api,this.network),this.ar=new e.default}get crypto(){return y.crypto}get utils(){return y.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(b,U){let C={};if(Object.assign(C,b),!b.data&&!(b.target&&b.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(b.owner==null&&U&&U!=="use_wallet"&&(C.owner=U.n),b.last_tx==null&&(C.last_tx=await this.transactions.getTransactionAnchor()),typeof b.data=="string"&&(b.data=p.stringToBuffer(b.data)),b.data instanceof ArrayBuffer&&(b.data=new Uint8Array(b.data)),b.data&&!(b.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(b.reward==null){let z=b.data?b.data.byteLength:0;C.reward=await this.transactions.getPrice(z,C.target)}C.data_root="",C.data_size=b.data?b.data.byteLength.toString():"0",C.data=b.data||new Uint8Array(0);let K=new n.default(C);return await K.getSignatureData(),K}async createSiloTransaction(b,U,C){let K={};if(Object.assign(K,b),!b.data)throw new Error("Silo transactions must have a 'data' value");if(!C)throw new Error("No Silo URI specified.");if(b.target||b.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(b.owner==null){if(!U||!U.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");K.owner=U.n}b.last_tx==null&&(K.last_tx=await this.transactions.getTransactionAnchor());let z=await this.silo.parseUri(C);if(typeof b.data=="string"){let v=await this.crypto.encrypt(p.stringToBuffer(b.data),z.getEncryptionKey());K.reward=await this.transactions.getPrice(v.byteLength),K.data=p.bufferTob64Url(v)}if(b.data instanceof Uint8Array){let v=await this.crypto.encrypt(b.data,z.getEncryptionKey());K.reward=await this.transactions.getPrice(v.byteLength),K.data=p.bufferTob64Url(v)}let x=new n.default(K);return x.addTag("Silo-Name",z.getAccessKey()),x.addTag("Silo-Version","0.1.0"),x}arql(b){return this.api.post("/arql",b).then(U=>U.data||[])}},k=y;he(k,"init"),he(k,"crypto",new i.default),he(k,"utils",p),t.default=k}),Ai=pt(t=>{at(),Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultConfig=void 0;var e=(a,c)=>{let l=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,n=c.split("."),p=n[n.length-1],S=["localhost","[::1]"];return S.includes(c)||a=="file"||S.includes(p)||!!c.match(l)||!!p.match(l)},r=a=>{let c=a.charAt(0)==="[",l=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!a.match(l)||c},i=(a,c)=>{if(e(a,c))return{protocol:"https",host:"arweave.net",port:443};if(!r(c)){let l=c.split(".");if(l.length>=3){l.shift();let n=l.join(".");return{protocol:a,host:n}}}return{protocol:a,host:c}};t.getDefaultConfig=i}),er=pt(t=>{at();var e=t&&t.__createBinding||(Object.create?function(c,l,n,p){p===void 0&&(p=n);var S=Object.getOwnPropertyDescriptor(l,n);(!S||("get"in S?!l.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return l[n]}}),Object.defineProperty(c,p,S)}:function(c,l,n,p){p===void 0&&(p=n),c[p]=l[n]}),r=t&&t.__exportStar||function(c,l){for(var n in c)n!=="default"&&!Object.prototype.hasOwnProperty.call(l,n)&&e(l,c,n)};Object.defineProperty(t,"__esModule",{value:!0});var i=_e(),a=Ai();i.default.init=function(c={}){let l={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new i.default({...c,...l});let n=location.protocol.replace(":",""),p=location.hostname,S=location.port?parseInt(location.port):n=="https"?443:80,E=(0,a.getDefaultConfig)(n,p),L=c.protocol||E.protocol,y=c.host||E.host,k=c.port||E.port||S;return new i.default({...c,host:y,protocol:L,port:k})},typeof globalThis=="object"?globalThis.Arweave=i.default:typeof self=="object"&&(self.Arweave=i.default),r(_e(),t),t.default=i.default}),Ci=pt((t,e)=>{at();var{hasOwnProperty:r}=Object.prototype,i=x();i.configure=x,i.stringify=i,i.default=i,t.stringify=i,t.configure=x,e.exports=i;var a=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/,c=new RegExp(a,"g"),l=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\"];function n(v){if(v.length===2){let u=v.charCodeAt(1);return`${v[0]}\\u${u.toString(16)}`}let w=v.charCodeAt(0);return l.length>w?l[w]:`\\u${w.toString(16)}`}function p(v){if(v.length<5e3&&!a.test(v))return v;if(v.length>100)return v.replace(c,n);let w="",u=0;for(let T=0;T<v.length;T++){let I=v.charCodeAt(T);if(I===34||I===92||I<32)w+=`${v.slice(u,T)}${l[I]}`,u=T+1;else if(I>=55296&&I<=57343){if(I<=56319&&T+1<v.length){let P=v.charCodeAt(T+1);if(P>=56320&&P<=57343){T++;continue}}w+=`${v.slice(u,T)}\\u${I.toString(16)}`,u=T+1}}return w+=v.slice(u),w}function S(v){if(v.length>200)return v.sort();for(let w=1;w<v.length;w++){let u=v[w],T=w;for(;T!==0&&v[T-1]>u;)v[T]=v[T-1],T--;v[T]=u}return v}var E=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function L(v){return E.call(v)!==void 0&&v.length!==0}function y(v,w,u){v.length<u&&(u=v.length);let T=w===","?"":" ",I=`"0":${T}${v[0]}`;for(let P=1;P<u;P++)I+=`${w}"${P}":${T}${v[P]}`;return I}function k(v){if(r.call(v,"circularValue")){let w=v.circularValue;if(typeof w=="string")return`"${w}"`;if(w==null)return w;if(w===Error||w===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function b(v,w){let u;if(r.call(v,w)&&(u=v[w],typeof u!="boolean"))throw new TypeError(`The "${w}" argument must be of type boolean`);return u===void 0?!0:u}function U(v,w){let u;if(r.call(v,w)){if(u=v[w],typeof u!="number")throw new TypeError(`The "${w}" argument must be of type number`);if(!Number.isInteger(u))throw new TypeError(`The "${w}" argument must be an integer`);if(u<1)throw new RangeError(`The "${w}" argument must be >= 1`)}return u===void 0?1/0:u}function C(v){return v===1?"1 item":`${v} items`}function K(v){let w=new Set;for(let u of v)(typeof u=="string"||typeof u=="number")&&w.add(String(u));return w}function z(v){if(r.call(v,"strict")){let w=v.strict;if(typeof w!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(w)return u=>{let T=`Object can not safely be stringified. Received type ${typeof u}`;throw typeof u!="function"&&(T+=` (${u.toString()})`),new Error(T)}}}function x(v){v={...v};let w=z(v);w&&(v.bigint===void 0&&(v.bigint=!1),"circularValue"in v||(v.circularValue=Error));let u=k(v),T=b(v,"bigint"),I=b(v,"deterministic"),P=U(v,"maximumDepth"),q=U(v,"maximumBreadth");function G(nt,B,O,W,F,Z){let ot=B[nt];switch(typeof ot=="object"&&ot!==null&&typeof ot.toJSON=="function"&&(ot=ot.toJSON(nt)),ot=W.call(B,nt,ot),typeof ot){case"string":return`"${p(ot)}"`;case"object":{if(ot===null)return"null";if(O.indexOf(ot)!==-1)return u;let ut="",gt=",",rt=Z;if(Array.isArray(ot)){if(ot.length===0)return"[]";if(P<O.length+1)return'"[Array]"';O.push(ot),F!==""&&(Z+=F,ut+=`
${Z}`,gt=`,
${Z}`);let N=Math.min(ot.length,q),$=0;for(;$<N-1;$++){let X=G($,ot,O,W,F,Z);ut+=X!==void 0?X:"null",ut+=gt}let M=G($,ot,O,W,F,Z);if(ut+=M!==void 0?M:"null",ot.length-1>q){let X=ot.length-q-1;ut+=`${gt}"... ${C(X)} not stringified"`}return F!==""&&(ut+=`
${rt}`),O.pop(),`[${ut}]`}let ht=Object.keys(ot),mt=ht.length;if(mt===0)return"{}";if(P<O.length+1)return'"[Object]"';let dt="",wt="";F!==""&&(Z+=F,gt=`,
${Z}`,dt=" ");let St=Math.min(mt,q);L(ot)&&(ut+=y(ot,gt,q),ht=ht.slice(ot.length),St-=ot.length,wt=gt),I&&(ht=S(ht)),O.push(ot);for(let N=0;N<St;N++){let $=ht[N],M=G($,ot,O,W,F,Z);M!==void 0&&(ut+=`${wt}"${p($)}":${dt}${M}`,wt=gt)}if(mt>q){let N=mt-q;ut+=`${wt}"...":${dt}"${C(N)} not stringified"`,wt=gt}return F!==""&&wt.length>1&&(ut=`
${Z}${ut}
${rt}`),O.pop(),`{${ut}}`}case"number":return isFinite(ot)?String(ot):w?w(ot):"null";case"boolean":return ot===!0?"true":"false";case"undefined":return;case"bigint":if(T)return String(ot);default:return w?w(ot):void 0}}function et(nt,B,O,W,F,Z){switch(typeof B=="object"&&B!==null&&typeof B.toJSON=="function"&&(B=B.toJSON(nt)),typeof B){case"string":return`"${p(B)}"`;case"object":{if(B===null)return"null";if(O.indexOf(B)!==-1)return u;let ot=Z,ut="",gt=",";if(Array.isArray(B)){if(B.length===0)return"[]";if(P<O.length+1)return'"[Array]"';O.push(B),F!==""&&(Z+=F,ut+=`
${Z}`,gt=`,
${Z}`);let mt=Math.min(B.length,q),dt=0;for(;dt<mt-1;dt++){let St=et(dt,B[dt],O,W,F,Z);ut+=St!==void 0?St:"null",ut+=gt}let wt=et(dt,B[dt],O,W,F,Z);if(ut+=wt!==void 0?wt:"null",B.length-1>q){let St=B.length-q-1;ut+=`${gt}"... ${C(St)} not stringified"`}return F!==""&&(ut+=`
${ot}`),O.pop(),`[${ut}]`}if(W.size===0)return"{}";O.push(B);let rt="";F!==""&&(Z+=F,gt=`,
${Z}`,rt=" ");let ht="";for(let mt of W){let dt=et(mt,B[mt],O,W,F,Z);dt!==void 0&&(ut+=`${ht}"${p(mt)}":${rt}${dt}`,ht=gt)}return F!==""&&ht.length>1&&(ut=`
${Z}${ut}
${ot}`),O.pop(),`{${ut}}`}case"number":return isFinite(B)?String(B):w?w(B):"null";case"boolean":return B===!0?"true":"false";case"undefined":return;case"bigint":if(T)return String(B);default:return w?w(B):void 0}}function J(nt,B,O,W,F){switch(typeof B){case"string":return`"${p(B)}"`;case"object":{if(B===null)return"null";if(typeof B.toJSON=="function"){if(B=B.toJSON(nt),typeof B!="object")return J(nt,B,O,W,F);if(B===null)return"null"}if(O.indexOf(B)!==-1)return u;let Z=F;if(Array.isArray(B)){if(B.length===0)return"[]";if(P<O.length+1)return'"[Array]"';O.push(B),F+=W;let dt=`
${F}`,wt=`,
${F}`,St=Math.min(B.length,q),N=0;for(;N<St-1;N++){let M=J(N,B[N],O,W,F);dt+=M!==void 0?M:"null",dt+=wt}let $=J(N,B[N],O,W,F);if(dt+=$!==void 0?$:"null",B.length-1>q){let M=B.length-q-1;dt+=`${wt}"... ${C(M)} not stringified"`}return dt+=`
${Z}`,O.pop(),`[${dt}]`}let ot=Object.keys(B),ut=ot.length;if(ut===0)return"{}";if(P<O.length+1)return'"[Object]"';F+=W;let gt=`,
${F}`,rt="",ht="",mt=Math.min(ut,q);L(B)&&(rt+=y(B,gt,q),ot=ot.slice(B.length),mt-=B.length,ht=gt),I&&(ot=S(ot)),O.push(B);for(let dt=0;dt<mt;dt++){let wt=ot[dt],St=J(wt,B[wt],O,W,F);St!==void 0&&(rt+=`${ht}"${p(wt)}": ${St}`,ht=gt)}if(ut>q){let dt=ut-q;rt+=`${ht}"...": "${C(dt)} not stringified"`,ht=gt}return ht!==""&&(rt=`
${F}${rt}
${Z}`),O.pop(),`{${rt}}`}case"number":return isFinite(B)?String(B):w?w(B):"null";case"boolean":return B===!0?"true":"false";case"undefined":return;case"bigint":if(T)return String(B);default:return w?w(B):void 0}}function tt(nt,B,O){switch(typeof B){case"string":return`"${p(B)}"`;case"object":{if(B===null)return"null";if(typeof B.toJSON=="function"){if(B=B.toJSON(nt),typeof B!="object")return tt(nt,B,O);if(B===null)return"null"}if(O.indexOf(B)!==-1)return u;let W="";if(Array.isArray(B)){if(B.length===0)return"[]";if(P<O.length+1)return'"[Array]"';O.push(B);let gt=Math.min(B.length,q),rt=0;for(;rt<gt-1;rt++){let mt=tt(rt,B[rt],O);W+=mt!==void 0?mt:"null",W+=","}let ht=tt(rt,B[rt],O);if(W+=ht!==void 0?ht:"null",B.length-1>q){let mt=B.length-q-1;W+=`,"... ${C(mt)} not stringified"`}return O.pop(),`[${W}]`}let F=Object.keys(B),Z=F.length;if(Z===0)return"{}";if(P<O.length+1)return'"[Object]"';let ot="",ut=Math.min(Z,q);L(B)&&(W+=y(B,",",q),F=F.slice(B.length),ut-=B.length,ot=","),I&&(F=S(F)),O.push(B);for(let gt=0;gt<ut;gt++){let rt=F[gt],ht=tt(rt,B[rt],O);ht!==void 0&&(W+=`${ot}"${p(rt)}":${ht}`,ot=",")}if(Z>q){let gt=Z-q;W+=`${ot}"...":"${C(gt)} not stringified"`}return O.pop(),`{${W}}`}case"number":return isFinite(B)?String(B):w?w(B):"null";case"boolean":return B===!0?"true":"false";case"undefined":return;case"bigint":if(T)return String(B);default:return w?w(B):void 0}}function st(nt,B,O){if(arguments.length>1){let W="";if(typeof O=="number"?W=" ".repeat(Math.min(O,10)):typeof O=="string"&&(W=O.slice(0,10)),B!=null){if(typeof B=="function")return G("",{"":nt},[],B,W,"");if(Array.isArray(B))return et("",nt,[],K(B),W,"")}if(W.length!==0)return J("",nt,[],W,"")}return tt("",nt,[])}return st}});at();at();at();var Ii={silly:0,trace:1,debug:2,info:3,warn:4,error:5,fatal:6,none:7};function dr(t){return Ii[t]}var Oi=class{constructor(t,e){this.moduleName=t,this.settings=e}trace(t,...e){this.shouldLog("trace")&&console.debug(this.message("trace",t),e)}error(t,...e){this.shouldLog("error")&&console.error(this.message("error",t),e)}info(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}silly(t,...e){this.shouldLog("silly")&&console.debug(this.message("silly",t),e)}debug(t,...e){this.shouldLog("debug")&&console.debug(this.message("debug",t),e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.message("warn",t),e)}log(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}fatal(t,...e){this.shouldLog("fatal")&&console.error(this.message("fatal",t),e)}shouldLog(t){return dr(t)>=dr(this.settings.minLevel)}setSettings(t){this.settings=t}message(t,e){return`${new Date().toISOString()} ${t.toUpperCase()} [${this.moduleName}] ${e}`}};at();var Li=class{constructor(){j(this,"registeredLoggers",{});j(this,"registeredOptions",{});j(this,"defOptions",{minLevel:"info"});this.setOptions=this.setOptions.bind(this),this.getOptions=this.getOptions.bind(this),this.create=this.create.bind(this),this.logLevel=this.logLevel.bind(this)}setOptions(t,e){e?this.registeredLoggers[e]?this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t}):this.registeredOptions[e]={...this.defOptions,...t}:(this.defOptions=t,Object.keys(this.registeredLoggers).forEach(r=>{this.registeredLoggers[r].setSettings({...this.registeredLoggers[r].settings,...t})}))}getOptions(t){return t?this.registeredLoggers[t]?this.registeredLoggers[t].settings:this.registeredOptions[t]?this.registeredOptions[t]:this.defOptions:this.defOptions}logLevel(t,e){this.setOptions({minLevel:t},e)}create(t="SWC"){return Object.prototype.hasOwnProperty.call(this.registeredLoggers,t)||(this.registeredLoggers[t]=new Oi(t,this.getOptions(t))),this.registeredLoggers[t]}};at();var ae=class{constructor(){}setOptions(t,e){ae.INST.setOptions(t,e)}getOptions(t){return ae.INST.getOptions(t)}logLevel(t,e){ae.INST.logLevel(t,e)}create(t){return ae.INST.create(t)}static use(t){ae.INST=t}},xt=ae;he(xt,"INST",new Li);at();var It=class{constructor(){j(this,"start",Date.now());j(this,"end",null)}static measure(){return new It}reset(){this.start=Date.now(),this.end=null}stop(){this.end=Date.now()}elapsed(t=!1){this.end===null&&(this.end=Date.now());let e=this.end-this.start;return t?e:`${(this.end-this.start).toFixed(0)}ms`}};at();var Wt=class{constructor(t,e){this.key=t,this.sortKey=e}},Pt=class{constructor(t,e){this.sortKey=t,this.cachedValue=e}};at();var Bi=Lt(gi()),Ni=Lt(pi()),pr=class{constructor(t,e=!1){this.value=t,this.tomb=e}},Ee=class{constructor(t){j(this,"ongoingTransactionMark","$$warp-internal-transaction$$");j(this,"logger",xt.INST.create("LevelDbCache"));j(this,"subLevelSeparator");j(this,"subLevelOptions");j(this,"_db");j(this,"_rollbackBatch");this.cacheOptions=t,this.subLevelSeparator=t.subLevelSeparator||"!",this.subLevelOptions={valueEncoding:"json",separator:this.subLevelSeparator}}get db(){if(!this._db)if(this.cacheOptions.inMemory)this._db=new Ni.MemoryLevel(this.subLevelOptions);else{if(!this.cacheOptions.dbLocation)throw new Error("LevelDb cache configuration error - no db location specified");let t=this.cacheOptions.dbLocation;this.logger.info(`Using location ${t}`),this._db=new Bi.Level(t,this.subLevelOptions)}return this._db}async get(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open();let i=await this.getValueFromLevel(t.sortKey,r);return i?new Pt(t.sortKey,i):null}async getLast(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open();let r=await e.keys({reverse:!0,limit:1}).all();if(r.length){let i=await this.getValueFromLevel(r[0],e);if(i)return new Pt(r[0],i)}return null}async getLessOrEqual(t,e){let r=this.db.sublevel(t,this.subLevelOptions);await r.open();let i=await r.keys({reverse:!0,lte:e,limit:1}).all();if(i.length){let a=await this.getValueFromLevel(i[0],r);if(a!=null)return new Pt(i[0],a)}return null}async getValueFromLevel(t,e){try{let r=await e.get(t);if(r&&r.tomb===void 0&&r.value===void 0)return r;if(r&&r.tomb===!1&&r.value!=null)return r.value}catch(r){if(r.code!="LEVEL_NOT_FOUND")throw r}return null}async put(t,e){await this.setClientValue(t,new pr(e))}async del(t){await this.setClientValue(t,new pr(null,!0))}async setClientValue(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open(),await r.put(t.sortKey,e),this._rollbackBatch&&this._rollbackBatch.del(t.sortKey,{sublevel:r})}async delete(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open(),await e.clear()}async batch(t){for(let e of t)e.type==="put"?await this.put(e.key,e.value):e.type==="del"&&await this.delete(e.key)}async open(){await this.db.open()}async close(){this._db&&await this._db.close()}async begin(){await this.initRollbackBatch()}async rollback(){this._rollbackBatch&&(this._rollbackBatch.del(this.ongoingTransactionMark),await this._rollbackBatch.write(),await this._rollbackBatch.close()),this._rollbackBatch=null}async initRollbackBatch(){return this._rollbackBatch==null&&(await this.checkPreviousTransactionFinished(),await this.db.put(this.ongoingTransactionMark,"ongoing"),this._rollbackBatch=this.db.batch()),this._rollbackBatch}async checkPreviousTransactionFinished(){let t;try{t=await this.db.get(this.ongoingTransactionMark)}catch(e){if(e.code!="LEVEL_NOT_FOUND")throw e}if(t=="ongoing")throw new Error("Database seems to be in inconsistent state. The previous transaction has not finished.")}async commit(){this._rollbackBatch&&(await this._rollbackBatch.clear(),await this.db.del(this.ongoingTransactionMark),await this._rollbackBatch.close()),this._rollbackBatch=null}async dump(){return await this.db.iterator().all()}async getLastSortKey(){let t="";await this.db.open();let e=await this.db.keys().all();for(let r of e){let i=r.split(this.subLevelSeparator)[1];i.localeCompare(t)>0&&(t=i)}return t==""?null:t}async keys(t,e){return Array.from((await this.kvMap(t,e)).keys())}validateKey(t){if(t.includes(this.ongoingTransactionMark))throw new Error(`Validation error: Key ${t} for internal use only`);if(t.includes(this.subLevelSeparator))throw new Error(`Validation error: key ${t} contains db separator ${this.subLevelSeparator}`)}extractOriginalKey(t){return t.split(this.subLevelSeparator)[1]}extractSortKey(t){return t.split(this.subLevelSeparator)[2]}async kvMap(t,e){let r=new Map,i=(await this.db.keys(this.levelRangeOptions(e)).all()).filter(a=>a!=this.ongoingTransactionMark).filter(a=>!t||this.extractSortKey(a).localeCompare(t)<=0).map(a=>this.extractOriginalKey(a));for(let a of i){let c=await this.getLessOrEqual(a,t);c&&r.set(a,c.cachedValue)}if(e!=null&&e.limit){let a=new Map;for(let c of Array.from(r.entries()).slice(0,e.limit))a.set(c[0],c[1]);return a}return r}levelRangeOptions(t){let e={reverse:t==null?void 0:t.reverse};return t!=null&&t.gte&&(e.gte=this.subLevelSeparator+t.gte),t!=null&&t.lt&&(e.lt=this.subLevelSeparator+t.lt),e}storage(){return this.db}async getNumEntries(){return(await this.db.keys().all()).length}async prune(t=5){(!t||t<=0)&&(t=1);let e=await this.allKeys();for(let r=0;r<e.length;r++){let i=this.db.sublevel(e[r],this.subLevelOptions);await i.open();let a=await i.keys({reverse:!0,limit:t}).all();!a||a.length<t||(await i.clear({lt:a[a.length-1]}),await i.close())}return null}async allKeys(){return(await this.db.keys().all()).filter(t=>t!=this.ongoingTransactionMark).map(t=>this.extractOriginalKey(t))}};at();var ms=class{constructor(){j(this,"storage",{})}clearAll(){Object.keys(this.storage).forEach(t=>{delete this.storage[t]})}contains(t){return Object.prototype.hasOwnProperty.call(this.storage,t)}get(t){return this.storage[t]}put(t,e){this.storage[t]=e}remove(t){delete this.storage[t]}};at();at();Lt(te());at();at();var Ri=Function.prototype.toString,Le=Object.create,Ui=Object.prototype.toString,$i=function(){function t(){this._keys=[],this._values=[]}return t.prototype.has=function(e){return!!~this._keys.indexOf(e)},t.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},t.prototype.set=function(e,r){this._keys.push(e),this._values.push(r)},t}();function Pi(){return new $i}function Mi(){return new WeakMap}var ji=typeof WeakMap<"u"?Mi:Pi;function rr(t){if(!t)return Le(null);var e=t.constructor;if(e===Object)return t===Object.prototype?{}:Le(t);if(~Ri.call(e).indexOf("[native code]"))try{return new e}catch{}return Le(t)}function Di(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}function Ki(t){return t.flags}var Wi=/test/g.flags==="g"?Ki:Di;function Gr(t){var e=Ui.call(t);return e.substring(8,e.length-1)}function Fi(t){return t[Symbol.toStringTag]||Gr(t)}var Vi=typeof Symbol<"u"?Fi:Gr,Gi=Object.defineProperty,qi=Object.getOwnPropertyDescriptor,qr=Object.getOwnPropertyNames,nr=Object.getOwnPropertySymbols,Hr=Object.prototype,zr=Hr.hasOwnProperty,Hi=Hr.propertyIsEnumerable,Jr=typeof nr=="function";function zi(t){return qr(t).concat(nr(t))}var Ji=Jr?zi:qr;function Ce(t,e,r){for(var i=Ji(t),a=0,c=i.length,l=void 0,n=void 0;a<c;++a)if(l=i[a],!(l==="callee"||l==="caller")){if(n=qi(t,l),!n){e[l]=r.copier(t[l],r);continue}!n.get&&!n.set&&(n.value=r.copier(n.value,r));try{Gi(e,l,n)}catch{e[l]=n.value}}return e}function Qi(t,e){var r=new e.Constructor;e.cache.set(t,r);for(var i=0,a=t.length;i<a;++i)r[i]=e.copier(t[i],e);return r}function Yi(t,e){var r=new e.Constructor;return e.cache.set(t,r),Ce(t,r,e)}function Qr(t,e){return t.slice(0)}function Xi(t,e){return t.slice(0,t.size,t.type)}function Zi(t,e){return new e.Constructor(Qr(t.buffer))}function ta(t,e){return new e.Constructor(t.getTime())}function Yr(t,e){var r=new e.Constructor;return e.cache.set(t,r),t.forEach(function(i,a){r.set(a,e.copier(i,e))}),r}function ea(t,e){return Ce(t,Yr(t,e),e)}function ra(t,e){var r=rr(e.prototype);e.cache.set(t,r);for(var i in t)zr.call(t,i)&&(r[i]=e.copier(t[i],e));return r}function na(t,e){var r=rr(e.prototype);e.cache.set(t,r);for(var i in t)zr.call(t,i)&&(r[i]=e.copier(t[i],e));for(var a=nr(t),c=0,l=a.length,n=void 0;c<l;++c)n=a[c],Hi.call(t,n)&&(r[n]=e.copier(t[n],e));return r}var ia=Jr?na:ra;function aa(t,e){var r=rr(e.prototype);return e.cache.set(t,r),Ce(t,r,e)}function Be(t,e){return new e.Constructor(t.valueOf())}function oa(t,e){var r=new e.Constructor(t.source,Wi(t));return r.lastIndex=t.lastIndex,r}function be(t,e){return t}function Xr(t,e){var r=new e.Constructor;return e.cache.set(t,r),t.forEach(function(i){r.add(e.copier(i,e))}),r}function sa(t,e){return Ce(t,Xr(t,e),e)}var la=Array.isArray,ir=Object.assign,ca=Object.getPrototypeOf||function(t){return t.__proto__},Zr={array:Qi,arrayBuffer:Qr,blob:Xi,dataView:Zi,date:ta,error:be,map:Yr,object:ia,regExp:oa,set:Xr},ua=ir({},Zr,{array:Yi,map:ea,object:aa,set:sa});function ha(t){return{Arguments:t.object,Array:t.array,ArrayBuffer:t.arrayBuffer,Blob:t.blob,Boolean:Be,DataView:t.dataView,Date:t.date,Error:t.error,Float32Array:t.arrayBuffer,Float64Array:t.arrayBuffer,Int8Array:t.arrayBuffer,Int16Array:t.arrayBuffer,Int32Array:t.arrayBuffer,Map:t.map,Number:Be,Object:t.object,Promise:be,RegExp:t.regExp,Set:t.set,String:Be,WeakMap:be,WeakSet:be,Uint8Array:t.arrayBuffer,Uint8ClampedArray:t.arrayBuffer,Uint16Array:t.arrayBuffer,Uint32Array:t.arrayBuffer,Uint64Array:t.arrayBuffer}}function tn(t){var e=ir({},Zr,t),r=ha(e),i=r.Array,a=r.Object;function c(l,n){if(n.prototype=n.Constructor=void 0,!l||typeof l!="object")return l;if(n.cache.has(l))return n.cache.get(l);if(n.prototype=ca(l),n.Constructor=n.prototype&&n.prototype.constructor,!n.Constructor||n.Constructor===Object)return a(l,n);if(la(l))return i(l,n);var p=r[Vi(l)];return p?p(l,n):typeof l.then=="function"?l:a(l,n)}return function(l){return c(l,{Constructor:void 0,cache:ji(),copier:c,prototype:void 0})}}function fa(t){return tn(ir({},ua,t))}fa({});var ga=tn({});at();at();var da=class{constructor(t,e,r,i,a){j(this,"gasUsed");j(this,"gasLimit");j(this,"transaction");j(this,"block");j(this,"vrf");j(this,"evaluationOptions");j(this,"arweave");j(this,"contract");j(this,"unsafeClient");j(this,"baseArweaveUrl");j(this,"safeArweaveGet");j(this,"contracts");j(this,"extensions");j(this,"_activeTx");j(this,"caller");j(this,"kv");this.gasUsed=0,this.gasLimit=Number.MAX_SAFE_INTEGER,this.unsafeClient=t,this.arweave={ar:t.ar,utils:t.utils,wallets:t.wallets,crypto:t.crypto},this.baseArweaveUrl=`${t.api.config.protocol}://${t.api.config.host}:${t.api.config.port}`,this.safeArweaveGet=async function(c){return Ca(`${this.baseArweaveUrl}${c}`)},this.evaluationOptions=r,this.contract=e,this.transaction=new en(this),this.block=new rn(this),this.contracts={readContractState:(c,l,n)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},viewContractState:(c,l)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},write:(c,l,n)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},refreshState:()=>{throw new Error("Not implemented - should be set by HandlerApi implementor")}},this.vrf=new nn(this),this.useGas=this.useGas.bind(this),this.getBalance=this.getBalance.bind(this),this.extensions={},this.kv=new pa(a,i,this.transaction,this.contract.id)}useGas(t){if(t<0)throw new Error("[RE:GNE] Gas number exception - gas < 0.");if(this.gasUsed+=t,this.gasUsed>this.gasLimit)throw new Error(`[RE:OOG] Out of gas! Used: ${this.gasUsed}, limit: ${this.gasLimit}`)}async getBalance(t,e){if(!this._activeTx)throw new Error("Cannot read balance - active tx is not set.");if(!this.block.height)throw new Error("Cannot read balance - block height not set.");let r=e||this.block.height;return await fetch(`${this.evaluationOptions.walletBalanceUrl}block/height/${r}/wallet/${t}/balance`).then(i=>i.ok?i.text():Promise.reject(i)).catch(i=>{var a;throw new Error(`Unable to read wallet balance. ${i.status}. ${(a=i.body)==null?void 0:a.message}`)})}},en=class{constructor(t){this.smartWeaveGlobal=t}get id(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.id}get owner(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.owner.address}get target(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.recipient}get tags(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.tags}get sortKey(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.sortKey}get dryRun(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.dry===!0}get quantity(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.quantity.winston}get reward(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.fee.winston}get origin(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.source==="redstone-sequencer"?"L2":"L1"}},rn=class{constructor(t){this.smartWeaveGlobal=t}get height(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.height}get indep_hash(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.id}get timestamp(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current tx");return this.smartWeaveGlobal._activeTx.block.timestamp}},nn=class{constructor(t){this.smartWeaveGlobal=t}get data(){return this.smartWeaveGlobal._activeTx.vrf}get value(){return this.smartWeaveGlobal._activeTx.vrf.bigint}randomInt(t){if(!Number.isInteger(t))throw new Error("Integer max value required for random integer generation");let e=BigInt(this.smartWeaveGlobal._activeTx.vrf.bigint)%BigInt(t)+BigInt(1);if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw new Error("Random int cannot be cast to number");return Number(e)}},pa=class{constructor(t,e,r,i){this._storage=t,this._interactionState=e,this._transaction=r,this._contractTxId=i}async put(t,e){this.checkStorageAvailable(),await this._storage.put(new Wt(t,this._transaction.sortKey),e)}async get(t){var r;return this.checkStorageAvailable(),this._transaction.sortKey,await this._interactionState.getKV(this._contractTxId,new Wt(t,this._transaction.sortKey))??((r=await this._storage.getLessOrEqual(t,this._transaction.sortKey))==null?void 0:r.cachedValue)??null}async del(t){this.checkStorageAvailable(),this._transaction.sortKey;let e=await this._interactionState.delKV(this._contractTxId,new Wt(t,this._transaction.sortKey));if(e!=null)return e;await this._storage.del(new Wt(t,this._transaction.sortKey))}async keys(t){let e=this._transaction.sortKey;return await this._storage.keys(e,t)}async kvMap(t){let e=this._transaction.sortKey;return this._storage.kvMap(e,t)}async begin(){if(this._storage)return this._storage.begin()}async commit(){this._storage&&(this._transaction.dryRun?await this._storage.rollback():await this._storage.commit())}async rollback(){this._storage&&await this._storage.rollback()}open(){if(this._storage)return this._storage.open()}close(){if(this._storage)return this._storage.close()}checkStorageAvailable(){if(!this._storage)throw new Error("KV Storage not available")}};at();at();var wa=(t,e,r,i,a)=>{let c=xt.INST.create("WASM:Rust"),l={metering:{usegas:t.useGas},console:{log:function(f){c.debug(`${t.contract.id}: ${f}`)}},Block:{height:function(){return t.block.height},indep_hash:function(){return t.block.indep_hash},timestamp:function(){return t.block.timestamp}},Transaction:{id:function(){return t.transaction.id},owner:function(){return t.transaction.owner},target:function(){return t.transaction.target}},Contract:{id:function(){return t.contract.id},owner:function(){return t.contract.owner}},KV:{get:async function(f){return await t.kv.get(f)},put:async function(f,_){await t.kv.put(f,_)}},SmartWeave:{caller:function(){return t.caller},readContractState:async function(f){return await t.contracts.readContractState(f)},viewContractState:async function(f,_){return await t.contracts.viewContractState(f,_)},write:async function(f,_){return await t.contracts.write(f,_,!1)}},Vrf:{value:function(){return t.vrf.value},randomInt:function(f){return t.vrf.randomInt(f)}}},n=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});n.decode();let p=null;function S(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(r.exports.memory.buffer)),p}function E(f,_){return n.decode(S().subarray(f,f+_))}let L=new Array(128).fill(void 0);L.push(void 0,null,!0,!1);let y=L.length;function k(f){y===L.length&&L.push(L.length+1);let _=y;if(y=L[_],typeof y!="number")throw new Error("corrupt heap");return L[_]=f,_}function b(f){return L[f]}function U(f){if(typeof f!="boolean")throw new Error("expected a boolean argument")}function C(f){return f==null}function K(f){if(typeof f!="number")throw new Error("expected a number argument")}let z=null;function x(){return(z===null||z.byteLength===0)&&(z=new Float64Array(r.exports.memory.buffer)),z}let v=null;function w(){return(v===null||v.byteLength===0)&&(v=new Int32Array(r.exports.memory.buffer)),v}let u=0,T=new TextEncoder("utf-8"),I=typeof T.encodeInto=="function"?function(f,_){return T.encodeInto(f,_)}:function(f,_){let D=T.encode(f);return _.set(D),{read:f.length,written:D.length}};function P(f,_,D){if(typeof f!="string")throw new Error("expected a string argument");if(D===void 0){let g=T.encode(f),m=_(g.length);return S().subarray(m,m+g.length).set(g),u=g.length,m}let Y=f.length,lt=_(Y),ft=S(),o=0;for(;o<Y;o++){let g=f.charCodeAt(o);if(g>127)break;ft[lt+o]=g}if(o!==Y){o!==0&&(f=f.slice(o)),lt=D(lt,Y,Y=o+f.length*3);let g=S().subarray(lt+o,lt+Y),m=I(f,g);if(m.read!==f.length)throw new Error("failed to pass whole string");o+=m.written}return u=o,lt}function q(f){f<132||(L[f]=y,y=f)}function G(f){let _=b(f);return q(f),_}function et(f){let _=typeof f;if(_=="number"||_=="boolean"||f==null)return`${f}`;if(_=="string")return`"${f}"`;if(_=="symbol"){let lt=f.description;return lt==null?"Symbol":`Symbol(${lt})`}if(_=="function"){let lt=f.name;return typeof lt=="string"&&lt.length>0?`Function(${lt})`:"Function"}if(Array.isArray(f)){let lt=f.length,ft="[";lt>0&&(ft+=et(f[0]));for(let o=1;o<lt;o++)ft+=", "+et(f[o]);return ft+="]",ft}let D=/\[object ([^\]]+)\]/.exec(toString.call(f)),Y;if(D.length>1)Y=D[1];else return toString.call(f);if(Y=="Object")try{return"Object("+JSON.stringify(f)+")"}catch{return"Object"}return f instanceof Error?`${f.name}: ${f.message}
${f.stack}`:Y}function J(f){if(typeof f!="bigint")throw new Error("expected a bigint argument")}let tt=null;function st(){return(tt===null||tt.byteLength===0)&&(tt=new BigInt64Array(r.exports.memory.buffer)),tt}function nt(f,_,D,Y){let lt={a:f,b:_,cnt:1,dtor:D},ft=(...o)=>{lt.cnt++;let g=lt.a;lt.a=0;try{return Y(g,lt.b,...o)}finally{--lt.cnt===0?r.exports.__wbindgen_export_2.get(lt.dtor)(g,lt.b):lt.a=g}};return ft.original=lt,ft}function B(f,_){try{return f.apply(this,_)}catch(D){let Y=function(){try{return D instanceof Error?`${D.message}

Stack:
${D.stack}`:D.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",Y),D}}function O(f,_,D){K(f),K(_),r.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__(f,_,k(D))}function W(f){let _=r.exports.warpContractWrite(k(f));return G(_)}function F(f){var _=r.exports.handle(k(f));return G(_)}let Z=128;function ot(f){if(Z==1)throw new Error("out of js stack");return L[--Z]=f,Z}function ut(f){try{let Y=r.exports.__wbindgen_add_to_stack_pointer(-16);r.exports.initState(Y,ot(f));var _=w()[Y/4+0],D=w()[Y/4+1];let lt;return _!==0&&(lt=E(_,D).slice(),r.exports.__wbindgen_free(_,D*1)),lt}finally{r.exports.__wbindgen_add_to_stack_pointer(16),L[Z++]=void 0}}function gt(f){try{r.exports.initState(ot(f))}finally{L[Z++]=void 0}}function rt(){let f=r.exports.currentState();return G(f)}function ht(){return r.exports.version()}function mt(){return r.exports.lang()}function dt(f){let _=r.exports.warpContractView(k(f));return G(_)}function wt(f,_){try{return f.apply(this,_)}catch(D){r.exports.__wbindgen_exn_store(k(D))}}function St(f,_,D,Y){K(f),K(_),r.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__(f,_,k(D),k(Y))}function N(f){return()=>{throw new Error(`${f} is not defined`)}}let $={__wbindgen_json_parse:function(f,_){let D=JSON.parse(E(f,_));return k(D)},__wbindgen_json_serialize:function(f,_){let D=b(_),Y=JSON.stringify(D===void 0?null:D),lt=P(Y,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),ft=u;w()[f/4+1]=ft,w()[f/4+0]=lt},__wbindgen_error_new:function(f,_){let D=new Error(E(f,_));return k(D)},__wbindgen_is_undefined:function(f){let _=b(f)===void 0;return U(_),_},__wbindgen_in:function(f,_){let D=b(f)in b(_);return U(D),D},__wbindgen_number_get:function(f,_){let D=b(_),Y=typeof D=="number"?D:void 0;C(Y)||K(Y),x()[f/8+1]=C(Y)?0:Y,w()[f/4+0]=!C(Y)},__wbindgen_boolean_get:function(f){let _=b(f),D=typeof _=="boolean"?_?1:0:2;return K(D),D},__wbindgen_is_null:function(f){let _=b(f)===null;return U(_),_},__wbindgen_string_new:function(f,_){let D=E(f,_);return k(D)},__wbindgen_string_get:function(f,_){let D=b(_),Y=typeof D=="string"?D:void 0;var lt=C(Y)?0:P(Y,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),ft=u;w()[f/4+1]=ft,w()[f/4+0]=lt},__wbindgen_is_bigint:function(f){let _=typeof b(f)=="bigint";return U(_),_},__wbindgen_is_object:function(f){let _=b(f),D=typeof _=="object"&&_!==null;return U(D),D},__wbindgen_object_clone_ref:function(f){let _=b(f);return k(_)},__wbindgen_jsval_eq:function(f,_){let D=b(f)===b(_);return U(D),D},__wbindgen_bigint_from_i64:function(f){return k(f)},__wbindgen_bigint_from_u64:function(f){let _=BigInt.asUintN(64,f);return k(_)},__wbg_readContractState:function(){return wt(function(f,_){let D=l.SmartWeave.readContractState(E(f,_));return k(D)},arguments)},__wbg_viewContractState:function(){return wt(function(f,_,D){let Y=l.SmartWeave.viewContractState(E(f,_),G(D));return k(Y)},arguments)},__wbg_write:function(){return wt(function(f,_,D){let Y=l.SmartWeave.write(E(f,_),G(D));return k(Y)},arguments)},__wbg_refreshState:function(f,_){},__wbg_kvGet:function(){return wt(function(f,_){let D=l.KV.get(E(f,_));return k(D)},arguments)},__wbg_kvPut:function(){return wt(function(f,_,D){let Y=l.KV.put(E(f,_),G(D));return k(Y)},arguments)},__wbindgen_object_drop_ref:function(f){G(f)},__wbg_error:function(){return B(function(f,_){try{l.console.log(E(f,_))}finally{r.exports.__wbindgen_free(f,_)}},arguments)},__wbg_new_abda76e883ba8a5f:function(){return B(function(){let f=new Error;return k(f)},arguments)},__wbg_stack:function(){return B(function(f,_){let D=Error.stackTraceLimit;Error.stackTraceLimit=25;let Y=b(_).stack,lt=P(Y,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),ft=u;w()[f/4+1]=ft,w()[f/4+0]=lt,Error.stackTraceLimit=D},arguments)},__wbg_indephash:function(){return B(function(f){let _=l.Block.indep_hash(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_height:function(){return B(function(){let f=l.Block.height();return K(f),f},arguments)},__wbg_timestamp:function(){return B(function(){let f=l.Block.timestamp();return K(f),f},arguments)},__wbg_contractId:function(){return B(function(f){let _=l.Contract.id(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_contractOwner:function(){return B(function(f){let _=l.Contract.owner(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_id:function(){return B(function(f){let _=l.Transaction.id(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_owner:function(){return B(function(f){let _=l.Transaction.owner(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_target:function(){return B(function(f){let _=l.Transaction.target(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_caller:function(){return B(function(f){let _=l.SmartWeave.caller(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_value_b245bf3240b21a48:function(){return B(function(f){let _=l.Vrf.value(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_value_7d69ddc3f1ad7876:function(){return B(function(f){let _=l.Vrf.value(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_vrfValue:function(){return B(function(f){let _=l.Vrf.value(),D=P(_,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),Y=u;w()[f/4+1]=Y,w()[f/4+0]=D},arguments)},__wbg_randomInt:function(){return B(function(f){let _=l.Vrf.randomInt(f);return K(_),_},arguments)},__wbg_log:function(){return B(function(f,_){l.console.log(E(f,_))},arguments)},__wbindgen_cb_drop:function(f){let _=G(f).original;if(_.cnt--==1)return _.a=0,!0;let D=!1;return U(D),D},__wbg_debug:function(){return B(function(f){console.log(b(f))},arguments)},__wbg_String:function(){return B(function(f,_){let D=String(b(_)),Y=P(D,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),lt=u;w()[f/4+1]=lt,w()[f/4+0]=Y},arguments)},__wbg_getwithrefkey:function(){return B(function(f,_){let D=b(f)[b(_)];return k(D)},arguments)},__wbg_set_841ac57cff3d672b:function(){return B(function(f,_,D){b(f)[G(_)]=G(D)},arguments)},__wbindgen_number_new:function(f){return k(f)},__wbindgen_jsval_loose_eq:function(f,_){let D=b(f)==b(_);return U(D),D},__wbg_get_27fe3dac1c4d0224:function(){return B(function(f,_){let D=b(f)[_>>>0];return k(D)},arguments)},__wbg_set_17224bc548dd1d7b:function(){return B(function(f,_,D){b(f)[_>>>0]=G(D)},arguments)},__wbg_isArray:function(){return B(function(f){let _=Array.isArray(b(f));return U(_),_},arguments)},__wbg_length_e498fbc24f9c1d4f:function(){return B(function(f){let _=b(f).length;return K(_),_},arguments)},__wbg_new_b525de17f44a8943:function(){return B(function(){let f=new Array;return k(f)},arguments)},__wbg_instanceof_ArrayBuffer:function(){return B(function(f){let _;try{_=b(f)instanceof ArrayBuffer}catch{_=!1}let D=_;return U(D),D},arguments)},__wbg_call_95d1ea488d03e4e8:function(){return wt(function(f,_){let D=b(f).call(b(_));return k(D)},arguments)},__wbg_call_9495de66fdbe016b:function(){return wt(function(f,_,D){let Y=b(f).call(b(_),b(D));return k(Y)},arguments)},__wbg_call_94697a95cb7e239c:function(){return wt(function(f,_,D){let Y=b(f).call(b(_),b(D));return k(Y)},arguments)},__wbg_new_f841cc6f2098f4b5:function(){return B(function(){return k(new Map)},arguments)},__wbg_set_388c4c6422704173:function(){return B(function(f,_,D){let Y=b(f).set(b(_),b(D));return k(Y)},arguments)},__wbg_next_88560ec06a094dea:function(){return wt(function(f){let _=b(f).next();return k(_)},arguments)},__wbg_next_b7d530c04fd8b217:function(){return B(function(f){let _=b(f).next;return k(_)},arguments)},__wbg_done:function(){return B(function(f){let _=b(f).done;return U(_),_},arguments)},__wbg_value_6ac8da5cc5b3efda:function(){return B(function(f){let _=b(f).value;return k(_)},arguments)},__wbg_isSafeInteger:function(){return B(function(f){let _=Number.isSafeInteger(b(f));return U(_),_},arguments)},__wbg_entries:function(){return B(function(f){let _=Object.entries(b(f));return k(_)},arguments)},__wbg_new_f9876326328f45ed:function(){return B(function(){let f=new Object;return k(f)},arguments)},__wbg_iterator:function(){return B(function(){return k(Symbol.iterator)},arguments)},__wbg_new_9d3a9ce4282a18a8:function(){return B(function(f,_){try{var D={a:f,b:_},Y=(ft,o)=>{let g=D.a;D.a=0;try{return St(g,D.b,ft,o)}finally{D.a=g}};let lt=new Promise(Y);return k(lt)}finally{D.a=D.b=0}},arguments)},__wbg_new_4beacc9c71572250:function(){return B(function(f,_){try{var D={a:f,b:_},Y=(ft,o)=>{let g=D.a;D.a=0;try{return St(g,D.b,ft,o)}finally{D.a=g}};let lt=new Promise(Y);return k(lt)}finally{D.a=D.b=0}},arguments)},__wbg_resolve:function(){return B(function(f){let _=Promise.resolve(b(f));return k(_)},arguments)},__wbg_then_ec5db6d509eb475f:function(){return B(function(f,_){let D=b(f).then(b(_));return k(D)},arguments)},__wbg_then_a6860c82b90816ca:function(){return B(function(f,_){let D=b(f).then(b(_));return k(D)},arguments)},__wbg_then_f753623316e2873a:function(){return B(function(f,_,D){let Y=b(f).then(b(_),b(D));return k(Y)},arguments)},__wbg_then_58a04e42527f52c6:function(){return B(function(f,_,D){let Y=b(f).then(b(_),b(D));return k(Y)},arguments)},__wbg_instanceof_Uint8Array:function(){return B(function(f){let _;try{_=b(f)instanceof Uint8Array}catch{_=!1}let D=_;return U(D),D},arguments)},__wbg_new_537b7341ce90bb31:function(){return B(function(f){let _=new Uint8Array(b(f));return k(_)},arguments)},__wbg_length_27a2afe8ab42b09f:function(){return B(function(f){let _=b(f).length;return K(_),_},arguments)},__wbg_set_17499e8aa4003ebd:function(){return B(function(f,_,D){b(f).set(b(_),D>>>0)},arguments)},__wbindgen_is_function:function(f){let _=typeof b(f)=="function";return U(_),_},__wbindgen_is_string:function(f){let _=typeof b(f)=="string";return U(_),_},__wbg_buffer:function(){return B(function(f){let _=b(f).buffer;return k(_)},arguments)},__wbg_get_baf4855f9a986186:function(){return wt(function(f,_){let D=Reflect.get(b(f),b(_));return k(D)},arguments)},__wbindgen_debug_string:function(f,_){let D=et(b(_)),Y=P(D,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),lt=u;w()[f/4+1]=lt,w()[f/4+0]=Y},__wbindgen_bigint_get_as_i64:function(f,_){let D=b(_),Y=typeof D=="bigint"?D:void 0;C(Y)||J(Y),st()[f/8+1]=C(Y)?BigInt(0):Y,w()[f/4+0]=!C(Y)},__wbindgen_throw:function(f,_){throw new Error(E(f,_))},__wbindgen_memory:function(){let f=r.exports.memory;return k(f)},__wbindgen_closure_wrapper:function(){return B(function(f,_,D){let Y=nt(f,_,i,O);return k(Y)},arguments)}},M={_assertBoolean:U,_assertNum:K,addBorrowedObject:ot,addHeapObject:k,getInt32Memory0:w,getObject:b,getStringFromWasm0:E,handleError:wt,heap:()=>L,logError:B,notDefined:N,passStringToWasm0:P,takeObject:G,wasm:()=>r.exports,WASM_VECTOR_LEN:()=>u,__wbg_adapter_4:St,__wbg_adapter_3:O};function X(f){return function(){return B(function(_){let D=f(G(_));return k(D)},arguments)}}function H(f,_){var Y;let D={};for(let[lt,ft]of Object.entries(f.extensions)){let o=((Y=ft.rustImports)==null?void 0:Y.call(ft,_))??{};for(let[g,m]of Object.entries(o))g.startsWith("__wbg_")?D[g]=m:D["__wbg_"+g]=X(m)}return D}let s={...$,...H(t,M)},h=Object.keys(s),d=e.reduce((f,_)=>{let D=h.find(Y=>_.startsWith(Y));if(D===void 0)throw new Error(`Cannot find import mapping for ${_}. Please file a bug.`);if(h.filter(Y=>_.startsWith(Y)).length!=1)throw new Error(`Multiple import mappings for ${_}. Please file a bug.`);if(f.usedKeys.has(D))throw new Error(`Multiple methods maps to ${D}. Please file a bug.`);return f.res[_]=s[D],f.usedKeys.add(D),f},{res:{},usedKeys:new Set}).res;a==="__WARP_CONTRACTS_VERSION_LEGACY"?(d.initStateLegacy=gt,d.handle=F):(d.initState=ut,d.warpContractWrite=W,d.warpContractView=dt),d.currentState=rt,d.version=ht,d.lang=mt;let A={};A.__wbindgen_placeholder__=d;class R{__destroy_into_raw(){let _=this.ptr;return this.ptr=0,_}free(){let _=this.__destroy_into_raw();r.exports.__wbg_statewrapper_free(_)}}return d.StateWrapper=R,A.metering=l.metering,{imports:A,exports:d}};at();at();var an=class{constructor(t,e){j(this,"logger",xt.INST.create("ContractHandler"));this.swGlobal=t,this.contractDefinition=e,this.assignReadContractState=this.assignReadContractState.bind(this),this.assignViewContractState=this.assignViewContractState.bind(this),this.assignWrite=this.assignWrite.bind(this),this.assignRefreshState=this.assignRefreshState.bind(this)}async dispose(){}assignWrite(t){this.swGlobal.contracts.write=async(e,r,i)=>{if(!t.evaluationOptions.internalWrites)throw new Error("Internal writes feature switched off. Change EvaluationOptions.internalWrites flag to 'true'");let a=i??t.evaluationOptions.throwOnInternalWriteError,c={from:this.contractDefinition.txId,to:e,input:r};this.logger.debug("swGlobal.write call:",c);let l=t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"write"}),n=await l.applyInput(r,this.swGlobal._activeTx);this.logger.debug("Cache result?:",!this.swGlobal._activeTx.dry);let p=n.type!=="ok"&&a&&(!this.swGlobal._activeTx.dry||this.swGlobal._activeTx.dry&&this.swGlobal._activeTx.strict),S=p?`Internal write auto error for call [${JSON.stringify(c)}]: ${n.errorMessage}`:n.errorMessage,E=S?{...n.originalErrorMessages,[this.swGlobal._activeTx.id]:S}:n.originalErrorMessages;if(l.interactionState().update(l.txId(),{state:n.state,validity:{...n.originalValidity,[this.swGlobal._activeTx.id]:n.type=="ok"},errorMessages:E},this.swGlobal._activeTx.sortKey),p)throw new Gt(n.type==="error"&&n.error?n.error:S);return n}}assignViewContractState(t){this.swGlobal.contracts.viewContractState=async(e,r)=>(this.logger.debug("swGlobal.viewContractState call:",{from:this.contractDefinition.txId,to:e,input:r}),await t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"view"}).viewStateForTx(r,this.swGlobal._activeTx))}assignReadContractState(t,e){this.swGlobal.contracts.readContractState=async(r,i)=>{var n,p,S;this.logger.debug("swGlobal.readContractState call:",{from:this.contractDefinition.txId,to:r,sortKey:e.sortKey,transaction:this.swGlobal.transaction.id});let{contract:a,warp:c}=t,l=await c.contract(r,a,{callingInteraction:e,callType:"read"}).readState(e.sortKey);if((n=l==null?void 0:l.cachedValue)!=null&&n.errorMessages){let E=Reflect.ownKeys((p=l==null?void 0:l.cachedValue)==null?void 0:p.errorMessages);if(E.length){let L=E[E.length-1],y=(S=l==null?void 0:l.cachedValue)==null?void 0:S.errorMessages[L];if(y&&y.startsWith&&(y.startsWith("[SkipUnsafeError]")||y.startsWith("[NonWhitelistedSourceError]")))throw new Gt(y)}}return i?{state:Te(l.cachedValue.state),validity:l.cachedValue.validity,errorMessages:l.cachedValue.errorMessages}:Te(l.cachedValue.state)}}assignRefreshState(t){this.swGlobal.contracts.refreshState=async()=>{var e;return(e=t.contract.interactionState().get(this.swGlobal.contract.id,this.swGlobal._activeTx.sortKey))==null?void 0:e.state}}},ya=class extends an{constructor(t,e,r){super(t,e),this.wasmExports=r}async handle(t,e,r){try{let{interaction:i,interactionTx:a}=r;this.swGlobal._activeTx=a,this.swGlobal.caller=i.caller,this.swGlobal.gasLimit=t.evaluationOptions.gasLimit,this.swGlobal.gasUsed=0,this.assignReadContractState(t,a),this.assignViewContractState(t),this.assignWrite(t),await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let c=await this.doHandle(i);return r.interaction.interactionType==="view"?await this.swGlobal.kv.rollback():await this.swGlobal.kv.commit(),{type:"ok",result:c,state:this.doGetCurrentState(),gasUsed:this.swGlobal.gasUsed,event:null}}catch(i){await this.swGlobal.kv.rollback();let a={errorMessage:i.message,state:e.state,result:null};if(i instanceof Gt||i instanceof sn)return{...a,error:i.error,type:"error",event:null};if(i instanceof fe)throw i;return{...a,type:"exception",event:null}}finally{await this.swGlobal.kv.close()}}initState(t){switch(this.contractDefinition.srcWasmLang){case"rust":{if("initStateLegacy"in this.wasmExports){this.wasmExports.initStateLegacy(t);return}let e=this.wasmExports.initState(t);if(e)throw new Error(e);return}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async doHandleLegacy(t){let e=await this.wasmExports.handle(t.input);if(!e)return;if(Object.prototype.hasOwnProperty.call(e,"Ok"))return e.Ok;let r,i="";throw typeof e.Err=="string"||e.Err instanceof String?r=e.Err:"kind"in e.Err?(r=e.Err.kind,i="data"in e.Err?" "+e.Err.data:""):(r=Object.keys(e.Err)[0],i=" "+e.Err[r]),r=="RuntimeError"?new Error(`[RE:RE]${i}`):new Gt(`[CE:${r}${i}]`)}async doHandle(t){switch(this.contractDefinition.srcWasmLang){case"rust":{if("handle"in this.wasmExports)return await this.doHandleLegacy(t);let e=t.interactionType==="write"?await this.wasmExports.warpContractWrite(t.input):await this.wasmExports.warpContractView(t.input);if(!e)return;if(e.type==="ok")return e.result;throw this.logger.error("Error from rust",e),e.type==="error"?new Gt(e.error):new Error(e.errorMessage)}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async maybeCallStateConstructor(t,e){var r,i;if((i=(r=this.contractDefinition.manifest)==null?void 0:r.evaluationOptions)!=null&&i.useConstructor)throw Error("Constructor is not implemented for wasm");return t}doGetCurrentState(){switch(this.contractDefinition.srcWasmLang){case"rust":return this.wasmExports.currentState();default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}};at();function on(t,e){let r=t.trim().split(`
`),i=r[0],a=r[r.length-1];return(/\(\s*\(\)\s*=>\s*{/g.test(i)||/\s*\(\s*function\s*\(\)\s*{/g.test(i))&&/}\s*\)\s*\(\)\s*;/g.test(a)&&(r.shift(),r.pop(),t=r.join(`
`)),t=t.replace(/export\s+async\s+function\s+handle/gmu,"async function handle").replace(/export\s+function\s+handle/gmu,"function handle"),e?`
    ${t}
    module.exports = handle;`:`
    const window=void 0,document=void 0,Function=void 0,eval=void 0,globalThis=void 0;
    const [SmartWeave, BigNumber, logger${or()?", Buffer, atob, btoa":""}] = arguments;
    class ContractError extends Error { constructor(message) { super(message); this.name = 'ContractError' } };
    function ContractAssert(cond, message) { if (!cond) throw new ContractError(message) };
    ${t};
    return handle;
  `}function bs(t,e){try{let r=on(t,!1);return new Function(r)(),!0}catch(r){return e==null||e.error(r),!1}}var ma=Lt(te()),wr=Fr(),Gt=class extends Error{constructor(t,e){super(t.toString()),this.error=t,this.subtype=e,this.name="ContractError"}},sn=class extends Error{constructor(t){super(t.toString()),this.error=t,this.name="NonWhitelistedSourceError"}},ba=class{constructor(t){j(this,"logger",xt.INST.create("HandlerExecutorFactory"));this.arweave=t}async create(t,e,r,i){r.hasPlugin("contract-blacklist")&&await this.blacklistContracts(r,t),this.checkWhiteListContractSources(t,e);let a=null;e.useKVStorage&&(a=r.kvStorageFactory(t.txId));let c=new da(this.arweave,{id:t.txId,owner:t.owner},e,i,a);if(r.matchPlugins("^smartweave-extension-").forEach(l=>{r.loadPlugin(l).process(c.extensions)}),t.contractType=="wasm"){this.logger.info("Creating handler for wasm contract",t.txId);let l=It.measure(),n,p=null,S=va(t.srcBinary);switch(t.srcWasmLang){case"rust":{let E={exports:null,modifiedExports:{wasm_bindgen__convert__closures__invoke2_mut__:null,_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__:null}},L=await _a(S,t.srcBinary),y=WebAssembly.Module.exports(L).filter(C=>C.kind==="global"&&C.name.startsWith("__WARP_CONTRACTS_VERSION_")).map(C=>C.name).shift()||"__WARP_CONTRACTS_VERSION_LEGACY",k=WebAssembly.Module.imports(L).filter(C=>C.module==="__wbindgen_placeholder__").map(C=>C.name),{imports:b,exports:U}=wa(c,k,E,t.metadata.dtor,y);p=U,n=await WebAssembly.instantiate(L,b),E.exports=n.exports,Object.keys(n.exports).forEach(C=>{C.startsWith("wasm_bindgen__convert__closures__invoke2_mut__")&&(E.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__=n.exports[C]),C.startsWith("_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__")&&(E.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__=n.exports[C])});break}default:throw new Error(`Support for ${t.srcWasmLang} not implemented yet.`)}return this.logger.info(`WASM ${t.srcWasmLang} handler created in ${l.elapsed()}`),new ya(c,t,p||n.exports)}else{let l=on(t.src,r.hasPlugin("vm2"));if(l.includes("unsafeClient"))switch(e.unsafeClient){case"allow":{this.logger.warn(`Reading unsafe contract ${t.txId}, evaluation is non-deterministic!`);break}case"throw":throw new Error(`[SkipUnsafeError] Using unsafeClient is not allowed by default. Use EvaluationOptions.unsafeClient flag to evaluate ${t.txId}.`);case"skip":throw new Gt(`[SkipUnsafeError] Skipping evaluation of the unsafe contract ${t.txId}.`,"unsafeClientSkip");default:throw new Error(`Unknown unsafeClient setting ${e.unsafeClient}`)}if(!e.allowBigInt&&l.includes("BigInt"))throw new Error("Using BigInt is not allowed by default. Use EvaluationOptions.allowBigInt flag.");if(r.hasPlugin("vm2"))return r.loadPlugin("vm2").process({normalizedSource:l,swGlobal:c,logger:this.logger,contractDefinition:t});if(r.hasPlugin("ivm-handler-api"))return r.loadPlugin("ivm-handler-api").process({contractSource:t.src,evaluationOptions:e,arweave:this.arweave,swGlobal:c,contractDefinition:t});{let n=new Function(l),p=or()?n(c,wr,xt.INST.create(c.contract.id),ma.Buffer,atob,btoa):n(c,wr,xt.INST.create(c.contract.id));return new ka(c,t,p)}}}checkWhiteListContractSources(t,e){if(e&&e.whitelistSources.length>0&&!e.whitelistSources.includes(t.srcTxId))throw new sn(`[NonWhitelistedSourceError] Contract source not part of whitelisted sources list: ${t.srcTxId}.`)}async blacklistContracts(t,e){let r=t.loadPlugin("contract-blacklist"),i=!1;try{i=await r.process(e.txId)}catch(a){this.logger.error(a)}if(i==!0)throw new Gt(`[SkipUnsafeError] Skipping evaluation of the blacklisted contract ${e.txId}.`,"blacklistedSkip")}};function va(t){let e={status:200,statusText:"OK",headers:{"Content-Type":"application/wasm"}};return new Response(t,e)}async function _a(t,e){return WebAssembly.compileStreaming?await WebAssembly.compileStreaming(t):await WebAssembly.compile(e)}at();at();function Ea(t){let e="";for(let r of t)e+=("0"+r.toString(16)).slice(-2);return e}var Ta="".padEnd(13,"0"),Ve="".padEnd(13,"9"),ln="".padEnd(13,"0"),Sa="".padEnd(64,"0"),cn="".padEnd(64,"z"),Ge=`${"".padStart(12,"0")},${Ta},${Sa}`,vs=`${"".padStart(12,"9")},${Ve},${cn}`,ar=class{constructor(t){j(this,"logger",xt.INST.create("LexicographicalInteractionsSorter"));this.arweave=t}async sort(t){let e=[...t],r=e.map(i=>this.addSortKey(i));return await Promise.all(r),e.sort((i,a)=>i.node.sortKey.localeCompare(a.node.sortKey))}async createSortKey(t,e,r,i=!1){let a=this.arweave.utils.b64UrlToBuffer(t),c=this.arweave.utils.b64UrlToBuffer(e),l=this.arweave.utils.concatBuffers([a,c]),n=Ea(await this.arweave.crypto.hash(l));return`${`${r}`.padStart(12,"0")},${i?Ve:ln},${n}`}extractBlockHeight(t){return t?parseInt(t.split(",")[0]):null}async addSortKey(t){let{node:e}=t,r=t.node.sortKey;r?(t.node.sortKey=r,this.logger.debug("Using sortKey from sequencer",t.node.sortKey)):t.node.sortKey=await this.createSortKey(e.block.id,e.id,e.block.height)}generateLastSortKey(t){return`${`${t}`.padStart(12,"0")},${Ve},${cn}`}},Ne="__init",ce=(t,e)=>{let r=new Error(e);throw r.name=t,r},xa=(t=>(t.ContractError="ContractError",t.ConstructorError="ConstructorError",t.NetworkCommunicationError="NetworkCommunicationError",t.NonWhitelistedSourceError="NonWhitelistedSourceError",t))(xa||{}),ka=class extends an{constructor(t,e,r){super(t,e),this.contractFunction=r}async handle(t,e,r){let{interaction:i,interactionTx:a}=r;return this.setupSwGlobal(r),this.enableInternalWrites(t,a),this.assertNotConstructorCall(i),await this.runContractFunction(t,i,e.state)}initState(t){}async maybeCallStateConstructor(t,e){var r,i;if((i=(r=this.contractDefinition.manifest)==null?void 0:r.evaluationOptions)!=null&&i.useConstructor){let a={input:{function:Ne,args:t},caller:this.contractDefinition.owner,interactionType:"write"},c={owner:{address:e.caller,key:null},sortKey:Ge},l={interaction:a,interactionTx:c};this.setupSwGlobal(l);let n=this.configureSwGlobalForConstructor(),p=await this.runContractFunction(e,a,{});if(n(),p.type!=="ok")throw e.contract.isRoot()?new Error(`ConstructorError: ${p.errorMessage}`):new Gt(`ConstructorError [${e.contract.txId()}]: ${p.errorMessage}`,"constructor");return p.state}else return t}assertNotConstructorCall(t){var e,r;if((r=(e=this.contractDefinition.manifest)==null?void 0:e.evaluationOptions)!=null&&r.useConstructor&&t.input.function===Ne)throw new Error(`You have enabled {useConstructor: true} option, so you can't call function ${Ne}`)}configureSwGlobalForConstructor(){let t=a=>({get:(c,l)=>ce("ConstructorError",`SmartWeave.${a}.${String(l)} is not accessible in constructor context`)});this.swGlobal.contracts.readContractState=()=>ce("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.viewContractState=()=>ce("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.refreshState=()=>ce("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.write=()=>ce("ConstructorError","Internal writes feature is not available in constructor");let e=new rn(this.swGlobal);this.swGlobal.block=new Proxy(this.swGlobal.block,t("block"));let r=new nn(this.swGlobal);this.swGlobal.vrf=new Proxy(this.swGlobal.vrf,t("vrf"));let i=new en(this.swGlobal);return this.swGlobal.transaction=new Proxy(this.swGlobal.vrf,t("transaction")),()=>{this.swGlobal.block=e,this.swGlobal.vrf=r,this.swGlobal.transaction=i}}async runContractFunction(t,e,r){let i=Te(r),{timeoutId:a,timeoutPromise:c}=Aa(t.evaluationOptions.maxInteractionEvaluationTimeSeconds);try{await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let l=await Promise.race([c,this.contractFunction(i,e)]);if(l&&(l.state!==void 0||l.result!==void 0)){await this.swGlobal.kv.commit();let n=null;return l.event&&(n={contractTxId:this.swGlobal.contract.id,sortKey:this.swGlobal.transaction.sortKey,transactionId:this.swGlobal.transaction.id,caller:e.caller,input:e.input,blockTimestamp:this.swGlobal.block.timestamp,blockHeight:this.swGlobal.block.height,data:l.event}),{type:"ok",result:l.result,state:l.state||i,event:n}}throw new Error(`Unexpected result from contract: ${JSON.stringify(l)}`)}catch(l){switch(await this.swGlobal.kv.rollback(),l.name){case"ContractError":return{type:"error",errorMessage:l.message,state:r,result:null,event:null};case"ConstructorError":throw t.contract.isRoot()?Error(`ConstructorError: ${l.message}`):new Gt(`ConstructorError [${t.contract.txId()}]: ${l.message}`,"constructor");case"NetworkCommunicationError":throw l;case"NonWhitelistedSourceError":return{type:"error",errorMessage:l.message,state:r,result:null,event:null};default:return{type:"exception",errorMessage:`${l&&l.stack||l&&l.message||l}`,state:r,result:null,event:null}}}finally{a&&clearTimeout(a),await this.swGlobal.kv.close()}}setupSwGlobal({interaction:t,interactionTx:e}){this.swGlobal._activeTx=e,this.swGlobal.caller=t.caller}enableInternalWrites(t,e){this.assignReadContractState(t,e),this.assignViewContractState(t),this.assignWrite(t),this.assignRefreshState(t)}},un=t=>new Promise(e=>setTimeout(e,t)),Re=t=>{let e=Number.parseInt(t);if(Number.isNaN(e)&&!Number.isSafeInteger(e))throw Error(`Failed to cast ${t} to integer`);return e},Te=t=>ga(t),_s=(t,e)=>e instanceof Map?{dataType:"Map",value:Array.from(e.entries())}:e,Es=(t,e)=>typeof e=="object"&&e!==null&&e.dataType==="Map"?new Map(e.value):e,Ts=(t,e)=>t-e,Ss=(t,e)=>+t-+e,xs=(t,e)=>e-t,ks=(t,e)=>+e-+t;function Aa(t){let e=null,r=new Promise((i,a)=>{e=setTimeout(()=>{clearTimeout(e),a("timeout")},t*1e3)});return{timeoutId:e,timeoutPromise:r}}function we(t){return t.endsWith("/")?t.slice(0,-1):t}function zt(t){return`[d:${t}]`.padEnd(t*2,"-").concat("> ")}function As(t){let e=[];return Uint8Array.from(t).forEach(function(r){let i=r.toString(16);i.length%2&&(i="0"+i),e.push(i)}),BigInt("0x"+e.join(""))}var or=new Function("try {return this===window;}catch(e){ return false;}"),fe=class extends Error{constructor(t){super(t.toString()),this.error=t,this.name="NetworkCommunicationError"}};async function Zt(t){let e;try{e=await t}catch(r){throw new fe(`Error during network communication: ${JSON.stringify(r)}`)}if(!(e!=null&&e.ok)){let r=await e.text();throw new fe(`Wrong response code: ${e.status}. ${r}`)}try{return await e.json()}catch(r){throw new fe(`Error while parsing json response: ${JSON.stringify(r)}`)}}async function Ca(t,e){return Zt(fetch(t,e))}var Ia=(t=>(t.ARWEAVE="arweave",t.WARP_SEQUENCER="redstone-sequencer",t.BOTH="both",t))(Ia||{}),Oa=class{constructor(t=null,e="both"){j(this,"_warp");j(this,"logger",xt.INST.create("WarpGatewayInteractionsLoader"));this.confirmationStatus=t,this.source=e,Object.assign(this,t),this.source=e}async load(t,e,r,i){this.logger.debug("Loading interactions: for ",{contractId:t,fromSortKey:e,toSortKey:r});let a=[],c=0,l=0,n=0,p=i?i.sourceType:this.source,S=It.measure(),E=we(this._warp.gwUrl());do{let L=It.measure(),y=`${E}/gateway/v2/interactions-sort-key`,k=await Zt(fetch(`${y}?${new URLSearchParams({contractId:t,...this._warp.whoAmI?{client:this._warp.whoAmI}:"",...e?{from:e}:"",...r?{to:r}:"",page:(++c).toString(),fromSdk:"true",...this.confirmationStatus&&this.confirmationStatus.confirmed?{confirmationStatus:"confirmed"}:"",...this.confirmationStatus&&this.confirmationStatus.notCorrupted?{confirmationStatus:"not_corrupted"}:"",...p=="both"?"":{source:p}})}`));this.logger.debug(`Loading interactions: page ${c} loaded in ${L.elapsed()}`),a.push(...k.interactions),l=k.paging.limit,n=k.paging.items,this.logger.debug(`Loaded interactions length: ${a.length}, from: ${e}, to: ${r}`)}while(n==l);return this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:a.length,time:S.elapsed()}),a}type(){return"warp"}clearCache(){}set warp(t){this._warp=t}},Rt=class{constructor(t,e,r){this.state=t,this.validity=e,this.errorMessages=r}},La=class{constructor(){j(this,"ignoreExceptions",!0);j(this,"waitForConfirmation",!1);j(this,"updateCacheForEachInteraction",!1);j(this,"internalWrites",!1);j(this,"maxCallDepth",7);j(this,"maxInteractionEvaluationTimeSeconds",60);j(this,"stackTrace",{saveState:!1});j(this,"sequencerUrl","https://d1o5nlqr4okus2.cloudfront.net/");j(this,"gasLimit",Number.MAX_SAFE_INTEGER);j(this,"sourceType","both");j(this,"unsafeClient","throw");j(this,"allowBigInt",!1);j(this,"walletBalanceUrl","http://nyc-1.dev.arweave.net:1984/");j(this,"mineArLocalBlocks",!0);j(this,"throwOnInternalWriteError",!0);j(this,"cacheEveryNInteractions",-1);j(this,"useKVStorage",!1);j(this,"remoteStateSyncEnabled",!1);j(this,"remoteStateSyncSource","https://dre-1.warp.cc/contract");j(this,"useConstructor",!1);j(this,"whitelistSources",[])}},Ba=class extends Event{constructor(e,r){super(e,r);j(this,"detail");this.detail=r.detail}},Cs=class{constructor(t,e,r,i,a,c,l,n){this.contractTxId=t,this.sortKey=e,this.transactionId=r,this.caller=i,this.input=a,this.blockTimestamp=c,this.blockHeight=l,this.data=n}};at();at();var hn=["application/javascript","application/wasm"],Is=class{constructor(){j(this,"dtor")}},Na=class{constructor(t){j(this,"src");j(this,"srcBinary");j(this,"srcWasmLang");this.src=t.src,this.srcBinary=t.srcBinary,this.srcWasmLang=t.srcWasmLang}},Ra=class{constructor(t){j(this,"txId");j(this,"srcTxId");j(this,"initState");j(this,"minFee");j(this,"owner");j(this,"contractType");j(this,"metadata");j(this,"manifest");j(this,"contractTx");j(this,"srcTx");j(this,"testnet");this.txId=t.txId,this.srcTxId=t.srcTxId,this.initState=t.initState,this.manifest=t.manifest,this.minFee=t.minFee,this.owner=t.owner,this.contractType=t.contractType,this.metadata=t.metadata,this.contractTx=t.contractTx,this.srcTx=t.srcTx,this.testnet=t.testnet}};at();var At={APP_NAME:"App-Name",APP_VERSION:"App-Version",CONTRACT_TX_ID:"Contract",INPUT:"Input",CONTENT_TYPE:"Content-Type",CONTRACT_SRC_TX_ID:"Contract-Src",SDK:"SDK",MIN_FEE:"Min-Fee"},_t={SEQUENCER:"Sequencer",SEQUENCER_OWNER:"Sequencer-Owner",SEQUENCER_MILLIS:"Sequencer-Mills",SEQUENCER_SORT_KEY:"Sequencer-Sort-Key",SEQUENCER_PREV_SORT_KEY:"Sequencer-Prev-Sort-Key",SEQUENCER_LAST_SORT_KEY:"Sequencer-Last-Sort-Key",SEQUENCER_TX_ID:"Sequencer-Tx-Id",SEQUENCER_BLOCK_HEIGHT:"Sequencer-Block-Height",SEQUENCER_BLOCK_ID:"Sequencer-Block-Id",SEQUENCER_BLOCK_TIMESTAMP:"Sequencer-Block-Timestamp",INIT_STATE:"Init-State",INIT_STATE_TX:"Init-State-TX",INTERACT_WRITE:"Interact-Write",WASM_LANG:"Wasm-Lang",WASM_LANG_VERSION:"Wasm-Lang-Version",WASM_META:"Wasm-Meta",REQUEST_VRF:"Request-Vrf",SIGNATURE_TYPE:"Signature-Type",UPLOADER_TX_ID:"Uploader-Tx-Id",WARP_TESTNET:"Warp-Testnet",MANIFEST:"Contract-Manifest",NONCE:"Nonce"};at();var Ua=Lt(er()),yr=Lt(te());at();var Kt=Lt(Ft()),fn=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);return this[t]instanceof Uint8Array?e&&e.decode&&e.string?Kt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Kt.bufferTob64Url(this[t]):e&&e.decode==!0?e&&e.string?Kt.b64UrlToString(this[t]):Kt.b64UrlToBuffer(this[t]):this[t]}},gn=class extends fn{constructor(e={}){super();j(this,"format",2);j(this,"id","");j(this,"last_tx","");j(this,"owner","");j(this,"tags",[]);j(this,"target","");j(this,"quantity","0");j(this,"data_size","0");j(this,"data",new Uint8Array);j(this,"data_root","");j(this,"reward","0");j(this,"signature","");j(this,"chunks");Object.assign(this,e),typeof this.data=="string"&&(this.data=Kt.b64UrlToBuffer(this.data)),e.tags&&(this.tags=e.tags.map(r=>new $t(r.name,r.value)))}addTag(e,r){this.tags.push(new $t(Kt.stringToB64Url(e),Kt.stringToB64Url(r)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Kt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(e){this.owner=e}setSignature({id:e,owner:r,reward:i,tags:a,signature:c}){this.id=e,this.owner=r,i&&(this.reward=i),a&&(this.tags=a),this.signature=c}async prepareChunks(e){throw new Error("Should not be called, use arweave-js version.")}getChunk(e,r){if(!this.chunks)throw new Error("Chunks have not been prepared");let i=this.chunks.proofs[e],a=this.chunks.chunks[e];return{data_root:this.data_root,data_size:this.data_size,data_path:Kt.bufferTob64Url(i.proof),offset:i.offset.toString(),chunk:Kt.bufferTob64Url(r.slice(a.minByteRange,a.maxByteRange))}}async getSignatureData(){throw new Error("Should not be called, use arweave-js version.")}},$t=class extends fn{constructor(e,r,i=!1){super();j(this,"name");j(this,"value");this.name=e,this.value=r}},le=class{constructor(t){j(this,"logger",xt.INST.create("ArweaveWrapper"));j(this,"baseUrl");this.warp=t;let{arweave:e}=t;this.baseUrl=`${e.api.config.protocol}://${e.api.config.host}:${e.api.config.port}`,this.logger.debug("baseurl",this.baseUrl)}async warpGwInfo(){return await this.doFetchInfo(`${we(this.warp.gwUrl())}/gateway/arweave/info`)}async warpGwBlock(){return this.logger.debug("Calling warp gw block info"),await this.doFetchInfo(`${we(this.warp.gwUrl())}/gateway/arweave/block`)}async info(){return await this.doFetchInfo(`${this.baseUrl}/info`)}async gql(t,e){try{let r=JSON.stringify({query:t,variables:e});return{data:await Zt(fetch(`${this.baseUrl}/graphql`,{method:"POST",body:r,headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}})),status:200}}catch(r){throw this.logger.error("Error while loading gql",r),r}}async tx(t){let e=await fetch(`${this.baseUrl}/tx/${t}`).then(r=>r.ok?r.json():Promise.reject(r)).catch(r=>{var i,a;throw(i=r.body)!=null&&i.message&&this.logger.error(r.body.message),new fe(`Unable to retrieve tx ${t}. ${r.status}. ${(a=r.body)==null?void 0:a.message}`)});return new gn({...e})}async txData(t){let e=await fetch(`${this.baseUrl}/${t}`);if(e.ok){let r=await e.arrayBuffer();return yr.Buffer.from(r)}else{this.logger.warn(`Unable to load data from arweave.net/${t} endpoint, falling back to arweave.js`);let r=await this.warp.arweave.transactions.getData(t,{decode:!0});return yr.Buffer.from(r)}}async txDataString(t){let e=await this.txData(t);return Ua.default.utils.bufferToString(e)}async doFetchInfo(t){return await Zt(fetch(t))}};at();var ee=class{constructor(){j(this,"logger",xt.INST.create("TagsParser"))}getInputTag(t,e){if(ee.hasMultipleInteractions(t)){this.logger.debug("Interaction transaction is using multiple input tx tag format.");let r=t.tags.findIndex(a=>a.name===At.CONTRACT_TX_ID&&a.value===e);if(t.tags.length-1===r){this.logger.warn("Wrong tags format: 'Contract' is the last tag");return}let i=t.tags[r+1];if(i.name!==At.INPUT){this.logger.warn(`No 'Input' tag found after 'Contract' tag. Instead ${i.name} was found`);return}return i}else return t.tags.find(r=>r.name===At.INPUT)}isInteractWrite(t,e){return t.tags.some(r=>r.name===_t.INTERACT_WRITE&&r.value===e)}getInteractWritesContracts(t){return t.tags.filter(e=>e.name===_t.INTERACT_WRITE).map(e=>e.value)}getContractTag(t){var e;return(e=t.tags.find(r=>r.name===At.CONTRACT_TX_ID))==null?void 0:e.value}getContractsWithInputs(t){let e=new Map;return t.tags.filter(r=>r.name===At.CONTRACT_TX_ID).forEach(r=>{e.set(r.value,this.getInputTag(t,r.value))}),e}isEvmSigned(t){return t.tags.some(e=>e.name===_t.SIGNATURE_TYPE&&e.value==="ethereum")}static hasMultipleInteractions(t){return t.tags.filter(e=>e.name===At.CONTRACT_TX_ID).length>1}decodeTags(t){let e=t.get("tags"),r=[];for(let i of e)try{let a=i.get("name",{decode:!0,string:!0}),c=i.get("value",{decode:!0,string:!0});r.push({name:a,value:c})}catch{}return r}getTag(t,e){let r=t.get("tags");for(let i of r)try{if(i.get("name",{decode:!0,string:!0})===e)return i.get("value",{decode:!0,string:!0})}catch{}return!1}hasVrfTag(t){return t.tags.some(e=>e.name==_t.REQUEST_VRF&&e.value==="true")}};at();at();function dn(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,r)=>{let i=new FileReader;i.addEventListener("loadend",()=>{e(i.result)}),i.addEventListener("error",r),i.readAsArrayBuffer(t)})}async function $a(t){let e=await dn(t);return new Uint8Array(e)}function pn(t){return typeof Blob<"u"&&t instanceof Blob}function ye(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}var Pa=typeof Jt.default<"u"&&Jt.default.versions&&typeof Jt.default.versions.node<"u"&&typeof Jt.default.versions.electron>"u";function Ma(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}var mr=class{constructor(t){this.typedArray=t instanceof ArrayBuffer||ye(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,e){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,e)}},br=class{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,e){let r=this.blob.slice(t,t+e),i=await dn(r);return new Uint8Array(i)}async sliceAsBlob(t,e,r=""){return this.blob.slice(t,t+e,r)}};function ja(t,e){var r=Uint8Array;if(t[0]==3&&t[1]==0)return e||new r(0);var i=Ka,a=wn,c=Da,l=yn,n=e==null;n&&(e=new r(t.length>>>2<<3));for(var p=0,S=0,E=0,L=0,y=0,k=0,b=0,U=0,C=0,K,z;p==0;){if(p=i(t,C,1),S=i(t,C+1,2),C+=3,S==0){C&7&&(C+=8-(C&7));var x=(C>>>3)+4,v=t[x-4]|t[x-3]<<8;n&&(e=Ue(e,U+v)),e.set(new r(t.buffer,t.byteOffset+x,v),U),C=x+v<<3,U+=v;continue}if(n&&(e=Ue(e,U+(1<<17))),S==1&&(K=yt.flmap,z=yt.fdmap,k=511,b=31),S==2){E=a(t,C,5)+257,L=a(t,C+5,5)+1,y=a(t,C+10,4)+4,C+=14;for(var w=0;w<38;w+=2)yt.itree[w]=0,yt.itree[w+1]=0;for(var u=1,w=0;w<y;w++){var T=a(t,C+w*3,3);yt.itree[(yt.ordr[w]<<1)+1]=T,T>u&&(u=T)}C+=3*y,ge(yt.itree,u),de(yt.itree,u,yt.imap),K=yt.lmap,z=yt.dmap,C=c(yt.imap,(1<<u)-1,E+L,t,C,yt.ttree);var I=vr(yt.ttree,0,E,yt.ltree);k=(1<<I)-1;var P=vr(yt.ttree,E,L,yt.dtree);b=(1<<P)-1,ge(yt.ltree,I),de(yt.ltree,I,K),ge(yt.dtree,P),de(yt.dtree,P,z)}for(;;){var q=K[l(t,C)&k];C+=q&15;var G=q>>>4;if(!(G>>>8))e[U++]=G;else{if(G==256)break;var et=U+G-254;if(G>264){var J=yt.ldef[G-257];et=U+(J>>>3)+a(t,C,J&7),C+=J&7}var tt=z[l(t,C)&b];C+=tt&15;var st=tt>>>4,nt=yt.ddef[st],B=(nt>>>4)+i(t,C,nt&15);for(C+=nt&15,n&&(e=Ue(e,U+(1<<17)));U<et;)e[U]=e[U++-B],e[U]=e[U++-B],e[U]=e[U++-B],e[U]=e[U++-B];U=et}}}return e.length==U?e:e.slice(0,U)}function Ue(t,e){var r=t.length;if(e<=r)return t;var i=new Uint8Array(Math.max(r<<1,e));return i.set(t,0),i}function Da(t,e,r,i,a,c){for(var l=wn,n=yn,p=0;p<r;){var S=t[n(i,a)&e];a+=S&15;var E=S>>>4;if(E<=15)c[p]=E,p++;else{var L=0,y=0;E==16?(y=3+l(i,a,2),a+=2,L=c[p-1]):E==17?(y=3+l(i,a,3),a+=3):E==18&&(y=11+l(i,a,7),a+=7);for(var k=p+y;p<k;)c[p]=L,p++}}return a}function vr(t,e,r,i){for(var a=0,c=0,l=i.length>>>1;c<r;){var n=t[c+e];i[c<<1]=0,i[(c<<1)+1]=n,n>a&&(a=n),c++}for(;c<l;)i[c<<1]=0,i[(c<<1)+1]=0,c++;return a}function ge(t,e){for(var r=t.length,i,a,c,p,l,n=yt.bl_count,p=0;p<=e;p++)n[p]=0;for(p=1;p<r;p+=2)n[t[p]]++;var S=yt.next_code;for(i=0,n[0]=0,a=1;a<=e;a++)i=i+n[a-1]<<1,S[a]=i;for(c=0;c<r;c+=2)l=t[c+1],l!=0&&(t[c]=S[l],S[l]++)}function de(t,e,r){for(var i=t.length,a=yt.rev15,c=0;c<i;c+=2)if(t[c+1]!=0)for(var l=c>>1,n=t[c+1],p=l<<4|n,S=e-n,E=t[c]<<S,L=E+(1<<S);E!=L;){var y=a[E]>>>15-e;r[y]=p,E++}}function _r(t,e){for(var r=yt.rev15,i=15-e,a=0;a<t.length;a+=2){var c=t[a]<<e-t[a+1];t[a]=r[c]>>>i}}function wn(t,e,r){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<r)-1}function Ka(t,e,r){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<r)-1}function yn(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}var yt=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(65536),prev:new t(32768)}}();(function(){for(var t=32768,e=0;e<t;e++){var r=e;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,yt.rev15[e]=(r>>>16|r<<16)>>>17}function i(a,c,l){for(;c--!=0;)a.push(0,l)}for(var e=0;e<32;e++)yt.ldef[e]=yt.of0[e]<<3|yt.exb[e],yt.ddef[e]=yt.df0[e]<<4|yt.dxb[e];i(yt.fltree,144,8),i(yt.fltree,112,9),i(yt.fltree,24,7),i(yt.fltree,8,8),ge(yt.fltree,9),de(yt.fltree,9,yt.flmap),_r(yt.fltree,9),i(yt.fdtree,32,5),ge(yt.fdtree,5),de(yt.fdtree,5,yt.fdmap),_r(yt.fdtree,5),i(yt.itree,19,0),i(yt.ltree,286,0),i(yt.dtree,30,0),i(yt.ttree,320,0)})();var Er={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var r=e,i=0;i<8;i++)r&1?r=3988292384^r>>>1:r=r>>>1;t[e]=r}return t}(),update:function(t,e,r,i){for(var a=0;a<i;a++)t=Er.table[(t^e[r+a])&255]^t>>>8;return t},crc:function(t,e,r){return Er.update(4294967295,t,e,r)^4294967295}};function Wa(t,e){return ja(t,e)}var Tr={numWorkers:1,workerURL:"",useWorkers:!1},Fa=0,ve=[];function $e(t){return new Promise((e,r)=>{let i=new Worker(t);i.onmessage=a=>{a.data==="start"?(i.onerror=void 0,i.onmessage=void 0,e(i)):r(new Error(`unexpected message: ${a.data}`))},i.onerror=r})}function Va(t,e){return t.require?t.require(e):{}}(function(){if(Pa){let{Worker:t}=Va(module,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,r){e.on("message",i=>{r({target:e,data:i})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await $e(t)}catch{console.warn("could not load worker:",t)}let e;try{let r=await fetch(t,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${t}`);e=await r.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));let i=await $e(t);return Tr.workerURL=t,i}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;let r=await $e(t);return Tr.workerURL=t,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function Ga(t,e,r,i){let a=new Uint8Array(e);Wa(t,a),i(r?new Blob([a],{type:r}):a.buffer)}async function qa(){if(ve.length!==0)for(;ve.length;){let{src:t,uncompressedSize:e,type:r,resolve:i}=ve.shift(),a=t;pn(t)&&(a=await $a(t)),Ga(a,e,r,i)}}function mn(t,e,r){return new Promise((i,a)=>{ve.push({src:t,uncompressedSize:e,type:r,resolve:i,reject:a,id:Fa++}),qa()})}function Ha(t,e){let r=t&31,i=(t>>5&15)-1,a=(t>>9&127)+1980,c=0,l=(e&31)*2,n=e>>5&63,p=e>>11&31;return new Date(a,i,r,p,n,l,c)}var za=class{constructor(t,e){this._reader=t,this._rawEntry=e,this.name=e.name,this.nameBytes=e.nameBytes,this.size=e.uncompressedSize,this.compressedSize=e.compressedSize,this.comment=e.comment,this.commentBytes=e.commentBytes,this.compressionMethod=e.compressionMethod,this.lastModDate=Ha(e.lastModFileDate,e.lastModFileTime),this.isDirectory=e.uncompressedSize===0&&e.name.endsWith("/"),this.encrypted=!!(e.generalPurposeBitFlag&1),this.externalFileAttributes=e.externalFileAttributes,this.versionMadeBy=e.versionMadeBy}async blob(t="application/octet-stream"){return await ao(this._reader,this._rawEntry,t)}async arrayBuffer(){return await io(this._reader,this._rawEntry)}async text(){let t=await this.arrayBuffer();return pe(new Uint8Array(t))}async json(){let t=await this.text();return JSON.parse(t)}},Pe=22,Ja=65535,Qa=101010256,Ya=101075792;async function se(t,e,r){return await t.read(e,r)}async function qe(t,e,r,i){return t.sliceAsBlob?await t.sliceAsBlob(e,r,i):await t.read(e,r)}var Xa={unsigned(){return 0}};function Ot(t,e){return t[e]+t[e+1]*256}function Bt(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function Qt(t,e){return Bt(t,e)+Bt(t,e+4)*4294967296}var Za=new TextDecoder;function pe(t,e){return ye(t.buffer)&&(t=new Uint8Array(t)),Za.decode(t)}async function to(t,e){let r=Math.min(Pe+Ja,e),i=e-r,a=await se(t,i,r);for(let c=r-Pe;c>=0;--c){if(Bt(a,c)!==Qa)continue;let l=new Uint8Array(a.buffer,a.byteOffset+c,a.byteLength-c),n=Ot(l,4);if(n!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${n}`);let p=Ot(l,10),S=Bt(l,12),E=Bt(l,16),L=Ot(l,20),y=l.length-Pe;if(L!==y)throw new Error(`invalid comment length. expected: ${y}, actual: ${L}`);let k=new Uint8Array(l.buffer,l.byteOffset+22,L),b=pe(k);return p===65535||E===4294967295?await ro(t,i+c,b,k):await bn(t,E,S,p,b,k)}throw new Error("could not find end of central directory. maybe not zip file")}var eo=117853008;async function ro(t,e,r,i){let a=e-20,c=await se(t,a,20);if(Bt(c,0)!==eo)throw new Error("invalid zip64 end of central directory locator signature");let l=Qt(c,8),n=await se(t,l,56);if(Bt(n,0)!==Ya)throw new Error("invalid zip64 end of central directory record signature");let p=Qt(n,32),S=Qt(n,40),E=Qt(n,48);return bn(t,E,S,p,r,i)}var no=33639248;async function bn(t,e,r,i,a,c){let l=0,n=await se(t,e,r),p=[];for(let S=0;S<i;++S){let E=n.subarray(l,l+46),L=Bt(E,0);if(L!==no)throw new Error(`invalid central directory file header signature: 0x${L.toString(16)}`);let y={versionMadeBy:Ot(E,4),versionNeededToExtract:Ot(E,6),generalPurposeBitFlag:Ot(E,8),compressionMethod:Ot(E,10),lastModFileTime:Ot(E,12),lastModFileDate:Ot(E,14),crc32:Bt(E,16),compressedSize:Bt(E,20),uncompressedSize:Bt(E,24),fileNameLength:Ot(E,28),extraFieldLength:Ot(E,30),fileCommentLength:Ot(E,32),internalFileAttributes:Ot(E,36),externalFileAttributes:Bt(E,38),relativeOffsetOfLocalHeader:Bt(E,42)};if(y.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");l+=46;let k=n.subarray(l,l+y.fileNameLength+y.extraFieldLength+y.fileCommentLength);y.nameBytes=k.slice(0,y.fileNameLength),y.name=pe(y.nameBytes);let b=y.fileNameLength+y.extraFieldLength,U=k.slice(y.fileNameLength,b);y.extraFields=[];let C=0;for(;C<U.length-3;){let z=Ot(U,C+0),x=Ot(U,C+2),v=C+4,w=v+x;if(w>U.length)throw new Error("extra field length exceeds extra field buffer size");y.extraFields.push({id:z,data:U.slice(v,w)}),C=w}if(y.commentBytes=k.slice(b,b+y.fileCommentLength),y.comment=pe(y.commentBytes),l+=k.length,y.uncompressedSize===4294967295||y.compressedSize===4294967295||y.relativeOffsetOfLocalHeader===4294967295){let z=y.extraFields.find(w=>w.id===1);if(!z)throw new Error("expected zip64 extended information extra field");let x=z.data,v=0;if(y.uncompressedSize===4294967295){if(v+8>x.length)throw new Error("zip64 extended information extra field does not include uncompressed size");y.uncompressedSize=Qt(x,v),v+=8}if(y.compressedSize===4294967295){if(v+8>x.length)throw new Error("zip64 extended information extra field does not include compressed size");y.compressedSize=Qt(x,v),v+=8}if(y.relativeOffsetOfLocalHeader===4294967295){if(v+8>x.length)throw new Error("zip64 extended information extra field does not include relative header offset");y.relativeOffsetOfLocalHeader=Qt(x,v),v+=8}}let K=y.extraFields.find(z=>z.id===28789&&z.data.length>=6&&z.data[0]===1&&Bt(z.data,1),Xa.unsigned(y.nameBytes));if(K&&(y.fileName=pe(K.data.slice(5))),y.compressionMethod===0){let z=y.uncompressedSize;if(y.generalPurposeBitFlag&1&&(z+=12),y.compressedSize!==z)throw new Error(`compressed size mismatch for stored file: ${y.compressedSize} != ${z}`)}p.push(y)}return{zip:{comment:a,commentBytes:c},entries:p.map(S=>new za(t,S))}}async function vn(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");let r=await se(t,e.relativeOffsetOfLocalHeader,30),i=await t.getLength(),a=Bt(r,0);if(a!==67324752)throw new Error(`invalid local file header signature: 0x${a.toString(16)}`);let c=Ot(r,26),l=Ot(r,28),n=e.relativeOffsetOfLocalHeader+r.length+c+l,p;if(e.compressionMethod===0)p=!1;else if(e.compressionMethod===8)p=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);let S=n,E=S+e.compressedSize;if(e.compressedSize!==0&&E>i)throw new Error(`file data overflows file bounds: ${S} +  ${e.compressedSize}  > ${i}`);return{decompress:p,fileDataStart:S}}async function io(t,e){let{decompress:r,fileDataStart:i}=await vn(t,e);if(!r){let c=await se(t,i,e.compressedSize);return Ma(c)?c.buffer:c.slice().buffer}let a=await qe(t,i,e.compressedSize);return await mn(a,e.uncompressedSize)}async function ao(t,e,r){let{decompress:i,fileDataStart:a}=await vn(t,e);if(!i){let l=await qe(t,a,e.compressedSize,r);return pn(l)?l:new Blob([ye(l.buffer)?new Uint8Array(l):l],{type:r})}let c=await qe(t,a,e.compressedSize);return await mn(c,e.uncompressedSize,r)}async function oo(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new br(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new mr(t);else if(ye(t)||ye(t.buffer))e=new mr(t);else if(typeof t=="string"){let i=await fetch(t);if(!i.ok)throw new Error(`failed http request ${t}, status: ${i.status}: ${i.statusText}`);let a=await i.blob();e=new br(a)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");let r=await e.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await to(e,r)}async function so(t){let{zip:e,entries:r}=await oo(t);return{zip:e,entries:Object.fromEntries(r.map(i=>[i.name,i]))}}var lo=Lt(te()),sr=class{constructor(t){j(this,"logger",xt.INST.create("WasmSrc"));j(this,"splitted");this.src=t,this.splitted=this.splitBuffer(t),this.logger.debug(`Buffer splitted into ${this.splitted.length} parts`)}wasmBinary(){return this.splitted[0]}async sourceCode(){let{entries:t}=await so(this.splitted[1]),e=new Map;for(let[r,i]of Object.entries(t)){if(i.isDirectory)continue;let a=await i.text();e.set(r,a)}return e}additionalCode(){return this.splitted.length==2?null:this.splitted[2].toString()}splitBuffer(t){let e="",r=parseInt(t.toString("utf8",0,1));this.logger.debug(`Number of elements: ${r}`);let i=t.length,a=0,c=0;for(let p=2;p<i;p++){let S=t.toString("utf8",p,p+1);if(S=="|"&&a++,a==r){c=p+1;break}e+=S}this.logger.debug("Parsed:",{header:e,dataStart:c});let l=e.split("|").map(p=>parseInt(p));this.logger.debug("Lengths",l);let n=[];for(let p of l){let S=lo.Buffer.alloc(p),E=c+p;t.copy(S,0,c,E),c=E,n.push(S)}return n}},_n=class{constructor(t,e){j(this,"logger",xt.INST.create("ContractDefinitionLoader"));j(this,"arweaveWrapper");j(this,"tagsParser");this.arweave=t,this.env=e,this.tagsParser=new ee}async load(t,e){let r=It.measure(),i=await this.doLoad(t,e);return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),i}async doLoad(t,e){let r=It.measure(),i=await this.arweaveWrapper.tx(t),a=await this.arweave.wallets.ownerToAddress(i.owner);this.logger.debug("Contract tx and owner",r.elapsed()),r.reset();let c=e||this.tagsParser.getTag(i,At.CONTRACT_SRC_TX_ID),l=this.tagsParser.getTag(i,_t.WARP_TESTNET)||null;if(l&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!l&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let n=this.tagsParser.getTag(i,At.MIN_FEE),p=null,S=this.tagsParser.getTag(i,_t.MANIFEST);S&&(p=JSON.parse(S)),this.logger.debug("Tags decoding",r.elapsed()),r.reset();let E=await this.evalInitialState(i);this.logger.debug("init state",E);let L=JSON.parse(E);this.logger.debug("Parsing src and init state",r.elapsed());let{src:y,srcBinary:k,srcWasmLang:b,contractType:U,metadata:C,srcTx:K}=await this.loadContractSource(c);return{txId:t,srcTxId:c,src:y,srcBinary:k,srcWasmLang:b,initState:L,minFee:n,owner:a,contractType:U,metadata:C,manifest:p,contractTx:i.toJSON(),srcTx:K,testnet:l}}async loadContractSource(t){let e=It.measure(),r=await this.arweaveWrapper.tx(t),i=this.tagsParser.getTag(r,At.CONTENT_TYPE);if(!hn.includes(i))throw new Error(`Contract source content type ${i} not supported`);let a=i=="application/javascript"?"js":"wasm",c=a=="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),l,n,p;if(a=="wasm"){if(n=new sr(c),l=this.tagsParser.getTag(r,_t.WASM_LANG),!l)throw new Error(`Wasm lang not set for wasm contract src ${t}`);p=JSON.parse(this.tagsParser.getTag(r,_t.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:a=="js"?c:null,srcBinary:a=="wasm"?n.wasmBinary():null,srcWasmLang:l,contractType:a,metadata:p,srcTx:r.toJSON()}}async evalInitialState(t){if(this.tagsParser.getTag(t,_t.INIT_STATE))return this.tagsParser.getTag(t,_t.INIT_STATE);if(this.tagsParser.getTag(t,_t.INIT_STATE_TX)){let e=this.tagsParser.getTag(t,_t.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}type(){return"arweave"}setCache(t){throw new Error("No cache implemented for this loader")}setSrcCache(t){throw new Error("No cache implemented for this loader")}getCache(){throw new Error("No cache implemented for this loader")}getSrcCache(){throw new Error("No cache implemented for this loader")}set warp(t){this.arweaveWrapper=new le(t)}};at();var Me=Lt(te()),co=class{constructor(t,e,r,i){j(this,"rLogger",xt.INST.create("WarpGatewayContractDefinitionLoader"));j(this,"contractDefinitionLoader");j(this,"arweaveWrapper");j(this,"tagsParser");j(this,"_warp");this.definitionCache=e,this.srcCache=r,this.env=i,this.contractDefinitionLoader=new _n(t,i),this.tagsParser=new ee}async load(t,e){let r=await this.getFromCache(t,e);if(r)return this.rLogger.debug("WarpGatewayContractDefinitionLoader: Hit from cache!"),r.contractType=="wasm"&&r.srcBinary.data&&(r.srcBinary=Me.Buffer.from(r.srcBinary.data)),this.verifyEnv(r),r;let i=It.measure(),a=await this.doLoad(t,e);return this.rLogger.info(`Contract definition loaded in: ${i.elapsed()}`),this.verifyEnv(a),await this.putToCache(t,a,e),a}async doLoad(t,e){try{let r=we(this._warp.gwUrl()),i=await Zt(fetch(`${r}/gateway/contract?txId=${t}${e?`&srcTxId=${e}`:""}`));if(i.srcBinary!=null&&!(i.srcBinary instanceof Me.Buffer)&&(i.srcBinary=Me.Buffer.from(i.srcBinary.data)),i.srcBinary){let a=new sr(i.srcBinary);i.srcBinary=a.wasmBinary();let c;i.srcTx?c=new gn({...i.srcTx}):c=await this.arweaveWrapper.tx(i.srcTxId);let l=JSON.parse(this.tagsParser.getTag(c,_t.WASM_META));i.metadata=l}return i.contractType=i.src?"js":"wasm",i}catch(r){return this.rLogger.warn("Falling back to default contracts loader",r),await this.contractDefinitionLoader.doLoad(t,e)}}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return"warp"}setCache(t){this.definitionCache=t}setSrcCache(t){this.srcCache=t}getCache(){return this.definitionCache}getSrcCache(){return this.srcCache}verifyEnv(t){if(t.testnet&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!t.testnet&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.")}async getFromCache(t,e){let r=await this.definitionCache.get(new Wt(t,"cd"));if(!r)return null;let i=await this.srcCache.get(new Wt(e||r.cachedValue.srcTxId,"src"));return i?{...r.cachedValue,...i.cachedValue}:null}async putToCache(t,e,r){let i=new Na(e),a=new Ra(e);await this.definitionCache.put({key:t,sortKey:"cd"},a),await this.srcCache.put({key:r||a.srcTxId,sortKey:"src"},i)}set warp(t){this._warp=t,this.arweaveWrapper=new le(t),this.contractDefinitionLoader.warp=t}};at();at();var Sr=`query Transactions($tags: [TagFilter!]!, $blockFilter: BlockFilter!, $first: Int!, $after: String) {
    transactions(tags: $tags, block: $blockFilter, first: $first, sort: HEIGHT_ASC, after: $after) {
      pageInfo {
        hasNextPage
      }
      edges {
        node {
          id
          owner { address }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston }
          quantity { winston }
          parent { id }
          bundledIn { id }
        }
        cursor
      }
    }
  }`,uo=`query Transaction($id: ID!) {
  transaction(id: $id) {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          bundledIn { id }
    			parent{ id }
          signature
        }
}`,ho=`query Transactions($tags: [TagFilter!]!) {
  transactions(tags: $tags) {
      edges {
        node {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          parent { id }
          bundledIn { id }
          signature
        }
      }
  }
}`,xr=30*1e3,fo=100,Ie=class{constructor(t){j(this,"arweaveWrapper");j(this,"logger",xt.INST.create(Ie.name));this.warp=t,this.arweaveWrapper=new le(t)}async transaction(t){return(await this.fetch(uo,{id:t})).transaction}async transactionUsingUploaderTag(t){let e={name:_t.UPLOADER_TX_ID,values:[t]},r=(await this.fetch(ho,{tags:[e]})).transactions;if(r.edges.length<1)throw new Error(`No interaction with tag ${_t.UPLOADER_TX_ID}:${t}`);return r.edges[0].node}async transactions(t){let e=(await this.fetch(Sr,t)).transactions,r=[...e.edges];for(;e.pageInfo.hasNextPage;){let i=e.edges[fo-1].cursor,a={...t,after:i};e=(await this.fetch(Sr,a)).transactions,r.push(...e.edges)}return r}async fetch(t,e){let r=It.measure(),i=await this.arweaveWrapper.gql(t,e);for(this.logger.debug("GQL page load:",r.elapsed());i.status===403;)this.logger.warn(`GQL rate limiting, waiting ${xr}ms before next try.`),await un(xr),i=await this.arweaveWrapper.gql(t,e);if(i.status!==200)throw new Error(`Unable to retrieve transactions. Arweave gateway responded with status ${i.status}.`);if(i.data.errors)throw this.logger.error(i.data.errors),new Error("Error while fetching arweave transactions");return i.data.data}},kr=100;function Ar(t){var e,r;return!((e=t.node.parent)!=null&&e.id)&&!((r=t.node.bundledIn)!=null&&r.id)}var go=class{constructor(t,e){j(this,"logger",xt.INST.create("ArweaveGatewayInteractionsLoader"));j(this,"sorter");j(this,"arweaveTransactionQuery");j(this,"_warp");j(this,"tagsParser",new ee);this.arweave=t,this.environment=e,this.sorter=new ar(t)}async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let a=this.sorter.extractBlockHeight(e),c=this.sorter.extractBlockHeight(r),l={tags:[{name:At.APP_NAME,values:["SmartWeaveAction"]},{name:At.CONTRACT_TX_ID,values:[t]}],blockFilter:{min:a,max:c},first:kr},n=It.measure(),p=(await this.arweaveTransactionQuery.transactions(l)).filter(Ar);if(n.stop(),i.internalWrites){let b={tags:[{name:_t.INTERACT_WRITE,values:[t]}],blockFilter:{min:a,max:c},first:kr},U=(await this.arweaveTransactionQuery.transactions(b)).filter(Ar);this.logger.debug("Inner writes interactions length:",U.length),p=p.concat(U)}p=p.filter(b=>b.node.block&&b.node.block.id&&b.node.block.height);let S=new Map;for(let b of p)S.has(b.node.id)||S.set(b.node.id,b);let E=Array.from(S.values()),L=await this.sorter.sort(E);e&&r?L=L.filter(b=>b.node.sortKey.localeCompare(e)>0&&b.node.sortKey.localeCompare(r)<=0):e&&!r?L=L.filter(b=>b.node.sortKey.localeCompare(e)>0):!e&&r&&(L=L.filter(b=>b.node.sortKey.localeCompare(r)<=0)),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:L.length,time:n.elapsed()});let y=this.environment==="local"||this.environment==="testnet",k=this._warp.maybeLoadPlugin("vrf");return L.map(b=>{let U=b.node;return y&&this.tagsParser.hasVrfTag(U)&&(k?U.vrf=k.process().generateMockVrf(U.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),U})}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveTransactionQuery=new Ie(t),this._warp=t}};at();var Cr=class{constructor(t){j(this,"logger",xt.INST.create("CacheableInteractionsLoader"));j(this,"interactionsCache",new Map);this.delegate=t}async load(t,e,r,i){if(this.logger.debug("Loading interactions for",{contractTxId:t,fromSortKey:e,toSortKey:r}),this.interactionsCache.has(t)){let a=this.interactionsCache.get(t);if(a!=null&&a.length){let c=a[a.length-1].sortKey;if(c.localeCompare(r)<0){let l=await this.delegate.load(t,c,r,i),n=a.concat(l);return this.interactionsCache.set(t,n),n}}return a}else{let a=await this.delegate.load(t,e,r,i);return a.length&&this.interactionsCache.set(t,a),a}}type(){return this.delegate.type()}clearCache(){this.interactionsCache.clear()}set warp(t){this.delegate.warp=t}};at();var po=class{constructor(t,e=[]){j(this,"logger",xt.INST.create("DefaultStateEvaluator"));j(this,"tagsParser",new ee);this.arweave=t,this.executionContextModifiers=e}async eval(t){return this.doReadState(t.sortedInteractions,new Rt(t.contractDefinition.initState,{},{}),t)}async doReadState(t,e,r){var T;let{ignoreExceptions:i,stackTrace:a,internalWrites:c}=r.evaluationOptions,{contract:l,contractDefinition:n,sortedInteractions:p,warp:S}=r,E=e.state,L=null,y=e.validity,k=e.errorMessages;r==null||r.handler.initState(E);let b=r.contract.callDepth();this.logger.debug(`${zt(b)}Evaluating state for ${n.txId} [${t.length} non-cached of ${p.length} all]`);let U=null,C=null,K=t.length,z=S.maybeLoadPlugin("evm-signature-verification"),x=S.maybeLoadPlugin("evaluation-progress"),v=S.maybeLoadPlugin("vrf"),w=!1;for(let I=0;I<K&&!w;I++){let P=t[I];L=P.sortKey,l.interactionState().setInitial(l.txId(),new Rt(E,y,k),L);let q=It.measure();if(P.vrf){if(!v)this.logger.warn('Cannot verify vrf for interaction - no "warp-contracts-plugin-vrf" attached!');else if(!v.process().verify(P.vrf,P.sortKey))throw new Error("Vrf verification failed.")}if(z&&this.tagsParser.isEvmSigned(P))try{if(!await z.process(P)){this.logger.warn(`Interaction ${P.id} was not verified, skipping.`);continue}}catch(et){this.logger.error(et);continue}if(this.logger.debug(`${zt(b)}[${n.txId}][${P.id}][${P.block.height}]: ${t.indexOf(P)+1}/${t.length} [of all:${p.length}]`),this.tagsParser.isInteractWrite(P,n.txId)&&c){let et=this.tagsParser.getContractTag(P);this.logger.debug(`${zt(b)}Internal Write - Loading writing contract`,et);let J=l.getCallStack().addInteractionData({interaction:null,interactionTx:P}),tt=S.contract(et,r.contract,{callingInteraction:P,callType:"read"});this.logger.debug(`${zt(b)}Reading state of the calling contract at`,P.sortKey);let st=null,nt=null;try{nt=await tt.readState(P.sortKey),st=l.interactionState().get(l.txId(),P.sortKey)}catch(B){if(B.name=="ContractError"&&(B.subtype=="unsafeClientSkip"||B.subtype=="constructor"||B.subtype=="blacklistedSkip")||B.name=="NonWhitelistedSourceError"){if(this.logger.warn(`Skipping contract in internal write, reason ${B.subtype||B.name}`),k[P.id]=B,je(P)){let O=new Rt(E,y,k);C={tx:P,state:O}}}else throw B}if(st!==null&&nt!==null){let B=nt.cachedValue.validity[P.id];B&&(E=st.state),r==null||r.handler.initState(E),B?(y[P.id]=st.validity[P.id],(T=st.errorMessages)!=null&&T[P.id]&&(k[P.id]=st.errorMessages[P.id])):(y[P.id]=!1,k[P.id]=nt.cachedValue.errorMessages[P.id]);let O=new Rt(E,y,k);je(P)&&(C={tx:P,state:O})}else y[P.id]=!1;J.update({cacheHit:!1,outputState:a.saveState?E:void 0,executionTime:q.elapsed(!0),valid:y[P.id],errorMessage:U,gasUsed:0})}else{let et=this.tagsParser.getInputTag(P,r.contractDefinition.txId);if(!et){this.logger.error(`${zt(b)}Skipping tx - Input tag not found for ${P.id}`);continue}let J=this.parseInput(et);if(!J){this.logger.error(`${zt(b)}Skipping tx - invalid Input tag - ${P.id}`);continue}let tt={input:J,caller:P.owner.address,interactionType:"write"},st={interaction:tt,interactionTx:P},nt=l.getCallStack().addInteractionData(st),B=await r.handler.handle(r,new Rt(E,y,k),st);if(U=B.errorMessage,B.type!=="ok"&&(k[P.id]=U),this.logResult(B,P,r),this.logger.debug(`${zt(b)}Interaction evaluation`,q.elapsed()),nt.update({cacheHit:!1,outputState:a.saveState?E:void 0,executionTime:q.elapsed(!0),valid:y[P.id],errorMessage:U,gasUsed:B.gasUsed}),B.type==="exception"&&i!==!0)throw new Error(`Exception while processing ${JSON.stringify(tt)}:
${B.errorMessage}`);let O=B.type==="ok";y[P.id]=O,E=B.state;let W=new Rt(E,y,k);je(P)&&(C={tx:P,state:W});let F=B.event;F&&S.eventTarget.dispatchEvent(new Ba(O?"interactionCompleted":"interactionFailed",{detail:F}))}x&&x.process({contractTxId:n.txId,allInteractions:K,currentInteraction:I,lastInteractionProcessingTime:q.elapsed()});try{for(let{modify:et}of this.executionContextModifiers)r=await et(E,r)}catch(et){if(et.name=="ContractError"&&et.subtype=="unsafeClientSkip"||et.name=="NonWhitelistedSourceError")y[P.id]=!1,k[P.id]=et.message,w=!0;else throw et}let G=r.evaluationOptions.cacheEveryNInteractions>0&&I%r.evaluationOptions.cacheEveryNInteractions===0;if(l.isRoot())l.clearChildren(),C&&(l.interactionState().update(l.txId(),C.state,C.tx.sortKey),y[P.id]?await l.interactionState().commit(P,G):await l.interactionState().rollback(P,G));else{let et=new Rt(E,y,k);l.interactionState().update(l.txId(),et,L)}}let u=new Rt(E,y,k);return C!==null&&await this.onStateEvaluated(C.tx,r,C.state),new Pt(L,u)}logResult(t,e,r){t.type==="exception"&&this.logger.error(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] threw exception:`,`${t.errorMessage}`),t.type==="error"&&this.logger.warn(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] returned error:`,t.errorMessage)}parseInput(t){try{return JSON.parse(t.value)}catch(e){return this.logger.error(e),null}}};function je(t){return t.confirmationStatus===void 0?!0:t.confirmationStatus==="confirmed"}at();var wo=class extends po{constructor(e,r,i=[]){super(e,i);j(this,"cLogger",xt.INST.create("CacheableStateEvaluator"));this.cache=r}async eval(e){var E,L,y,k;let{cachedState:r,contract:i}=e,a=e.sortedInteractions;if(r&&r.sortKey==e.requestedSortKey&&!(a!=null&&a.length))return this.cLogger.info(`Exact cache hit for sortKey ${(E=e==null?void 0:e.contractDefinition)==null?void 0:E.txId}:${r.sortKey}`),(L=e.handler)==null||L.initState(r.cachedValue.state),r;let c=e.contractDefinition.txId;if(!c)throw new Error("Contract tx id not set in the execution context");let l=r==null,n=l?e.contractDefinition.initState:r.cachedValue.state,p=l?{}:r.cachedValue.validity,S=l?{}:r.cachedValue.errorMessages;if(l&&(n=await e.handler.maybeCallStateConstructor(e.contractDefinition.initState,e),await i.interactionState().commitKV()),a.length==0)if(this.cLogger.info(`No missing interactions ${c}`),l){(y=e.handler)==null||y.initState(n),this.cLogger.debug("Inserting initial state into cache");let b=new Rt(n,{},{});return await this.cache.put(new Wt(c,Ge),b),new Pt(Ge,b)}else return(k=e.handler)==null||k.initState(r.cachedValue.state),r;return await this.doReadState(a,new Rt(n,p,S||{}),e)}async onStateEvaluated(e,r,i){let a=r.contractDefinition.txId;this.cLogger.debug(`${zt(r.contract.callDepth())}onStateEvaluated: cache update for contract ${a} [${e.sortKey}]`),await this.putInCache(a,e,i)}async onStateUpdate(e,r,i,a=!1){(r.evaluationOptions.updateCacheForEachInteraction||a)&&(this.cLogger.debug(`onStateUpdate: cache update for contract ${r.contractDefinition.txId} [${e.sortKey}]`,{contract:r.contractDefinition.txId,state:i.state,sortKey:e.sortKey}),await this.putInCache(r.contractDefinition.txId,e,i))}async latestAvailableState(e,r){if(this.cLogger.debug("Searching for",{contractTxId:e,sortKey:r}),r){let i=await this.cache.getLessOrEqual(e,r);return i&&this.cLogger.debug(`Latest available state at ${e}: ${i.sortKey}`),i}else return await this.cache.getLast(e)}async onInternalWriteStateUpdate(e,r,i){this.cLogger.debug("Internal write state update:",{sortKey:e.sortKey,dry:e.dry,contractTxId:r,state:i.state}),await this.putInCache(r,e,i)}async onContractCall(e,r,i){var c;if(((c=r.sortedInteractions)==null?void 0:c.length)==0)return;let a=r.sortedInteractions.indexOf(e);a<1||await this.putInCache(r.contractDefinition.txId,r.sortedInteractions[a-1],i)}async putInCache(e,r,i){if(r.dry||r.confirmationStatus!==void 0&&r.confirmationStatus!=="confirmed")return;let a=new Rt(i.state,i.validity,i.errorMessages||{});this.cLogger.debug("Putting into cache",{contractTxId:e,transaction:r.id,sortKey:r.sortKey,dry:r.dry}),await this.cache.put(new Wt(e,r.sortKey),a)}async syncState(e,r,i,a){let c=new Rt(i,a,{});return await this.cache.put(new Wt(e,r),c),new Pt(r,c)}async dumpCache(){return await this.cache.dump()}async internalWriteState(e,r){return await this.cache.get(new Wt(e,r))}async hasContractCached(e){return await this.cache.getLast(e)!=null}async lastCachedSortKey(){return await this.cache.getLastSortKey()}setCache(e){this.cache=e}getCache(){return this.cache}};at();var yo=Lt(te()),De=class{constructor(t,e,r=null){j(this,"interactions",{});j(this,"id");this.contractTxId=t,this.depth=e,this.innerCallType=r,this.id=yo.Crypto.randomUUID()}addInteractionData(t){let{interaction:e,interactionTx:r}=t,i=En.create(new mo(r.id,r.sortKey,r.block.height,r.block.timestamp,e==null?void 0:e.caller,e==null?void 0:e.input.function,e==null?void 0:e.input,r.dry,{}));return this.interactions[r.id]=i,i}getInteraction(t){return this.interactions[t]}print(){return JSON.stringify(this,null,2)}},En=class{constructor(t){j(this,"interactionOutput");this.interactionInput=t}static create(t){return new En(t)}update(t){this.interactionOutput=t}},mo=class{constructor(t,e,r,i,a,c,l,n,p={}){this.txId=t,this.sortKey=e,this.blockHeight=r,this.blockTimestamp=i,this.caller=a,this.functionName=c,this.functionArguments=l,this.dryWrite=n,this.foreignContractCalls=p}},Os=class{constructor(t,e,r,i,a="",c){this.cacheHit=t,this.outputState=e,this.executionTime=r,this.valid=i,this.errorMessage=a,this.gasUsed=c}};at();var Ke=Lt(er());at();at();var bo=(t=>(t.CONTRACT_NOT_FOUND="CONTRACT_NOT_FOUND",t))(bo||{}),vo=class extends Error{constructor(e,r={}){var t=(...Sc)=>(super(...Sc),j(this,"type"),j(this,"otherInfo"),this);r.message?t(r.message):t(),this.type=e,this.otherInfo=r}getType(){return this.type}};function _o(t){if(!t)return!1;let e=Tn(t);return t.evolve!==void 0||e.has("evolve")}var Se=class{constructor(){j(this,"logger",xt.INST.create("Evolve"));this.modify=this.modify.bind(this)}async modify(t,e){let{definitionLoader:r,executorFactory:i}=e.warp,a=e.contractDefinition.txId,c=Se.evolvedSrcTxId(t),l=e.contractDefinition.srcTxId;if(c&&l!==c)try{this.logger.info("Evolving to: ",c);let n=await r.load(a,c),p=await i.create(n,e.evaluationOptions,e.warp,e.contract.interactionState());return e.contractDefinition=n,e.handler=p,e.handler.initState(t),this.logger.debug("evolved to:",{evolve:c,newSrcTxId:e.contractDefinition.srcTxId,currentSrcTxId:l,contract:e.contractDefinition.txId}),e}catch(n){throw n.name==="ContractError"&&n.subtype==="unsafeClientSkip"||n.name=="NonWhitelistedSourceError"?n:new vo("CONTRACT_NOT_FOUND",{message:`Error while evolving ${a} from ${l} to ${c}: ${n}`,requestedTxId:a})}return e}static evolvedSrcTxId(t){if(!_o(t))return;let e=Tn(t),r=t.evolve||e.get("evolve"),i=t.canEvolve||e.get("canEvolve");if(i==null&&(i=!0),r&&/[a-z0-9_-]{43}/i.test(r)&&i)return r}};function Tn(t){let e=new Map;return t.settings&&(Eo(t.settings)?e=new Map(t.settings):To(t.settings)&&(e=new Map(Object.entries(t.settings)))),e}function Eo(t){return t==null?!1:typeof t[Symbol.iterator]=="function"}function To(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}at();at();at();var Sn=Lt(Ci(),1);Sn.default.configure;var So=Sn.default;at();async function Ir(t,e,r,i,a,c="",l="0",n=!1,p,S){let E={data:Math.random().toString().slice(-4)};c&&c.length&&(E.target=c.toString(),l&&+l>0&&(E.quantity=l.toString())),n&&(E.reward="0",E.last_tx="p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"),S&&S.length&&(E.reward=S);let L=await t.createTransaction(E);return xn(r,i,p,a).forEach(y=>L.addTag(y.name,y.value)),e&&await e(L),L}function xo(t,e,r){let i=new ee().decodeTags(t);return{id:t.id,owner:{address:e,key:""},recipient:t.target,tags:i,fee:{winston:t.reward,ar:""},quantity:{winston:t.quantity,ar:""},block:{id:r.indep_hash,height:r.height,timestamp:r.timestamp,previous:null},dry:!0,anchor:null,signature:null,data:null,parent:null,bundledIn:null}}function xn(t,e,r,i){let a=[];if(i&&i.length)for(let c of i)a.push(new $t(c.name.toString(),c.value.toString()));return a.push(new $t(At.APP_NAME,"SmartWeaveAction")),a.push(new $t(At.APP_VERSION,"0.3.0")),a.push(new $t(At.SDK,"Warp")),a.push(new $t(At.CONTRACT_TX_ID,t)),a.push(new $t(At.INPUT,JSON.stringify(e))),r&&a.push(new $t(_t.WARP_TESTNET,"1.0.0")),a}at();var ne={target:"",winstonQty:"0"},Ls=["node1","node2","arweave"];at();var ko=class{eval(t){let e=[];return Object.keys(t.interactions).forEach(r=>{let i=t.interactions[r];this.evalForeignCalls(t.contractTxId,i,e)}),e}evalForeignCalls(t,e,r){Object.keys(e.interactionInput.foreignContractCalls).forEach(i=>{let a=e.interactionInput.foreignContractCalls[i];a.innerCallType=="write"&&Object.keys(a.interactions).forEach(c=>{let l=a.interactions[c];l.interactionInput.dryWrite&&!r.includes(a.contractTxId)&&t!==a.contractTxId&&r.push(a.contractTxId),this.evalForeignCalls(t,l,r)})})}};at();at();var Ao=Object.create,lr=Object.defineProperty,Co=Object.getOwnPropertyDescriptor,Io=Object.getOwnPropertyNames,Oo=Object.getPrototypeOf,Lo=Object.prototype.hasOwnProperty,qt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Bo=(t,e)=>{for(var r in e)lr(t,r,{get:e[r],enumerable:!0})},No=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Io(e))!Lo.call(t,a)&&a!==r&&lr(t,a,{get:()=>e[a],enumerable:!(i=Co(e,a))||i.enumerable});return t},re=(t,e,r)=>(r=t!=null?Ao(Oo(t)):{},No(e||!t||!t.__esModule?lr(r,"default",{value:t,enumerable:!0}):r,t)),Ro=qt(t=>{Object.defineProperty(t,"__esModule",{value:!0});function e(r){var i=4,a=r.length,c=a%i;if(!c)return r;var l=a,n=i-c,p=a+n,S=Ct.Buffer.alloc(p);for(S.write(r);n--;)S.write("=",l++);return S.toString()}t.default=e}),Uo=qt(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=Ro();function r(p,S){return S===void 0&&(S="utf8"),Ct.Buffer.isBuffer(p)?c(p.toString("base64")):c(Ct.Buffer.from(p,S).toString("base64"))}function i(p,S){return S===void 0&&(S="utf8"),Ct.Buffer.from(a(p),"base64").toString(S)}function a(p){return p=p.toString(),e.default(p).replace(/\-/g,"+").replace(/_/g,"/")}function c(p){return p.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function l(p){return Ct.Buffer.from(a(p),"base64")}var n=r;n.encode=r,n.decode=i,n.toBase64=a,n.fromBase64=c,n.toBuffer=l,t.default=n}),cr=qt((t,e)=>{e.exports=Uo().default,e.exports.default=e.exports}),kn=qt(t=>{t.byteLength=p,t.toByteArray=E,t.fromByteArray=k;var e=[],r=[],i=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(c=0,l=a.length;c<l;++c)e[c]=a[c],r[a.charCodeAt(c)]=c;var c,l;r[45]=62,r[95]=63;function n(b){var U=b.length;if(U%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var C=b.indexOf("=");C===-1&&(C=U);var K=C===U?0:4-C%4;return[C,K]}function p(b){var U=n(b),C=U[0],K=U[1];return(C+K)*3/4-K}function S(b,U,C){return(U+C)*3/4-C}function E(b){var U,C=n(b),K=C[0],z=C[1],x=new i(S(b,K,z)),v=0,w=z>0?K-4:K,u;for(u=0;u<w;u+=4)U=r[b.charCodeAt(u)]<<18|r[b.charCodeAt(u+1)]<<12|r[b.charCodeAt(u+2)]<<6|r[b.charCodeAt(u+3)],x[v++]=U>>16&255,x[v++]=U>>8&255,x[v++]=U&255;return z===2&&(U=r[b.charCodeAt(u)]<<2|r[b.charCodeAt(u+1)]>>4,x[v++]=U&255),z===1&&(U=r[b.charCodeAt(u)]<<10|r[b.charCodeAt(u+1)]<<4|r[b.charCodeAt(u+2)]>>2,x[v++]=U>>8&255,x[v++]=U&255),x}function L(b){return e[b>>18&63]+e[b>>12&63]+e[b>>6&63]+e[b&63]}function y(b,U,C){for(var K,z=[],x=U;x<C;x+=3)K=(b[x]<<16&16711680)+(b[x+1]<<8&65280)+(b[x+2]&255),z.push(L(K));return z.join("")}function k(b){for(var U,C=b.length,K=C%3,z=[],x=16383,v=0,w=C-K;v<w;v+=x)z.push(y(b,v,v+x>w?w:v+x));return K===1?(U=b[C-1],z.push(e[U>>2]+e[U<<4&63]+"==")):K===2&&(U=(b[C-2]<<8)+b[C-1],z.push(e[U>>10]+e[U>>4&63]+e[U<<2&63]+"=")),z.join("")}}),An=qt(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.b64UrlDecode=t.b64UrlEncode=t.bufferTob64Url=t.bufferTob64=t.b64UrlToBuffer=t.stringToB64Url=t.stringToBuffer=t.bufferToString=t.b64UrlToString=t.concatBuffers=void 0;var e=kn();function r(y){let k=0;for(let C=0;C<y.length;C++)k+=y[C].byteLength;let b=new Uint8Array(k),U=0;b.set(new Uint8Array(y[0]),U),U+=y[0].byteLength;for(let C=1;C<y.length;C++)b.set(new Uint8Array(y[C]),U),U+=y[C].byteLength;return b}t.concatBuffers=r;function i(y){let k=n(y);return a(k)}t.b64UrlToString=i;function a(y){return new TextDecoder("utf-8",{fatal:!0}).decode(y)}t.bufferToString=a;function c(y){return new TextEncoder().encode(y)}t.stringToBuffer=c;function l(y){return S(c(y))}t.stringToB64Url=l;function n(y){return new Uint8Array(e.toByteArray(L(y)))}t.b64UrlToBuffer=n;function p(y){return e.fromByteArray(new Uint8Array(y))}t.bufferTob64=p;function S(y){return E(p(y))}t.bufferTob64Url=S;function E(y){return y.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}t.b64UrlEncode=E;function L(y){y=y.replace(/\-/g,"+").replace(/\_/g,"/");let k;return y.length%4==0?k=0:k=4-y.length%4,y.concat("=".repeat(k))}t.b64UrlDecode=L}),$o=qt(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=An(),r=class{constructor(){j(this,"keyLength",4096);j(this,"publicExponent",65537);j(this,"hashAlgorithm","sha256");j(this,"driver");if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let i=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),a=await this.driver.exportKey("jwk",i.privateKey);return{kty:a.kty,e:a.e,n:a.n,d:a.d,p:a.p,q:a.q,dp:a.dp,dq:a.dq,qi:a.qi}}async sign(i,a,{saltLength:c}={}){let l=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(i),a);return new Uint8Array(l)}async hash(i,a="SHA-256"){let c=await this.driver.digest(a,i);return new Uint8Array(c)}async verify(i,a,c){let l={kty:"RSA",e:"AQAB",n:i},n=await this.jwkToPublicCryptoKey(l),p=await this.driver.digest("SHA-256",a),S=await this.driver.verify({name:"RSA-PSS",saltLength:0},n,c,a),E=await this.driver.verify({name:"RSA-PSS",saltLength:32},n,c,a),L=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((n.algorithm.modulusLength-1)/8)-p.byteLength-2},n,c,a);return S||E||L}async jwkToCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let i=crypto==null?void 0:crypto.subtle;return i===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(a=>typeof i[a]=="function")}async encrypt(i,a,c){let l=await this.driver.importKey("raw",typeof a=="string"?e.stringToBuffer(a):a,{name:"PBKDF2",length:32},!1,["deriveKey"]),n=await this.driver.deriveKey({name:"PBKDF2",salt:c?e.stringToBuffer(c):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},l,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),p=new Uint8Array(16);crypto.getRandomValues(p);let S=await this.driver.encrypt({name:"AES-CBC",iv:p},n,i);return e.concatBuffers([p,S])}async decrypt(i,a,c){let l=await this.driver.importKey("raw",typeof a=="string"?e.stringToBuffer(a):a,{name:"PBKDF2",length:32},!1,["deriveKey"]),n=await this.driver.deriveKey({name:"PBKDF2",salt:c?e.stringToBuffer(c):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},l,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),p=i.slice(0,16),S=await this.driver.decrypt({name:"AES-CBC",iv:p},n,i.slice(16));return e.concatBuffers([S])}};t.default=r}),Po=qt(t=>{t.read=function(e,r,i,a,c){var l,n,p=c*8-a-1,S=(1<<p)-1,E=S>>1,L=-7,y=i?c-1:0,k=i?-1:1,b=e[r+y];for(y+=k,l=b&(1<<-L)-1,b>>=-L,L+=p;L>0;l=l*256+e[r+y],y+=k,L-=8);for(n=l&(1<<-L)-1,l>>=-L,L+=a;L>0;n=n*256+e[r+y],y+=k,L-=8);if(l===0)l=1-E;else{if(l===S)return n?NaN:(b?-1:1)*(1/0);n=n+Math.pow(2,a),l=l-E}return(b?-1:1)*n*Math.pow(2,l-a)},t.write=function(e,r,i,a,c,l){var n,p,S,E=l*8-c-1,L=(1<<E)-1,y=L>>1,k=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=a?0:l-1,U=a?1:-1,C=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(p=isNaN(r)?1:0,n=L):(n=Math.floor(Math.log(r)/Math.LN2),r*(S=Math.pow(2,-n))<1&&(n--,S*=2),n+y>=1?r+=k/S:r+=k*Math.pow(2,1-y),r*S>=2&&(n++,S/=2),n+y>=L?(p=0,n=L):n+y>=1?(p=(r*S-1)*Math.pow(2,c),n=n+y):(p=r*Math.pow(2,y-1)*Math.pow(2,c),n=0));c>=8;e[i+b]=p&255,b+=U,p/=256,c-=8);for(n=n<<c|p,E+=c;E>0;e[i+b]=n&255,b+=U,n/=256,E-=8);e[i+b-U]|=C*128}}),He=qt(t=>{var e=kn(),r=Po(),i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=n,t.SlowBuffer=z,t.INSPECT_MAX_BYTES=50;var a=2147483647;t.kMaxLength=a,n.TYPED_ARRAY_SUPPORT=c(),!n.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{let o=new Uint8Array(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,Uint8Array.prototype),Object.setPrototypeOf(o,g),o.foo()===42}catch{return!1}}Object.defineProperty(n.prototype,"parent",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.buffer}}),Object.defineProperty(n.prototype,"offset",{enumerable:!0,get:function(){if(n.isBuffer(this))return this.byteOffset}});function l(o){if(o>a)throw new RangeError('The value "'+o+'" is invalid for option "size"');let g=new Uint8Array(o);return Object.setPrototypeOf(g,n.prototype),g}function n(o,g,m){if(typeof o=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(o)}return p(o,g,m)}n.poolSize=8192;function p(o,g,m){if(typeof o=="string")return y(o,g);if(ArrayBuffer.isView(o))return b(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(_(o,ArrayBuffer)||o&&_(o.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(_(o,SharedArrayBuffer)||o&&_(o.buffer,SharedArrayBuffer)))return U(o,g,m);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let V=o.valueOf&&o.valueOf();if(V!=null&&V!==o)return n.from(V,g,m);let Q=C(o);if(Q)return Q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return n.from(o[Symbol.toPrimitive]("string"),g,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}n.from=function(o,g,m){return p(o,g,m)},Object.setPrototypeOf(n.prototype,Uint8Array.prototype),Object.setPrototypeOf(n,Uint8Array);function S(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function E(o,g,m){return S(o),o<=0?l(o):g!==void 0?typeof m=="string"?l(o).fill(g,m):l(o).fill(g):l(o)}n.alloc=function(o,g,m){return E(o,g,m)};function L(o){return S(o),l(o<0?0:K(o)|0)}n.allocUnsafe=function(o){return L(o)},n.allocUnsafeSlow=function(o){return L(o)};function y(o,g){if((typeof g!="string"||g==="")&&(g="utf8"),!n.isEncoding(g))throw new TypeError("Unknown encoding: "+g);let m=x(o,g)|0,V=l(m),Q=V.write(o,g);return Q!==m&&(V=V.slice(0,Q)),V}function k(o){let g=o.length<0?0:K(o.length)|0,m=l(g);for(let V=0;V<g;V+=1)m[V]=o[V]&255;return m}function b(o){if(_(o,Uint8Array)){let g=new Uint8Array(o);return U(g.buffer,g.byteOffset,g.byteLength)}return k(o)}function U(o,g,m){if(g<0||o.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<g+(m||0))throw new RangeError('"length" is outside of buffer bounds');let V;return g===void 0&&m===void 0?V=new Uint8Array(o):m===void 0?V=new Uint8Array(o,g):V=new Uint8Array(o,g,m),Object.setPrototypeOf(V,n.prototype),V}function C(o){if(n.isBuffer(o)){let g=K(o.length)|0,m=l(g);return m.length===0||o.copy(m,0,0,g),m}if(o.length!==void 0)return typeof o.length!="number"||D(o.length)?l(0):k(o);if(o.type==="Buffer"&&Array.isArray(o.data))return k(o.data)}function K(o){if(o>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return o|0}function z(o){return+o!=o&&(o=0),n.alloc(+o)}n.isBuffer=function(o){return o!=null&&o._isBuffer===!0&&o!==n.prototype},n.compare=function(o,g){if(_(o,Uint8Array)&&(o=n.from(o,o.offset,o.byteLength)),_(g,Uint8Array)&&(g=n.from(g,g.offset,g.byteLength)),!n.isBuffer(o)||!n.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(o===g)return 0;let m=o.length,V=g.length;for(let Q=0,it=Math.min(m,V);Q<it;++Q)if(o[Q]!==g[Q]){m=o[Q],V=g[Q];break}return m<V?-1:V<m?1:0},n.isEncoding=function(o){switch(String(o).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(o,g){if(!Array.isArray(o))throw new TypeError('"list" argument must be an Array of Buffers');if(o.length===0)return n.alloc(0);let m;if(g===void 0)for(g=0,m=0;m<o.length;++m)g+=o[m].length;let V=n.allocUnsafe(g),Q=0;for(m=0;m<o.length;++m){let it=o[m];if(_(it,Uint8Array))Q+it.length>V.length?(n.isBuffer(it)||(it=n.from(it)),it.copy(V,Q)):Uint8Array.prototype.set.call(V,it,Q);else if(n.isBuffer(it))it.copy(V,Q);else throw new TypeError('"list" argument must be an Array of Buffers');Q+=it.length}return V};function x(o,g){if(n.isBuffer(o))return o.length;if(ArrayBuffer.isView(o)||_(o,ArrayBuffer))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);let m=o.length,V=arguments.length>2&&arguments[2]===!0;if(!V&&m===0)return 0;let Q=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return h(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return R(o).length;default:if(Q)return V?-1:h(o).length;g=(""+g).toLowerCase(),Q=!0}}n.byteLength=x;function v(o,g,m){let V=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,g>>>=0,m<=g))return"";for(o||(o="utf8");;)switch(o){case"hex":return W(this,g,m);case"utf8":case"utf-8":return tt(this,g,m);case"ascii":return B(this,g,m);case"latin1":case"binary":return O(this,g,m);case"base64":return J(this,g,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,g,m);default:if(V)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),V=!0}}n.prototype._isBuffer=!0;function w(o,g,m){let V=o[g];o[g]=o[m],o[m]=V}n.prototype.swap16=function(){let o=this.length;if(o%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<o;g+=2)w(this,g,g+1);return this},n.prototype.swap32=function(){let o=this.length;if(o%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<o;g+=4)w(this,g,g+3),w(this,g+1,g+2);return this},n.prototype.swap64=function(){let o=this.length;if(o%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<o;g+=8)w(this,g,g+7),w(this,g+1,g+6),w(this,g+2,g+5),w(this,g+3,g+4);return this},n.prototype.toString=function(){let o=this.length;return o===0?"":arguments.length===0?tt(this,0,o):v.apply(this,arguments)},n.prototype.toLocaleString=n.prototype.toString,n.prototype.equals=function(o){if(!n.isBuffer(o))throw new TypeError("Argument must be a Buffer");return this===o?!0:n.compare(this,o)===0},n.prototype.inspect=function(){let o="",g=t.INSPECT_MAX_BYTES;return o=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(o+=" ... "),"<Buffer "+o+">"},i&&(n.prototype[i]=n.prototype.inspect),n.prototype.compare=function(o,g,m,V,Q){if(_(o,Uint8Array)&&(o=n.from(o,o.offset,o.byteLength)),!n.isBuffer(o))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof o);if(g===void 0&&(g=0),m===void 0&&(m=o?o.length:0),V===void 0&&(V=0),Q===void 0&&(Q=this.length),g<0||m>o.length||V<0||Q>this.length)throw new RangeError("out of range index");if(V>=Q&&g>=m)return 0;if(V>=Q)return-1;if(g>=m)return 1;if(g>>>=0,m>>>=0,V>>>=0,Q>>>=0,this===o)return 0;let it=Q-V,ct=m-g,Et=Math.min(it,ct),kt=this.slice(V,Q),Tt=o.slice(g,m);for(let vt=0;vt<Et;++vt)if(kt[vt]!==Tt[vt]){it=kt[vt],ct=Tt[vt];break}return it<ct?-1:ct<it?1:0};function u(o,g,m,V,Q){if(o.length===0)return-1;if(typeof m=="string"?(V=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,D(m)&&(m=Q?0:o.length-1),m<0&&(m=o.length+m),m>=o.length){if(Q)return-1;m=o.length-1}else if(m<0)if(Q)m=0;else return-1;if(typeof g=="string"&&(g=n.from(g,V)),n.isBuffer(g))return g.length===0?-1:T(o,g,m,V,Q);if(typeof g=="number")return g=g&255,typeof Uint8Array.prototype.indexOf=="function"?Q?Uint8Array.prototype.indexOf.call(o,g,m):Uint8Array.prototype.lastIndexOf.call(o,g,m):T(o,[g],m,V,Q);throw new TypeError("val must be string, number or Buffer")}function T(o,g,m,V,Q){let it=1,ct=o.length,Et=g.length;if(V!==void 0&&(V=String(V).toLowerCase(),V==="ucs2"||V==="ucs-2"||V==="utf16le"||V==="utf-16le")){if(o.length<2||g.length<2)return-1;it=2,ct/=2,Et/=2,m/=2}function kt(vt,bt){return it===1?vt[bt]:vt.readUInt16BE(bt*it)}let Tt;if(Q){let vt=-1;for(Tt=m;Tt<ct;Tt++)if(kt(o,Tt)===kt(g,vt===-1?0:Tt-vt)){if(vt===-1&&(vt=Tt),Tt-vt+1===Et)return vt*it}else vt!==-1&&(Tt-=Tt-vt),vt=-1}else for(m+Et>ct&&(m=ct-Et),Tt=m;Tt>=0;Tt--){let vt=!0;for(let bt=0;bt<Et;bt++)if(kt(o,Tt+bt)!==kt(g,bt)){vt=!1;break}if(vt)return Tt}return-1}n.prototype.includes=function(o,g,m){return this.indexOf(o,g,m)!==-1},n.prototype.indexOf=function(o,g,m){return u(this,o,g,m,!0)},n.prototype.lastIndexOf=function(o,g,m){return u(this,o,g,m,!1)};function I(o,g,m,V){m=Number(m)||0;let Q=o.length-m;V?(V=Number(V),V>Q&&(V=Q)):V=Q;let it=g.length;V>it/2&&(V=it/2);let ct;for(ct=0;ct<V;++ct){let Et=parseInt(g.substr(ct*2,2),16);if(D(Et))return ct;o[m+ct]=Et}return ct}function P(o,g,m,V){return f(h(g,o.length-m),o,m,V)}function q(o,g,m,V){return f(d(g),o,m,V)}function G(o,g,m,V){return f(R(g),o,m,V)}function et(o,g,m,V){return f(A(g,o.length-m),o,m,V)}n.prototype.write=function(o,g,m,V){if(g===void 0)V="utf8",m=this.length,g=0;else if(m===void 0&&typeof g=="string")V=g,m=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(m)?(m=m>>>0,V===void 0&&(V="utf8")):(V=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let Q=this.length-g;if((m===void 0||m>Q)&&(m=Q),o.length>0&&(m<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");V||(V="utf8");let it=!1;for(;;)switch(V){case"hex":return I(this,o,g,m);case"utf8":case"utf-8":return P(this,o,g,m);case"ascii":case"latin1":case"binary":return q(this,o,g,m);case"base64":return G(this,o,g,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,o,g,m);default:if(it)throw new TypeError("Unknown encoding: "+V);V=(""+V).toLowerCase(),it=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(o,g,m){return g===0&&m===o.length?e.fromByteArray(o):e.fromByteArray(o.slice(g,m))}function tt(o,g,m){m=Math.min(o.length,m);let V=[],Q=g;for(;Q<m;){let it=o[Q],ct=null,Et=it>239?4:it>223?3:it>191?2:1;if(Q+Et<=m){let kt,Tt,vt,bt;switch(Et){case 1:it<128&&(ct=it);break;case 2:kt=o[Q+1],(kt&192)===128&&(bt=(it&31)<<6|kt&63,bt>127&&(ct=bt));break;case 3:kt=o[Q+1],Tt=o[Q+2],(kt&192)===128&&(Tt&192)===128&&(bt=(it&15)<<12|(kt&63)<<6|Tt&63,bt>2047&&(bt<55296||bt>57343)&&(ct=bt));break;case 4:kt=o[Q+1],Tt=o[Q+2],vt=o[Q+3],(kt&192)===128&&(Tt&192)===128&&(vt&192)===128&&(bt=(it&15)<<18|(kt&63)<<12|(Tt&63)<<6|vt&63,bt>65535&&bt<1114112&&(ct=bt))}}ct===null?(ct=65533,Et=1):ct>65535&&(ct-=65536,V.push(ct>>>10&1023|55296),ct=56320|ct&1023),V.push(ct),Q+=Et}return nt(V)}var st=4096;function nt(o){let g=o.length;if(g<=st)return String.fromCharCode.apply(String,o);let m="",V=0;for(;V<g;)m+=String.fromCharCode.apply(String,o.slice(V,V+=st));return m}function B(o,g,m){let V="";m=Math.min(o.length,m);for(let Q=g;Q<m;++Q)V+=String.fromCharCode(o[Q]&127);return V}function O(o,g,m){let V="";m=Math.min(o.length,m);for(let Q=g;Q<m;++Q)V+=String.fromCharCode(o[Q]);return V}function W(o,g,m){let V=o.length;(!g||g<0)&&(g=0),(!m||m<0||m>V)&&(m=V);let Q="";for(let it=g;it<m;++it)Q+=Y[o[it]];return Q}function F(o,g,m){let V=o.slice(g,m),Q="";for(let it=0;it<V.length-1;it+=2)Q+=String.fromCharCode(V[it]+V[it+1]*256);return Q}n.prototype.slice=function(o,g){let m=this.length;o=~~o,g=g===void 0?m:~~g,o<0?(o+=m,o<0&&(o=0)):o>m&&(o=m),g<0?(g+=m,g<0&&(g=0)):g>m&&(g=m),g<o&&(g=o);let V=this.subarray(o,g);return Object.setPrototypeOf(V,n.prototype),V};function Z(o,g,m){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+g>m)throw new RangeError("Trying to access beyond buffer length")}n.prototype.readUintLE=n.prototype.readUIntLE=function(o,g,m){o=o>>>0,g=g>>>0,m||Z(o,g,this.length);let V=this[o],Q=1,it=0;for(;++it<g&&(Q*=256);)V+=this[o+it]*Q;return V},n.prototype.readUintBE=n.prototype.readUIntBE=function(o,g,m){o=o>>>0,g=g>>>0,m||Z(o,g,this.length);let V=this[o+--g],Q=1;for(;g>0&&(Q*=256);)V+=this[o+--g]*Q;return V},n.prototype.readUint8=n.prototype.readUInt8=function(o,g){return o=o>>>0,g||Z(o,1,this.length),this[o]},n.prototype.readUint16LE=n.prototype.readUInt16LE=function(o,g){return o=o>>>0,g||Z(o,2,this.length),this[o]|this[o+1]<<8},n.prototype.readUint16BE=n.prototype.readUInt16BE=function(o,g){return o=o>>>0,g||Z(o,2,this.length),this[o]<<8|this[o+1]},n.prototype.readUint32LE=n.prototype.readUInt32LE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),(this[o]|this[o+1]<<8|this[o+2]<<16)+this[o+3]*16777216},n.prototype.readUint32BE=n.prototype.readUInt32BE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),this[o]*16777216+(this[o+1]<<16|this[o+2]<<8|this[o+3])},n.prototype.readBigUInt64LE=lt(function(o){o=o>>>0,M(o,"offset");let g=this[o],m=this[o+7];(g===void 0||m===void 0)&&X(o,this.length-8);let V=g+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24,Q=this[++o]+this[++o]*2**8+this[++o]*2**16+m*2**24;return BigInt(V)+(BigInt(Q)<<BigInt(32))}),n.prototype.readBigUInt64BE=lt(function(o){o=o>>>0,M(o,"offset");let g=this[o],m=this[o+7];(g===void 0||m===void 0)&&X(o,this.length-8);let V=g*2**24+this[++o]*2**16+this[++o]*2**8+this[++o],Q=this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+m;return(BigInt(V)<<BigInt(32))+BigInt(Q)}),n.prototype.readIntLE=function(o,g,m){o=o>>>0,g=g>>>0,m||Z(o,g,this.length);let V=this[o],Q=1,it=0;for(;++it<g&&(Q*=256);)V+=this[o+it]*Q;return Q*=128,V>=Q&&(V-=Math.pow(2,8*g)),V},n.prototype.readIntBE=function(o,g,m){o=o>>>0,g=g>>>0,m||Z(o,g,this.length);let V=g,Q=1,it=this[o+--V];for(;V>0&&(Q*=256);)it+=this[o+--V]*Q;return Q*=128,it>=Q&&(it-=Math.pow(2,8*g)),it},n.prototype.readInt8=function(o,g){return o=o>>>0,g||Z(o,1,this.length),this[o]&128?(255-this[o]+1)*-1:this[o]},n.prototype.readInt16LE=function(o,g){o=o>>>0,g||Z(o,2,this.length);let m=this[o]|this[o+1]<<8;return m&32768?m|4294901760:m},n.prototype.readInt16BE=function(o,g){o=o>>>0,g||Z(o,2,this.length);let m=this[o+1]|this[o]<<8;return m&32768?m|4294901760:m},n.prototype.readInt32LE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),this[o]|this[o+1]<<8|this[o+2]<<16|this[o+3]<<24},n.prototype.readInt32BE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),this[o]<<24|this[o+1]<<16|this[o+2]<<8|this[o+3]},n.prototype.readBigInt64LE=lt(function(o){o=o>>>0,M(o,"offset");let g=this[o],m=this[o+7];(g===void 0||m===void 0)&&X(o,this.length-8);let V=this[o+4]+this[o+5]*2**8+this[o+6]*2**16+(m<<24);return(BigInt(V)<<BigInt(32))+BigInt(g+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24)}),n.prototype.readBigInt64BE=lt(function(o){o=o>>>0,M(o,"offset");let g=this[o],m=this[o+7];(g===void 0||m===void 0)&&X(o,this.length-8);let V=(g<<24)+this[++o]*2**16+this[++o]*2**8+this[++o];return(BigInt(V)<<BigInt(32))+BigInt(this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+m)}),n.prototype.readFloatLE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),r.read(this,o,!0,23,4)},n.prototype.readFloatBE=function(o,g){return o=o>>>0,g||Z(o,4,this.length),r.read(this,o,!1,23,4)},n.prototype.readDoubleLE=function(o,g){return o=o>>>0,g||Z(o,8,this.length),r.read(this,o,!0,52,8)},n.prototype.readDoubleBE=function(o,g){return o=o>>>0,g||Z(o,8,this.length),r.read(this,o,!1,52,8)};function ot(o,g,m,V,Q,it){if(!n.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>Q||g<it)throw new RangeError('"value" argument is out of bounds');if(m+V>o.length)throw new RangeError("Index out of range")}n.prototype.writeUintLE=n.prototype.writeUIntLE=function(o,g,m,V){if(o=+o,g=g>>>0,m=m>>>0,!V){let ct=Math.pow(2,8*m)-1;ot(this,o,g,m,ct,0)}let Q=1,it=0;for(this[g]=o&255;++it<m&&(Q*=256);)this[g+it]=o/Q&255;return g+m},n.prototype.writeUintBE=n.prototype.writeUIntBE=function(o,g,m,V){if(o=+o,g=g>>>0,m=m>>>0,!V){let ct=Math.pow(2,8*m)-1;ot(this,o,g,m,ct,0)}let Q=m-1,it=1;for(this[g+Q]=o&255;--Q>=0&&(it*=256);)this[g+Q]=o/it&255;return g+m},n.prototype.writeUint8=n.prototype.writeUInt8=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,1,255,0),this[g]=o&255,g+1},n.prototype.writeUint16LE=n.prototype.writeUInt16LE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,2,65535,0),this[g]=o&255,this[g+1]=o>>>8,g+2},n.prototype.writeUint16BE=n.prototype.writeUInt16BE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,2,65535,0),this[g]=o>>>8,this[g+1]=o&255,g+2},n.prototype.writeUint32LE=n.prototype.writeUInt32LE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,4,4294967295,0),this[g+3]=o>>>24,this[g+2]=o>>>16,this[g+1]=o>>>8,this[g]=o&255,g+4},n.prototype.writeUint32BE=n.prototype.writeUInt32BE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,4,4294967295,0),this[g]=o>>>24,this[g+1]=o>>>16,this[g+2]=o>>>8,this[g+3]=o&255,g+4};function ut(o,g,m,V,Q){$(g,V,Q,o,m,7);let it=Number(g&BigInt(4294967295));o[m++]=it,it=it>>8,o[m++]=it,it=it>>8,o[m++]=it,it=it>>8,o[m++]=it;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return o[m++]=ct,ct=ct>>8,o[m++]=ct,ct=ct>>8,o[m++]=ct,ct=ct>>8,o[m++]=ct,m}function gt(o,g,m,V,Q){$(g,V,Q,o,m,7);let it=Number(g&BigInt(4294967295));o[m+7]=it,it=it>>8,o[m+6]=it,it=it>>8,o[m+5]=it,it=it>>8,o[m+4]=it;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return o[m+3]=ct,ct=ct>>8,o[m+2]=ct,ct=ct>>8,o[m+1]=ct,ct=ct>>8,o[m]=ct,m+8}n.prototype.writeBigUInt64LE=lt(function(o,g=0){return ut(this,o,g,BigInt(0),BigInt("0xffffffffffffffff"))}),n.prototype.writeBigUInt64BE=lt(function(o,g=0){return gt(this,o,g,BigInt(0),BigInt("0xffffffffffffffff"))}),n.prototype.writeIntLE=function(o,g,m,V){if(o=+o,g=g>>>0,!V){let Et=Math.pow(2,8*m-1);ot(this,o,g,m,Et-1,-Et)}let Q=0,it=1,ct=0;for(this[g]=o&255;++Q<m&&(it*=256);)o<0&&ct===0&&this[g+Q-1]!==0&&(ct=1),this[g+Q]=(o/it>>0)-ct&255;return g+m},n.prototype.writeIntBE=function(o,g,m,V){if(o=+o,g=g>>>0,!V){let Et=Math.pow(2,8*m-1);ot(this,o,g,m,Et-1,-Et)}let Q=m-1,it=1,ct=0;for(this[g+Q]=o&255;--Q>=0&&(it*=256);)o<0&&ct===0&&this[g+Q+1]!==0&&(ct=1),this[g+Q]=(o/it>>0)-ct&255;return g+m},n.prototype.writeInt8=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,1,127,-128),o<0&&(o=255+o+1),this[g]=o&255,g+1},n.prototype.writeInt16LE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,2,32767,-32768),this[g]=o&255,this[g+1]=o>>>8,g+2},n.prototype.writeInt16BE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,2,32767,-32768),this[g]=o>>>8,this[g+1]=o&255,g+2},n.prototype.writeInt32LE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,4,2147483647,-2147483648),this[g]=o&255,this[g+1]=o>>>8,this[g+2]=o>>>16,this[g+3]=o>>>24,g+4},n.prototype.writeInt32BE=function(o,g,m){return o=+o,g=g>>>0,m||ot(this,o,g,4,2147483647,-2147483648),o<0&&(o=4294967295+o+1),this[g]=o>>>24,this[g+1]=o>>>16,this[g+2]=o>>>8,this[g+3]=o&255,g+4},n.prototype.writeBigInt64LE=lt(function(o,g=0){return ut(this,o,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),n.prototype.writeBigInt64BE=lt(function(o,g=0){return gt(this,o,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function rt(o,g,m,V,Q,it){if(m+V>o.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function ht(o,g,m,V,Q){return g=+g,m=m>>>0,Q||rt(o,g,m,4),r.write(o,g,m,V,23,4),m+4}n.prototype.writeFloatLE=function(o,g,m){return ht(this,o,g,!0,m)},n.prototype.writeFloatBE=function(o,g,m){return ht(this,o,g,!1,m)};function mt(o,g,m,V,Q){return g=+g,m=m>>>0,Q||rt(o,g,m,8),r.write(o,g,m,V,52,8),m+8}n.prototype.writeDoubleLE=function(o,g,m){return mt(this,o,g,!0,m)},n.prototype.writeDoubleBE=function(o,g,m){return mt(this,o,g,!1,m)},n.prototype.copy=function(o,g,m,V){if(!n.isBuffer(o))throw new TypeError("argument should be a Buffer");if(m||(m=0),!V&&V!==0&&(V=this.length),g>=o.length&&(g=o.length),g||(g=0),V>0&&V<m&&(V=m),V===m||o.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("sourceEnd out of bounds");V>this.length&&(V=this.length),o.length-g<V-m&&(V=o.length-g+m);let Q=V-m;return this===o&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(g,m,V):Uint8Array.prototype.set.call(o,this.subarray(m,V),g),Q},n.prototype.fill=function(o,g,m,V){if(typeof o=="string"){if(typeof g=="string"?(V=g,g=0,m=this.length):typeof m=="string"&&(V=m,m=this.length),V!==void 0&&typeof V!="string")throw new TypeError("encoding must be a string");if(typeof V=="string"&&!n.isEncoding(V))throw new TypeError("Unknown encoding: "+V);if(o.length===1){let it=o.charCodeAt(0);(V==="utf8"&&it<128||V==="latin1")&&(o=it)}}else typeof o=="number"?o=o&255:typeof o=="boolean"&&(o=Number(o));if(g<0||this.length<g||this.length<m)throw new RangeError("Out of range index");if(m<=g)return this;g=g>>>0,m=m===void 0?this.length:m>>>0,o||(o=0);let Q;if(typeof o=="number")for(Q=g;Q<m;++Q)this[Q]=o;else{let it=n.isBuffer(o)?o:n.from(o,V),ct=it.length;if(ct===0)throw new TypeError('The value "'+o+'" is invalid for argument "value"');for(Q=0;Q<m-g;++Q)this[Q+g]=it[Q%ct]}return this};var dt={};function wt(o,g,m){dt[o]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(V){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:V,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}wt("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),wt("ERR_INVALID_ARG_TYPE",function(o,g){return`The "${o}" argument must be of type number. Received type ${typeof g}`},TypeError),wt("ERR_OUT_OF_RANGE",function(o,g,m){let V=`The value of "${o}" is out of range.`,Q=m;return Number.isInteger(m)&&Math.abs(m)>2**32?Q=St(String(m)):typeof m=="bigint"&&(Q=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(Q=St(Q)),Q+="n"),V+=` It must be ${g}. Received ${Q}`,V},RangeError);function St(o){let g="",m=o.length,V=o[0]==="-"?1:0;for(;m>=V+4;m-=3)g=`_${o.slice(m-3,m)}${g}`;return`${o.slice(0,m)}${g}`}function N(o,g,m){M(g,"offset"),(o[g]===void 0||o[g+m]===void 0)&&X(g,o.length-(m+1))}function $(o,g,m,V,Q,it){if(o>m||o<g){let ct=typeof g=="bigint"?"n":"",Et;throw it>3?g===0||g===BigInt(0)?Et=`>= 0${ct} and < 2${ct} ** ${(it+1)*8}${ct}`:Et=`>= -(2${ct} ** ${(it+1)*8-1}${ct}) and < 2 ** ${(it+1)*8-1}${ct}`:Et=`>= ${g}${ct} and <= ${m}${ct}`,new dt.ERR_OUT_OF_RANGE("value",Et,o)}N(V,Q,it)}function M(o,g){if(typeof o!="number")throw new dt.ERR_INVALID_ARG_TYPE(g,"number",o)}function X(o,g,m){throw Math.floor(o)!==o?(M(o,m),new dt.ERR_OUT_OF_RANGE(m||"offset","an integer",o)):g<0?new dt.ERR_BUFFER_OUT_OF_BOUNDS:new dt.ERR_OUT_OF_RANGE(m||"offset",`>= ${m?1:0} and <= ${g}`,o)}var H=/[^+/0-9A-Za-z-_]/g;function s(o){if(o=o.split("=")[0],o=o.trim().replace(H,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function h(o,g){g=g||1/0;let m,V=o.length,Q=null,it=[];for(let ct=0;ct<V;++ct){if(m=o.charCodeAt(ct),m>55295&&m<57344){if(!Q){if(m>56319){(g-=3)>-1&&it.push(239,191,189);continue}else if(ct+1===V){(g-=3)>-1&&it.push(239,191,189);continue}Q=m;continue}if(m<56320){(g-=3)>-1&&it.push(239,191,189),Q=m;continue}m=(Q-55296<<10|m-56320)+65536}else Q&&(g-=3)>-1&&it.push(239,191,189);if(Q=null,m<128){if((g-=1)<0)break;it.push(m)}else if(m<2048){if((g-=2)<0)break;it.push(m>>6|192,m&63|128)}else if(m<65536){if((g-=3)<0)break;it.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((g-=4)<0)break;it.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return it}function d(o){let g=[];for(let m=0;m<o.length;++m)g.push(o.charCodeAt(m)&255);return g}function A(o,g){let m,V,Q,it=[];for(let ct=0;ct<o.length&&!((g-=2)<0);++ct)m=o.charCodeAt(ct),V=m>>8,Q=m%256,it.push(Q),it.push(V);return it}function R(o){return e.toByteArray(s(o))}function f(o,g,m,V){let Q;for(Q=0;Q<V&&!(Q+m>=g.length||Q>=o.length);++Q)g[Q+m]=o[Q];return Q}function _(o,g){return o instanceof g||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===g.name}function D(o){return o!==o}var Y=function(){let o="0123456789abcdef",g=new Array(256);for(let m=0;m<16;++m){let V=m*16;for(let Q=0;Q<16;++Q)g[V+Q]=o[m]+o[Q]}return g}();function lt(o){return typeof BigInt>"u"?ft:o}function ft(){throw new Error("BigInt not supported")}}),Mo=qt((t,e)=>{typeof window<"u"?(window.global=window,Yt.fetch=window.fetch,e.exports={Buffer:He().Buffer,Crypto:window.crypto}):e.exports={Buffer:He().Buffer,Crypto:crypto}}),Cn={};Bo(Cn,{AVSCTap:()=>Oe,ArweaveSigner:()=>ur,DataItem:()=>xe,MAX_TAG_BYTES:()=>hr,MIN_BINARY_SIZE:()=>Rn,SIG_CONFIG:()=>me,SignatureConfig:()=>Ut,Signer:()=>jo,createData:()=>Un,deserializeTags:()=>Je,indexToType:()=>Ln,serializeTags:()=>Bn,tagsExceedLimit:()=>Nn});var jo=class{constructor(){j(this,"signer");j(this,"publicKey");j(this,"signatureType");j(this,"signatureLength");j(this,"ownerLength");j(this,"pem")}static verify(t,e,r,i){throw new Error("You must implement verify method on child")}},Do=re(cr(),1),Mt=re(An(),1);async function In(t){if(Array.isArray(t)){let a=(0,Mt.concatBuffers)([(0,Mt.stringToBuffer)("list"),(0,Mt.stringToBuffer)(t.length.toString())]);return await On(t,await Vt().hash(a,"SHA-384"))}let e=t,r=(0,Mt.concatBuffers)([(0,Mt.stringToBuffer)("blob"),(0,Mt.stringToBuffer)(e.byteLength.toString())]),i=(0,Mt.concatBuffers)([await Vt().hash(r,"SHA-384"),await Vt().hash(e,"SHA-384")]);return await Vt().hash(i,"SHA-384")}async function On(t,e){if(t.length<1)return e;let r=(0,Mt.concatBuffers)([e,await In(t[0])]),i=await Vt().hash(r,"SHA-384");return await On(t.slice(1),i)}var We=re($o(),1),Ko=We.default.default?We.default.default:We.default,Wo=class extends Ko{getPublicKey(t){throw new Error("Unimplemented")}},Fo;function Vt(){return Fo??(Fo=new Wo)}var Ut;(function(t){t[t.ARWEAVE=1]="ARWEAVE",t[t.ED25519=2]="ED25519",t[t.ETHEREUM=3]="ETHEREUM",t[t.SOLANA=4]="SOLANA",t[t.INJECTEDAPTOS=5]="INJECTEDAPTOS",t[t.MULTIAPTOS=6]="MULTIAPTOS",t[t.TYPEDETHEREUM=7]="TYPEDETHEREUM"})(Ut||(Ut={}));var me={[Ut.ARWEAVE]:{sigLength:512,pubLength:512,sigName:"arweave"},[Ut.ED25519]:{sigLength:64,pubLength:32,sigName:"ed25519"},[Ut.ETHEREUM]:{sigLength:65,pubLength:65,sigName:"ethereum"},[Ut.SOLANA]:{sigLength:64,pubLength:32,sigName:"solana"},[Ut.INJECTEDAPTOS]:{sigLength:64,pubLength:32,sigName:"injectedAptos"},[Ut.MULTIAPTOS]:{sigLength:64*32+4,pubLength:32*32+1,sigName:"multiAptos"},[Ut.TYPEDETHEREUM]:{sigLength:65,pubLength:42,sigName:"typedEthereum"}},ur=class{constructor(t){j(this,"signatureType",1);j(this,"ownerLength",me[1].pubLength);j(this,"signatureLength",me[1].sigLength);j(this,"jwk");j(this,"pk");this.pk=t.n,this.jwk=t}get publicKey(){return Do.default.toBuffer(this.pk)}sign(t){return Vt().sign(this.jwk,t)}static async verify(t,e,r){return await Vt().verify(t,e,r)}},Ln={1:ur},Dt=re(cr(),1);async function ze(t){return In([(0,Mt.stringToBuffer)("dataitem"),(0,Mt.stringToBuffer)("1"),(0,Mt.stringToBuffer)(t.signatureType.toString()),t.rawOwner,t.rawTarget,t.rawAnchor,t.rawTags,t.rawData])}async function Vo(t,e){let r=await ze(t),i=await e.sign(r),a=await Vt().hash(i);return{signature:Ct.Buffer.from(i),id:Ct.Buffer.from(a)}}async function Go(t,e){let{signature:r,id:i}=await Vo(t,e);return t.getRaw().set(r,2),i}var Oe=class{constructor(t=Ct.Buffer.alloc(hr),e=0){j(this,"buf");j(this,"pos");this.buf=t,this.pos=e}writeTags(t){if(!Array.isArray(t))throw new Error("input must be array");let e=t.length,r;if(e)for(this.writeLong(e),r=0;r<e;r++){let i=t[r];if((i==null?void 0:i.name)===void 0||(i==null?void 0:i.value)===void 0)throw new Error(`Invalid tag format for ${i}, expected {name:string, value: string}`);this.writeString(i.name),this.writeString(i.value)}this.writeLong(0)}toBuffer(){let t=Ct.Buffer.alloc(this.pos);if(this.pos>this.buf.length)throw new Error(`Too many tag bytes (${this.pos} > ${this.buf.length})`);return this.buf.copy(t,0,0,this.pos),t}tagsExceedLimit(){return this.pos>this.buf.length}writeLong(t){let e=this.buf,r,i;if(t>=-1073741824&&t<1073741824){i=t>=0?t<<1:~t<<1|1;do e[this.pos]=i&127,i>>=7;while(i&&(e[this.pos++]|=128))}else{r=t>=0?t*2:-t*2-1;do e[this.pos]=r&127,r/=128;while(r>=1&&(e[this.pos++]|=128))}this.pos++,this.buf=e}writeString(t){let e=Ct.Buffer.byteLength(t),r=this.buf;this.writeLong(e);let i=this.pos;if(this.pos+=e,!(this.pos>r.length)){if(e>64)this.buf.write(t,this.pos-e,e,"utf8");else{let a,c,l,n;for(a=0,c=e;a<c;a++)l=t.charCodeAt(a),l<128?r[i++]=l:l<2048?(r[i++]=l>>6|192,r[i++]=l&63|128):(l&64512)===55296&&((n=t.charCodeAt(a+1))&64512)===56320?(l=65536+((l&1023)<<10)+(n&1023),a++,r[i++]=l>>18|240,r[i++]=l>>12&63|128,r[i++]=l>>6&63|128,r[i++]=l&63|128):(r[i++]=l>>12|224,r[i++]=l>>6&63|128,r[i++]=l&63|128)}this.buf=r}}readLong(){let t=0,e=0,r=this.buf,i,a,c,l;do i=r[this.pos++],a=i&128,t|=(i&127)<<e,e+=7;while(a&&e<28);if(a){c=t,l=268435456;do i=r[this.pos++],c+=(i&127)*l,l*=128;while(i&128);return(c%2?-(c+1):c)/2}return t>>1^-(t&1)}skipLong(){let t=this.buf;for(;t[this.pos++]&128;);}readTags(){let t=[],e;for(;e=this.readLong();)for(e<0&&(e=-e,this.skipLong());e--;){let r=this.readString(),i=this.readString();t.push({name:r,value:i})}return t}readString(){let t=this.readLong(),e=this.pos,r=this.buf;if(this.pos+=t,!(this.pos>r.length))return this.buf.slice(e,e+t).toString()}};function Bn(t){let e=new Oe;return e.writeTags(t),e.toBuffer()}function Nn(t){let e=new Oe;return e.writeTags(t),e.tagsExceedLimit()}function Je(t){return new Oe(t).readTags()}function Ht(t){let e=0;for(let r=t.length-1;r>=0;r--)e=e*256+t[r];return e}function qo(t){if(t>29)throw new Error("Short too long");let e=[0,0];for(let r=0;r<e.length;r++){let i=t&255;e[r]=i,t=(t-i)/256}return Uint8Array.from(e)}function Or(t){let e=[0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++){let i=t&255;e[r]=i,t=(t-i)/256}return Uint8Array.from(e)}var Ho=re(Mo(),1),ie=re(He(),1),hr=4096,Rn=80,xe=class{constructor(t){j(this,"binary");j(this,"_id");this.binary=t}static isDataItem(t){return t.binary!==void 0}get signatureType(){let t=Ht(this.binary.subarray(0,2));if((Ut==null?void 0:Ut[t])!==void 0)return t;throw new Error("Unknown signature type: "+t)}async isValid(){return xe.verify(this.binary)}get id(){return(async()=>Dt.default.encode(await this.rawId))()}set id(t){this._id=Dt.default.toBuffer(t)}get rawId(){return(async()=>ie.Buffer.from(await Ho.Crypto.subtle.digest("SHA-256",this.rawSignature)))()}set rawId(t){this._id=t}get rawSignature(){return this.binary.subarray(2,2+this.signatureLength)}get signature(){return Dt.default.encode(this.rawSignature)}set rawOwner(t){if(t.byteLength!=this.ownerLength)throw new Error(`Expected raw owner (pubkey) to be ${this.ownerLength} bytes, got ${t.byteLength} bytes.`);this.binary.set(t,2+this.signatureLength)}get rawOwner(){return this.binary.subarray(2+this.signatureLength,2+this.signatureLength+this.ownerLength)}get signatureLength(){return me[this.signatureType].sigLength}get owner(){return Dt.default.encode(this.rawOwner)}get ownerLength(){return me[this.signatureType].pubLength}get rawTarget(){let t=this.getTargetStart();return this.binary[t]==1?this.binary.subarray(t+1,t+33):ie.Buffer.alloc(0)}get target(){return Dt.default.encode(this.rawTarget)}get rawAnchor(){let t=this.getAnchorStart();return this.binary[t]==1?this.binary.subarray(t+1,t+33):ie.Buffer.alloc(0)}get anchor(){return this.rawAnchor.toString()}get rawTags(){let t=this.getTagsStart(),e=Ht(this.binary.subarray(t+8,t+16));return this.binary.subarray(t+16,t+16+e)}get tags(){let t=this.getTagsStart();if(Ht(this.binary.subarray(t,t+8))==0)return[];let e=Ht(this.binary.subarray(t+8,t+16));return Je(ie.Buffer.from(this.binary.subarray(t+16,t+16+e)))}get tagsB64Url(){return this.tags.map(t=>({name:Dt.default.encode(t.name),value:Dt.default.encode(t.value)}))}getStartOfData(){let t=this.getTagsStart(),e=this.binary.subarray(t+8,t+16),r=Ht(e);return t+16+r}get rawData(){let t=this.getTagsStart(),e=this.binary.subarray(t+8,t+16),r=Ht(e),i=t+16+r;return this.binary.subarray(i,this.binary.length)}get data(){return Dt.default.encode(this.rawData)}getRaw(){return this.binary}async sign(t){return this._id=await Go(this,t),this.rawId}async setSignature(t){this.binary.set(t,2),this._id=ie.Buffer.from(await Vt().hash(t))}isSigned(){var t;return(((t=this._id)==null?void 0:t.length)??0)>0}toJSON(){return{signature:this.signature,owner:this.owner,target:this.target,tags:this.tags.map(t=>({name:Dt.default.encode(t.name),value:Dt.default.encode(t.value)})),data:this.data}}static async verify(t){if(t.byteLength<Rn)return!1;let e=new xe(t),r=e.signatureType,i=e.getTagsStart(),a=Ht(t.subarray(i,i+8)),c=t.subarray(i+8,i+16),l=Ht(c);if(l>hr)return!1;if(a>0)try{if(Je(ie.Buffer.from(t.subarray(i+16,i+16+l))).length!==a)return!1}catch{return!1}let n=Ln[r],p=await ze(e);return await n.verify(e.rawOwner,p,e.rawSignature)}async getSignatureData(){return ze(this)}getTagsStart(){let t=this.getTargetStart(),e=this.binary[t]==1,r=t+(e?33:1),i=this.binary[r]==1;return r+=i?33:1,r}getTargetStart(){return 2+this.signatureLength+this.ownerLength}getAnchorStart(){let t=this.getTargetStart()+1,e=this.binary[this.getTargetStart()]==1;return t+=e?32:0,t}},zo=re(cr(),1);function Un(t,e,r){var x,v;let i=e.publicKey,a=r!=null&&r.target?zo.default.toBuffer(r.target):null,c=1+((a==null?void 0:a.byteLength)??0),l=r!=null&&r.anchor?Ct.Buffer.from(r.anchor):null,n=1+((l==null?void 0:l.byteLength)??0),p=(((x=r==null?void 0:r.tags)==null?void 0:x.length)??0)>0?Bn(r.tags):null,S=16+(p?p.byteLength:0),E=Ct.Buffer.from(t),L=E.byteLength,y=2+e.signatureLength+e.ownerLength+c+n+S+L,k=Ct.Buffer.alloc(y);if(k.set(qo(e.signatureType),0),k.set(new Uint8Array(e.signatureLength).fill(0),2),i.byteLength!==e.ownerLength)throw new Error(`Owner must be ${e.ownerLength} bytes, but was incorrectly ${i.byteLength}`);k.set(i,2+e.signatureLength);let b=2+e.signatureLength+e.ownerLength;if(k[b]=a?1:0,a){if(a.byteLength!==32)throw new Error(`Target must be 32 bytes but was incorrectly ${a.byteLength}`);k.set(a,b+1)}let U=b+c,C=U+1;if(k[U]=l?1:0,l){if(C+=l.byteLength,l.byteLength!==32)throw new Error("Anchor must be 32 bytes");k.set(l,U+1)}k.set(Or(((v=r==null?void 0:r.tags)==null?void 0:v.length)??0),C);let K=Or((p==null?void 0:p.byteLength)??0);k.set(K,C+8),p&&k.set(p,C+16);let z=C+S;return k.set(E,z),new xe(k)}var Jo={...Cn};globalThis.arbundles??(globalThis.arbundles=Jo);var Qo=class{constructor(t,e){j(this,"signer");j(this,"bundlerSigner");j(this,"type");j(this,"warp");j(this,"signatureProviderType");j(this,"wallet");j(this,"cachedAddress");this.warp=t,this.isCustomSignature(e)?(this.assertEnvForCustomSigner(e.type),this.signer=e.signer,this.type=e.type,this.signatureProviderType="CustomSignature"):this.isValidBundlerSignature(e)?(this.signatureProviderType="BundlerSigner",this.type=Yo(e.signatureType),this.bundlerSigner=e):(this.assignArweaveSigner(e),this.bundlerSigner=typeof e=="string"?null:new ur(e),this.signatureProviderType="ArWallet",this.type="arweave"),this.wallet=e}async getAddress(){if(this.cachedAddress)return this.cachedAddress;switch(this.signatureProviderType){case"CustomSignature":return this.wallet.getAddress?this.cachedAddress=await this.wallet.getAddress():this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"ArWallet":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"BundlerSigner":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;default:throw Error("Unknown Signature::signatureProvider : "+this.signatureProviderType)}}async deduceSignerBySigning(){let{arweave:t}=this.warp;if(this.signatureProviderType=="BundlerSigner")try{return await this.bundlerSigner.getAddress()}catch{throw new Error("Could not get address from the signer. Is the 'getAddress' implementation correct?'")}else if(this.signatureProviderType=="ArWallet"||this.signatureProviderType=="CustomSignature"){let e=await t.createTransaction({data:Math.random().toString().slice(-4),reward:"72600854",last_tx:"p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"});return await this.signer(e),t.wallets.ownerToAddress(e.owner)}else throw Error("Unknown Signature::type")}checkNonArweaveSigningAvailability(t){if(this.type!=="arweave"&&!t)throw new Error(`Unable to use signing function of type: ${this.type} when bundling is disabled.`)}checkBundlerSignerAvailability(t){if((!t||this.warp.environment=="local")&&this.signatureProviderType=="BundlerSigner")throw new Error("Only wallet of type 'ArWallet' or 'CustomSignature' is allowed when bundling is disabled or in local environment.")}assignArweaveSigner(t){this.signer=async e=>{await this.warp.arweave.transactions.sign(e,t)}}assertEnvForCustomSigner(t){if(this.warp.interactionsLoader.type()==="warp")throw new Error("Unable to use signing function when bundling is enabled.");if(t=="ethereum")throw new Error(`Unable to use signing function with signature of type: ${t}.`)}isCustomSignature(t){return t.signer!==void 0&&t.type!==void 0}isValidBundlerSignature(t){let e=t,r=!!e.signatureType&&!!e.ownerLength&&!!e.signatureLength;if(r&&!e.publicKey)throw new Error("It seems that you are using BundlerSigner, but publicKey is not set! Maybe try calling await bundlerSigner.setPublicKey() before using it.");return r}};function Yo(t){if(t===3)return"ethereum";if(t===1)return"arweave";throw Error(`Not supported arbundle SignatureType : ${t}`)}at();var Xo=class{constructor(t,e){j(this,"rootOptions");j(this,"saferEvaluationOptions",{internalWrites:t=>{if(t.internalWrites===void 0||this.rootOptions.internalWrites==t.internalWrites)return this.rootOptions.internalWrites;if(this.rootOptions.internalWrites&&!t.internalWrites||!this.rootOptions.internalWrites&&t.internalWrites)return t.internalWrites;throw new Error('Could not determine "internalWrites" value ')},throwOnInternalWriteError:t=>t.throwOnInternalWriteError===void 0?this.rootOptions.throwOnInternalWriteError:t.throwOnInternalWriteError,unsafeClient:t=>{if(t.unsafeClient===void 0||this.rootOptions.unsafeClient==t.unsafeClient)return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="throw"||this.rootOptions.unsafeClient==="skip")return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="allow")return t.unsafeClient==="throw"?"skip":t.unsafeClient;throw new Error('Could not determine "unsafeClient" value')},ignoreExceptions:t=>{if(t.ignoreExceptions===void 0||this.rootOptions.ignoreExceptions==t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(this.rootOptions.ignoreExceptions&&!t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(!this.rootOptions.ignoreExceptions&&t.ignoreExceptions)return this.rootOptions.ignoreExceptions;throw new Error('Could not determine "ignoreExceptions" value')},waitForConfirmation:()=>this.rootOptions.waitForConfirmation,updateCacheForEachInteraction:()=>this.rootOptions.updateCacheForEachInteraction,maxCallDepth:()=>this.rootOptions.maxCallDepth,maxInteractionEvaluationTimeSeconds:()=>this.rootOptions.maxInteractionEvaluationTimeSeconds,stackTrace:()=>this.rootOptions.stackTrace,sourceType:()=>this.rootOptions.sourceType,sequencerUrl:()=>this.rootOptions.sequencerUrl,gasLimit:()=>this.rootOptions.gasLimit,allowBigInt:()=>this.rootOptions.allowBigInt,walletBalanceUrl:()=>this.rootOptions.walletBalanceUrl,mineArLocalBlocks:()=>this.rootOptions.mineArLocalBlocks,cacheEveryNInteractions:()=>this.rootOptions.cacheEveryNInteractions,remoteStateSyncEnabled:()=>this.rootOptions.remoteStateSyncEnabled,remoteStateSyncSource:()=>this.rootOptions.remoteStateSyncSource,useKVStorage:t=>t.useKVStorage,useConstructor:t=>t.useConstructor,whitelistSources:()=>this.rootOptions.whitelistSources});j(this,"notConflictingEvaluationOptions",["useKVStorage","sourceType","useConstructor"]);if(e){let r=[];for(let i in e){if(!t.hasOwnProperty(i))throw new Error("Unknown option set in contract's manifest. You probably need to update the Warp SDK version.");let a=i,c=e[i],l=t[i];if(!this.notConflictingEvaluationOptions.includes(a))if(a==="internalWrites"){if(l===!1&&c===!0)throw new Error("Cannot proceed with contract evaluation. User is blocking internal writes, while contract requires them.")}else if(a==="unsafeClient"){if(l==="throw"&&c!=="throw"||l==="skip"&&c==="allow")throw new Error(`Cannot proceed with contract evaluation. User requires to ${l} on any unsafeClient usage, while contract uses ${c} option.`)}else t[i]!==e[i]&&r.push(`Option {${i}} differs. EvaluationOptions: [${t[i]}], manifest: [${e[i]}]. Use contract.setEvaluationOptions({${i}: ${e[i]}}) to evaluate contract state.`)}if(r.length)throw new Error(r.join(`
`))}this.rootOptions=Object.freeze(Object.assign({},t,e||{}))}forForeignContract(t){let e=Te(this.rootOptions);if(t)for(let r in t)e[r]=this.saferEvaluationOptions[r](t);return Object.freeze(e)}};at();var Zo=class{constructor(t){j(this,"name","WarpFetchWrapper");j(this,"logger",xt.INST.create(this.name));this.warp=t,this.warp=t}fetch(t,e){let r;if(this.warp.hasPlugin("fetch-options")){let i=this.warp.loadPlugin("fetch-options");try{let a=i.process({input:t,init:e||{}});r={...e,...a}}catch(a){throw a.message&&this.logger.error(a.message),new Error(`Unable to process fetch options: ${a.message}`)}}else r=e;return fetch(t,r)}};at();var ts=new Error("request for lock canceled"),es=function(t,e,r,i){function a(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function n(E){try{S(i.next(E))}catch(L){l(L)}}function p(E){try{S(i.throw(E))}catch(L){l(L)}}function S(E){E.done?c(E.value):a(E.value).then(n,p)}S((i=i.apply(t,e||[])).next())})},rs=class{constructor(t,e=ts){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()})}runExclusive(t,e=1){return es(this,void 0,void 0,function*(){let[r,i]=yield this.acquire(e);try{return yield t(r)}finally{i()}})}waitForUnlock(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise(e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach(t=>t.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){let r=(t=this._weightedQueues[e-1])===null||t===void 0?void 0:t.shift();if(!r)continue;let i=this._value,a=e;this._value-=e,e=this._value+1,r.resolve([i,this._newReleaser(a)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach(e=>e()),this._weightedWaiters[t-1]=[])}},ns=function(t,e,r,i){function a(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function n(E){try{S(i.next(E))}catch(L){l(L)}}function p(E){try{S(i.throw(E))}catch(L){l(L)}}function S(E){E.done?c(E.value):a(E.value).then(n,p)}S((i=i.apply(t,e||[])).next())})},is=class{constructor(t){this._semaphore=new rs(1,t)}acquire(){return ns(this,void 0,void 0,function*(){let[,t]=yield this._semaphore.acquire();return t})}runExclusive(t){return this._semaphore.runExclusive(()=>t())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};at();at();var as=class{constructor(t){j(this,"cache");j(this,"capacity");this.cache=new Map,this.capacity=t||10}has(t){return this.cache.has(t)}size(){return this.cache.size}get(t){if(!this.cache.has(t))return null;let e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){this.cache.delete(t),this.cache.size===this.capacity?(this.cache.delete(this.cache.keys().next().value),this.cache.set(t,e)):this.cache.set(t,e)}keys(){return Array.from(this.cache.keys())}},Lr=class{constructor(t){j(this,"_json",new Map);j(this,"_initialJson",new Map);j(this,"_kv",new Map);this._warp=t}has(t,e){var r;return((r=this._json.get(t))==null?void 0:r.has(e))||!1}get(t,e){var r;return((r=this._json.get(t))==null?void 0:r.get(e))||null}getLessOrEqual(t,e){let r=this._json.get(t);if(r!=null&&r.size()>0){let i=r.keys();e&&(i=i.filter(c=>c.localeCompare(e)<=0)),i=i.sort((c,l)=>c.localeCompare(l));let a=i[i.length-1];if(r.get(a))return new Pt(a,r.get(a))}return null}async getKV(t,e){var r;return this._kv.has(t)&&((r=await this._kv.get(t).get(e))==null?void 0:r.cachedValue)||null}async delKV(t,e){this._kv.has(t)&&await this._kv.get(t).del(e)}getKvKeys(t,e,r){return this._warp.kvStorageFactory(t).keys(e,r)}getKvRange(t,e,r){return this._warp.kvStorageFactory(t).kvMap(e,r)}async commit(t,e=!1){if(t.dry)return await this.rollbackKVs(),this.reset();try{let r=new Map;this._json.forEach((i,a)=>{let c=this.getLessOrEqual(a,t.sortKey);c!=null&&r.set(a,c.cachedValue)}),await this.doStoreJson(r,t,e),await this.commitKVs()}finally{this.reset()}}async commitKV(){await this.commitKVs(),this._kv.clear()}async rollback(t,e){try{await this.doStoreJson(this._initialJson,t,e),await this.rollbackKVs()}finally{this.reset()}}setInitial(t,e,r){this._initialJson.set(t,e),this.update(t,e,r)}update(t,e,r){if(!this._json.has(t)){let i=new as(10);this._json.set(t,i)}this._json.get(t).set(r,e)}async updateKV(t,e,r){await(await this.getOrInitKvStorage(t)).put(e,r)}async getOrInitKvStorage(t){if(this._kv.has(t))return this._kv.get(t);let e=this._warp.kvStorageFactory(t);return this._kv.set(t,e),await e.open(),e}reset(){this._json.clear(),this._initialJson.clear(),this._kv.clear()}async doStoreJson(t,e,r=!1){if(t.size>1||r)for(let[i,a]of t)await this._warp.stateEvaluator.putInCache(i,e,a)}async rollbackKVs(){for(let t of this._kv.values())try{await t.rollback()}finally{await t.close()}}async commitKVs(){for(let t of this._kv.values())try{await t.commit()}finally{await t.close()}}},os=Lt(te()),$n=class{constructor(t,e,r=null,i=null){j(this,"logger",xt.INST.create("HandlerBasedContract"));j(this,"ecLogger",xt.INST.create("ExecutionContext"));j(this,"_innerWritesEvaluator",new ko);j(this,"_callDepth");j(this,"_arweaveWrapper");j(this,"_mutex",new is);j(this,"_callStack");j(this,"_evaluationOptions");j(this,"_eoEvaluator");j(this,"_benchmarkStats",null);j(this,"_sorter");j(this,"_rootSortKey");j(this,"_signature");j(this,"_warpFetchWrapper");j(this,"_children",[]);j(this,"_interactionState");j(this,"_dreStates",new Map);var a,c;if(this._contractTxId=t,this.warp=e,this._parentContract=r,this._innerCallData=i,this.waitForConfirmation=this.waitForConfirmation.bind(this),this._arweaveWrapper=new le(e),this._sorter=new ar(e.arweave),r!=null){this._evaluationOptions=this.getRoot().evaluationOptions(),this._callDepth=r.callDepth()+1;let l=r.getCallStack().getInteraction(i.callingInteraction.id);if(this._callDepth>this._evaluationOptions.maxCallDepth)throw new Error(`Max call depth of ${this._evaluationOptions.maxCallDepth} has been exceeded for interaction ${JSON.stringify(l.interactionInput)}`);if(this.logger.debug("Calling interaction",{id:i.callingInteraction.id,sortKey:i.callingInteraction.sortKey,type:i.callType}),((c=(a=l.interactionInput)==null?void 0:a.foreignContractCalls[t])==null?void 0:c.innerCallType)==="write"&&i.callType==="read")throw new Error("Calling a readContractState after performing an inner write is wrong - instead use a state from the result of an internal write.");let n=new De(t,this._callDepth,i==null?void 0:i.callType);l.interactionInput.foreignContractCalls[t]=n,this._callStack=n,this._rootSortKey=r.rootSortKey,r._children.push(this)}else this._callDepth=0,this._callStack=new De(t,0),this._rootSortKey=null,this._evaluationOptions=new La,this._children=[],this._interactionState=new Lr(e);this.getCallStack=this.getCallStack.bind(this),this._warpFetchWrapper=new Zo(this.warp)}async readState(t,e,r){var l,n,p;if(this.logger.info("Read state for",{contractTxId:this._contractTxId,sortKeyOrBlockHeight:t}),!this.isRoot()&&t==null)throw new Error("SortKey MUST be always set for non-root contract calls");let{stateEvaluator:i}=this.warp,a=typeof t=="number"?this._sorter.generateLastSortKey(t):t;if(a&&!this.isRoot()&&this.interactionState().has(this.txId(),a)){let S=this.interactionState().get(this.txId(),a);return new Pt(a,S)}let c=await this._mutex.acquire();try{let S=It.measure();this.maybeResetRootContract();let E=await this.createExecutionContext(this._contractTxId,a,!1,r);this.logger.info("Execution Context",{srcTxId:(l=E.contractDefinition)==null?void 0:l.srcTxId,missingInteractions:(n=E.sortedInteractions)==null?void 0:n.length,cachedSortKey:(p=E.cachedState)==null?void 0:p.sortKey}),S.stop();let L=It.measure(),y=await i.eval(E);L.stop();let k=S.elapsed(!0)+L.elapsed(!0);return this._benchmarkStats={gatewayCommunication:S.elapsed(!0),stateEvaluation:L.elapsed(!0),total:k},this.logger.info("Benchmark",{"Gateway communication  ":S.elapsed(),"Contract evaluation    ":L.elapsed(),"Total:                 ":`${k.toFixed(0)}ms`}),a&&!this.isRoot()&&this.interactionState().update(this.txId(),y.cachedValue,a),y}finally{c()}}async readStateFor(t,e){return this.readState(t,void 0,e)}async viewState(t,e=[],r=ne,i){return this.logger.info("View state for",this._contractTxId),await this.callContract(t,"view",i,void 0,e,r)}async viewStateForTx(t,e){return this.logger.info(`View state for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"view")}async dryWrite(t,e,r,i,a){return this.logger.info("Dry-write for",this._contractTxId),await this.callContract(t,"write",e,void 0,r,i,void 0,a)}async applyInput(t,e){return this.logger.info(`Apply-input from transaction ${e.id} for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"write")}async writeInteraction(t,e){if(this.logger.info("Write interaction",{input:t,options:e}),!this._signature)throw new Error("Wallet not connected. Use 'connect' method first.");let{arweave:r,interactionsLoader:i,environment:a}=this.warp;await this.warp.definitionLoader.load(this._contractTxId);let c=(e==null?void 0:e.tags)||[],l=(e==null?void 0:e.transfer)||ne,n=(e==null?void 0:e.strict)===!0,p=(e==null?void 0:e.vrf)===!0,S=(e==null?void 0:e.disableBundling)===!0,E=e==null?void 0:e.reward,L=i.type()=="warp"&&!S;if(this._signature.checkNonArweaveSigningAvailability(L),this._signature.checkBundlerSignerAvailability(L),L&&l.target!=ne.target&&l.winstonQty!=ne.winstonQty)throw new Error("Ar Transfers are not allowed for bundled interactions");if(p&&!L&&a==="mainnet")throw new Error("Vrf generation is only available for bundle interaction");if(!t)throw new Error(`Input should be a truthy value: ${JSON.stringify(t)}`);if(L)return await this.bundleInteraction(t,{tags:c,strict:n,vrf:p});{let y=await this.createInteraction(t,c,l,n,!1,p&&a!=="mainnet",E),k=await r.transactions.post(y);if(k.status!==200)return this.logger.error("Error while posting transaction",k),null;if(this._evaluationOptions.waitForConfirmation){this.logger.info("Waiting for confirmation of",y.id);let b=It.measure();await this.waitForConfirmation(y.id),this.logger.info("Transaction confirmed after",b.elapsed())}return this.warp.environment=="local"&&this._evaluationOptions.mineArLocalBlocks&&await this.warp.testing.mineBlock(),{originalTxId:y.id,interactionTx:y}}}async bundleInteraction(t,e){this.logger.info("Bundle interaction input",t);let r=await this.createInteractionDataItem(t,e.tags,ne,e.strict,e.vrf),i=this._warpFetchWrapper.fetch(`${we(this._evaluationOptions.sequencerUrl)}/gateway/v2/sequencer/register`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Accept:"application/json"},body:r.getRaw()}),a=await r.id;return{bundlrResponse:await Zt(i),originalTxId:a,interactionTx:r}}async createInteractionDataItem(t,e,r,i,a=!1){var S;this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,a),a&&e.push(new $t(_t.REQUEST_VRF,"true"));let c=xn(this._contractTxId,t,this.warp.environment==="testnet",e);if(Nn(c))throw new Error("Interaction tags exceed limit of 4096 bytes.");let l=Math.random().toString().slice(-4),n=this._signature.bundlerSigner;if(!n)throw new Error("Signer not set correctly. If you connect wallet through 'use_wallet', please remember that it only works when bundling is disabled.");let p;return or()&&((S=n.signer)!=null&&S.signDataItem)?p=await n.signDataItem(l,c):(p=Un(l,n,{tags:c}),await p.sign(n)),!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(p.owner,t,e,r,i,a),p}async createInteraction(t,e,r,i,a=!1,c=!1,l){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,c),c&&e.push(new $t(_t.REQUEST_VRF,"true"));let n=await Ir(this.warp.arweave,this._signature.signer,this._contractTxId,t,e,r.target,r.winstonQty,a,this.warp.environment==="testnet",l);return!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(n.owner,t,e,r,i,c),n}async checkInteractionInStrictMode(t,e,r,i,a,c){let{arweave:l}=this.warp,n=this._signature.type=="arweave"?await l.wallets.ownerToAddress(t):await this._signature.getAddress(),p=await this.callContract(e,"write",n,void 0,r,i,a,c);if(p.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(p.error||p.errorMessage))}txId(){return this._contractTxId}getCallStack(){return this._callStack}connect(t){return this._signature=new Qo(this.warp,t),this}setEvaluationOptions(t){if(!this.isRoot())throw new Error("Evaluation options can be set only for the root contract");return this._evaluationOptions={...this._evaluationOptions,...t},this}async waitForConfirmation(t){let{arweave:e}=this.warp,r=await e.transactions.getStatus(t);return r.confirmed===null?(this.logger.info(`Transaction ${t} not yet confirmed. Waiting another 20 seconds before next check.`),await un(2e4),this.waitForConfirmation(t)):(this.logger.info(`Transaction ${t} confirmed`,r),r)}async createExecutionContext(t,e,r=!1,i){var U,C,K,z;let{definitionLoader:a,interactionsLoader:c,stateEvaluator:l}=this.warp,n,p=It.measure();this.isRoot()||(n=this.interactionState().getLessOrEqual(this.txId(),e)),n=n||await l.latestAvailableState(t,e),this.logger.debug("cache lookup",p.elapsed()),p.reset();let S=Se.evolvedSrcTxId((U=n==null?void 0:n.cachedValue)==null?void 0:U.state),E,L,y,k,b=i||[];if(this.logger.debug("Cached state",n,e),n&&n.sortKey==e)this.logger.debug("State fully cached, not loading interactions."),(r||S||i!=null&&i.length)&&(L=await a.load(t,S),i!=null&&i.length&&(b=(await this._sorter.sort(i.map(x=>({node:x,cursor:null})))).map(x=>x.node)));else{if(i!=null&&i.length)throw new Error(`Cannot apply requested interactions at ${e}`);if(L=await a.load(t,S),y=this.resolveEvaluationOptions((C=L.manifest)==null?void 0:C.evaluationOptions),y.remoteStateSyncEnabled&&!y.useKVStorage){k=await this.getRemoteContractState(t),n=await this.maybeSyncStateWithRemoteSource(k,e,n);let x=Se.evolvedSrcTxId((K=n==null?void 0:n.cachedValue)==null?void 0:K.state);x&&x!==L.srcTxId&&(L=await a.load(t,x))}this.warp.executorFactory.checkWhiteListContractSources(L,y),!k&&b.length==0&&(b=await c.load(t,n==null?void 0:n.sortKey,this.getToSortKey(e),y)),n!=null&&n.sortKey&&(b=b.filter(x=>x.sortKey.localeCompare(n==null?void 0:n.sortKey)>0)),e&&(b=b.filter(x=>x.sortKey.localeCompare(e)<=0)),this.logger.debug("contract and interactions load",p.elapsed()),this.isRoot()&&b.length&&(this._rootSortKey=b[b.length-1].sortKey)}return L&&(y||(y=this.resolveEvaluationOptions((z=L.manifest)==null?void 0:z.evaluationOptions)),this.ecLogger.debug(`Evaluation options ${t}:`,y),E=await this.warp.executorFactory.create(L,y,this.warp,this.interactionState())),{warp:this.warp,contract:this,contractDefinition:L,sortedInteractions:b,evaluationOptions:y||this.evaluationOptions(),handler:E,cachedState:n,requestedSortKey:e}}resolveEvaluationOptions(t){return this.isRoot()?(this._eoEvaluator=new Xo(this.evaluationOptions(),t),this._eoEvaluator.rootOptions):this.getRootEoEvaluator().forForeignContract(t)}async getRemoteContractState(t){if(this.hasDreState(t))return this.getDreState(t);{let e=await this.fetchRemoteContractState(t);return e!=null?this.setDREState(t,e):null}}async fetchRemoteContractState(t){return Zt(this._warpFetchWrapper.fetch(`${this._evaluationOptions.remoteStateSyncSource}?id=${t}&events=false`))}getToSortKey(t){var e;return(e=this._parentContract)!=null&&e.rootSortKey?t?this._parentContract.rootSortKey.localeCompare(t)>0?this._parentContract.rootSortKey:t:this._parentContract.rootSortKey:t}async createExecutionContextFromTx(t,e){let r=e.owner.address,i=e.sortKey;return{...await this.createExecutionContext(t,i,!0),caller:r}}maybeResetRootContract(){this.isRoot()&&(this.logger.debug("Clearing call stack for the root contract"),this._callStack=new De(this.txId(),0),this._rootSortKey=null,this.warp.interactionsLoader.clearCache(),this._children=[],this._interactionState=new Lr(this.warp),this._dreStates=new Map)}async callContract(t,e,r,i,a=[],c=ne,l=!1,n=!1,p=!0){var x;this.logger.info("Call contract input",t),this.maybeResetRootContract(),this._signature||this.logger.warn("Wallet not set.");let{arweave:S,stateEvaluator:E}=this.warp,L=await this.createExecutionContext(this._contractTxId,i,!0),y=this.warp.environment=="mainnet"&&this.warp.interactionsLoader.type()!=="arweave"?await this._arweaveWrapper.warpGwBlock():await S.blocks.getCurrent(),k;r?k=r:this._signature?k=await this._signature.getAddress():k="",this.logger.info("effectiveCaller",k),L={...L,caller:k};let b=await E.eval(L);this.logger.info("Current state",b.cachedValue.state);let U={input:t,caller:L.caller,interactionType:e};this.logger.debug("interaction",U);let C=await Ir(S,p?(x=this._signature)==null?void 0:x.signer:void 0,this._contractTxId,t,a,c.target,c.winstonQty,!0,this.warp.environment==="testnet"),K=xo(C,L.caller,y);if(this.logger.debug("Creating sortKey for",{blockId:K.block.id,id:K.id,height:K.block.height}),K.sortKey=await this._sorter.createSortKey(K.block.id,K.id,K.block.height,!0),K.strict=l,n){let v=this.warp.maybeLoadPlugin("vrf");v?K.vrf=v.process().generateMockVrf(K.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}let z=await this.evalInteraction({interaction:U,interactionTx:K},L,b.cachedValue);return z.type!=="ok"&&this.logger.fatal("Error while interacting with contract",{type:z.type,error:z.errorMessage}),z}async doApplyInputOnTx(t,e,r){this.maybeResetRootContract();let i,a=await this.createExecutionContextFromTx(this._contractTxId,e);!this.isRoot()&&this.interactionState().has(this.txId(),e.sortKey)?i=new Pt(e.sortKey,this.interactionState().get(this.txId(),e.sortKey)):(i=await this.warp.stateEvaluator.eval(a),this.interactionState().update(this.txId(),i.cachedValue,e.sortKey)),this.logger.debug("callContractForTx - evalStateResult",{result:i.cachedValue.state,txId:this._contractTxId});let c={interaction:{input:t,caller:this._parentContract.txId(),interactionType:r},interactionTx:e},l=await this.evalInteraction(c,a,i.cachedValue);return l.originalValidity=i.cachedValue.validity,l.originalErrorMessages=i.cachedValue.errorMessages,l}async evalInteraction(t,e,r){let i=this.getCallStack().addInteractionData(t),a=It.measure();await e.handler.initState(r.state);let c=await e.handler.handle(e,r,t);return i.update({cacheHit:!1,outputState:this._evaluationOptions.stackTrace.saveState?c.state:void 0,executionTime:a.elapsed(!0),valid:c.type==="ok",errorMessage:c.errorMessage,gasUsed:c.gasUsed}),c}parent(){return this._parentContract}callDepth(){return this._callDepth}evaluationOptions(){return this._evaluationOptions}lastReadStateStats(){return this._benchmarkStats}async stateHash(t){let e=So(t),r=await os.Crypto.subtle.digest("SHA-256",Ct.Buffer.from(e,"utf-8"));return Ct.Buffer.from(r).toString("hex")}async syncState(t,e){let{stateEvaluator:r}=this.warp,i=await this._warpFetchWrapper.fetch(`${t}?${new URLSearchParams({id:this._contractTxId,...e})}`).then(a=>a.ok?a.json():Promise.reject(a)).catch(a=>{var c,l;throw(c=a.body)!=null&&c.message&&this.logger.error(a.body.message),new Error(`Unable to retrieve state. ${a.status}: ${(l=a.body)==null?void 0:l.message}`)});return await r.syncState(this._contractTxId,i.sortKey,i.state,i.validity),this}async evolve(t,e){return await this.writeInteraction({function:"evolve",value:t},e)}get rootSortKey(){return this._rootSortKey}getRootEoEvaluator(){return this.getRoot()._eoEvaluator}isRoot(){return this._parentContract==null}async getStorageValues(t){let e=await this.warp.stateEvaluator.getCache().getLast(this.txId());if(e==null)return new Pt(null,new Map);let r=this.warp.kvStorageFactory(this.txId()),i=new Map;try{await r.open();for(let a of t){let c=await r.getLessOrEqual(a,e.sortKey);i.set(a,c==null?null:c.cachedValue)}return new Pt(e.sortKey,i)}finally{await r.close()}}interactionState(){return this.getRoot()._interactionState}getRoot(){let t=this;for(;!t.isRoot();)t=t.parent();return t}async maybeSyncStateWithRemoteSource(t,e,r){let{stateEvaluator:i}=this.warp;return this.isStateHigherThanAndUpTo(t,r==null?void 0:r.sortKey,e)?await i.syncState(this._contractTxId,t.sortKey,t.cachedValue.state,t.cachedValue.validity):r}isStateHigherThanAndUpTo(t,e,r){return t&&(!r||r>=t.sortKey)&&(!e||t.sortKey>e)}setDREState(t,e){let r=new Pt(e.sortKey,new Rt(e.state,{},e.errorMessages));return this.getRoot()._dreStates.set(t,r),r}getDreState(t){return this.getRoot()._dreStates.get(t)}hasDreState(t){return this.getRoot()._dreStates.has(t)}async discoverInternalWrites(t,e,r,i,a){let c=await this.callContract(t,"write",void 0,void 0,e,r,i,a,!1);if(i&&c.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(c.error||c.errorMessage));let l=this.getCallStack(),n=this._innerWritesEvaluator.eval(l);this.logger.debug("Input",t),this.logger.debug("Callstack",l.print()),n.forEach(p=>{e.push(new $t(_t.INTERACT_WRITE,p))}),this.logger.debug("Tags with inner calls",e)}clearChildren(){for(let t of this._children)t.clearChildren();this._children=[]}};at();var ss=class extends $n{async currentBalance(t){let e=await this.viewState({function:"balance",target:t});if(e.type!=="ok")throw Error(e.errorMessage);return e.result}async currentState(){return(await super.readState()).cachedValue.state}async transfer(t,e){return await this.writeInteraction({function:"transfer",...t},e)}};at();var ls=class{constructor(t){this.arweave=t}async mineBlock(){this.validateEnv(),await this.arweave.api.get("mine")}async addFunds(t){let e=await this.arweave.wallets.getAddress(t);await this.arweave.api.get(`/mint/${e}/1000000000000000`)}async isArlocal(){return(await fetch(`${this.arweave.api.config.protocol}://${this.arweave.api.config.host}:${this.arweave.api.config.port}/info`).then(t=>t.ok?t.json():Promise.reject()).catch(t=>{throw new Error(`Unable to get network info: ${t.message}`)})).network.includes("arlocal")}async validateEnv(){if(!await this.isArlocal())throw new Error("Testing features are not available in a non testing environment")}};at();at();var cs=class{constructor(t,e){this.baseImplementation=t,this.sourceCode=e}async create(t,e,r,i){return Object.prototype.hasOwnProperty.call(this.sourceCode,t.txId)&&(t={...t,src:this.sourceCode[t.txId]}),await this.baseImplementation.create(t,e,r,i)}checkWhiteListContractSources(t,e){return this.baseImplementation.checkWhiteListContractSources(t,e)}},us=class{constructor(t,e,r="custom"){j(this,"_definitionLoader");j(this,"_interactionsLoader");j(this,"_executorFactory");j(this,"_stateEvaluator");this._arweave=t,this._stateCache=e,this._environment=r}setDefinitionLoader(t){return this._definitionLoader=t,this}setInteractionsLoader(t){return this._interactionsLoader=t,this}setExecutorFactory(t){return this._executorFactory=t,this}setStateEvaluator(t){return this._stateEvaluator=t,this}overwriteSource(t){if(this._executorFactory==null)throw new Error("Set base ExecutorFactory first");return this._executorFactory=new cs(this._executorFactory,t),this.build()}useWarpGateway(t,e){this._interactionsLoader=new Cr(new Oa(t.confirmationStatus,t.source));let r=new Ee({...e,dbLocation:`${e.dbLocation}/contracts`}),i=new Ee({...e,dbLocation:`${e.dbLocation}/source`});return this._definitionLoader=new co(this._arweave,r,i,this._environment),this}useArweaveGateway(){return this._definitionLoader=new _n(this._arweave,this._environment),this._interactionsLoader=new Cr(new go(this._arweave,this._environment)),this}build(){let t=new Pn(this._arweave,this._definitionLoader,this._interactionsLoader,this._executorFactory,this._stateEvaluator,this._environment);return this._definitionLoader.warp=t,this._interactionsLoader.warp=t,t}};at();var hs=["^smartweave-extension-"],fs=["evm-signature-verification","subscription","ivm-handler-api","evaluation-progress","fetch-options","deploy","contract-blacklist","vm2","vrf"],Pn=class{constructor(t,e,r,i,a,c="custom"){j(this,"_createContract");j(this,"_gwUrl",gs);j(this,"testing");j(this,"kvStorageFactory");j(this,"whoAmI");j(this,"eventTarget");j(this,"plugins",new Map);this.arweave=t,this.definitionLoader=e,this.interactionsLoader=r,this.executorFactory=i,this.stateEvaluator=a,this.environment=c,this.testing=new ls(t),this.kvStorageFactory=l=>new Ee({inMemory:!1,dbLocation:`${Mn}/kv/ldb/${l}`}),this.eventTarget=new EventTarget}get createContract(){if(!this._createContract)if(this.plugins.has("deploy")){let t=this.loadPlugin("deploy");this._createContract=t.process(this)}else throw new Error("In order to use CreateContract methods please attach DeployPlugin.");return this._createContract}static builder(t,e,r){return new us(t,e,r)}contract(t,e,r){return new $n(t,this,e,r)}async deploy(t,e){return await this.createContract.deploy(t,e)}async deployFromSourceTx(t,e){return await this.createContract.deployFromSourceTx(t,e)}async deployBundled(t){return await this.createContract.deployBundled(t)}async register(t,e){return await this.createContract.register(t,e)}async createSource(t,e,r=!1){return await this.createContract.createSource(t,e,r)}async saveSource(t,e){return await this.createContract.saveSource(t,e)}pst(t){return new ss(t,this)}useStateCache(t){return this.stateEvaluator.setCache(t),this}useContractCache(t,e){return this.definitionLoader.setSrcCache(e),this.definitionLoader.setCache(t),this}use(t){let e=t.type();if(!this.isPluginType(e))throw new Error(`Unknown plugin type ${e}.`);return this.plugins.set(e,t),this}hasPlugin(t){return this.plugins.has(t)}matchPlugins(t){return[...this.plugins.keys()].filter(e=>e.match(t))}loadPlugin(t){if(!this.hasPlugin(t))throw new Error(`Plugin ${t} not registered.`);return this.plugins.get(t)}maybeLoadPlugin(t){return this.hasPlugin(t)?this.plugins.get(t):null}async close(){return Promise.all([this.definitionLoader.getSrcCache().close(),this.definitionLoader.getCache().close(),this.stateEvaluator.getCache().close()]).then()}async generateWallet(){let t=await this.arweave.wallets.generate();return await this.testing.isArlocal()&&await this.testing.addFunds(t),{jwk:t,address:await this.arweave.wallets.jwkToAddress(t)}}isPluginType(t){return fs.includes(t)||hs.some(e=>t.match(e))}useKVStorageFactory(t){return this.kvStorageFactory=t,this}useGwUrl(t){return this._gwUrl=t,this}gwUrl(){return this._gwUrl}},Fe={confirmationStatus:{notCorrupted:!0},source:"both"},gs="https://gw.warp.cc",Mn="./cache/warp",ue={inMemory:!1,dbLocation:Mn},Bs=class{static forLocal(t=1984,e=Ke.default.init({host:"localhost",port:t,protocol:"http"}),r={...ue,inMemory:!0}){return this.customArweaveGw(e,r,"local")}static forTestnet(t=ue,e=!1,r=Ke.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"testnet"):this.customWarpGw(r,Fe,t,"testnet")}static forMainnet(t=ue,e=!1,r=Ke.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"mainnet"):this.customWarpGw(r,Fe,t,"mainnet")}static custom(t,e,r){let i=new Ee({...e,dbLocation:`${e.dbLocation}/state`}),a=new ba(t),c=new wo(t,i,[new Se]);return Pn.builder(t,i,r).setExecutorFactory(a).setStateEvaluator(c)}static customArweaveGw(t,e=ue,r){return this.custom(t,e,r).useArweaveGateway().build()}static customWarpGw(t,e=Fe,r=ue,i){return this.custom(t,r,i).useWarpGateway(e,r).build()}};at();function Ns(t){let e=/(const|var) ret = makeMutClosure\(arg0, arg1, (\d+?), __wbg_adapter/;return t.match(e)[2]}at();var ds=Lt(er());function Nt(t,e,r=void 0){let i=t.find(({name:a})=>a===e);return i?i.value:r}var ps=class{constructor(t){j(this,"arweaveWrapper");j(this,"arweaveTransactions");j(this,"logger",xt.INST.create(ps.name));this.env=t}async load(t,e){let r=It.measure(),i=await this.fetchContractTx(t);this.logger.debug("Contract tx fetch time",r.elapsed());let a=i.owner.address,c=e||Nt(i.tags,At.CONTRACT_SRC_TX_ID),l=Nt(i.tags,_t.WARP_TESTNET)||null;if(l&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!l&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let n=Nt(i.tags,At.MIN_FEE),p=Nt(i.tags,_t.MANIFEST)?JSON.parse(Nt(i.tags,_t.MANIFEST)):null;this.logger.debug("Tags decoding",r.elapsed());let S=await this.evalInitialState(i);this.logger.debug("init state",S);let E=JSON.parse(S);this.logger.debug("Parsing src and init state",r.elapsed());let{src:L,srcBinary:y,srcWasmLang:k,contractType:b,metadata:U,srcTx:C}=await this.loadContractSource(c),K={txId:t,srcTxId:c,src:L,srcBinary:y,srcWasmLang:k,initState:E,minFee:n,owner:a,contractType:b,metadata:U,manifest:p,contractTx:await this.convertToWarpCompatibleContractTx(i),srcTx:await this.convertToWarpCompatibleContractTx(C),testnet:l};return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),K}async fetchContractTx(t){return await this.arweaveTransactions.transaction(t)??await this.arweaveTransactions.transactionUsingUploaderTag(t)}async convertToWarpCompatibleContractTx(t){return{tags:t.tags.map(({name:e,value:r})=>({name:Ct.Buffer.from(e).toString("base64url"),value:Ct.Buffer.from(r).toString("base64url")})),owner:t.owner.key,target:t.recipient,signature:t.signature,data:(await this.arweaveWrapper.txData(t.id)).toString("base64url")}}async loadContractSource(t){let e=It.measure(),r=await this.fetchContractTx(t),i=Nt(r.tags,At.CONTENT_TYPE);if(!hn.includes(i))throw new Error(`Contract source content type ${i} not supported`);let a=i==="application/javascript"?"js":"wasm",c=await this.contractSource(r,a),l,n,p;if(a=="wasm"){if(n=new sr(c),l=Nt(r.tags,_t.WASM_LANG),!l)throw new Error(`Wasm lang not set for wasm contract src ${r.id}`);p=JSON.parse(Nt(r.tags,_t.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:a=="js"?c:null,srcBinary:a=="wasm"?n.wasmBinary():null,srcWasmLang:l,contractType:a,metadata:p,srcTx:r}}async contractSource(t,e){if(Nt(t.tags,_t.UPLOADER_TX_ID)!=null){let r=await this.arweaveWrapper.txDataString(t.id);if(e==="wasm")throw new Error("WASM contracts in legacy format are not supported using AR GW");return ds.default.utils.b64UrlToString(JSON.parse(r).data)}return e==="js"?await this.arweaveWrapper.txDataString(t.id):await this.arweaveWrapper.txData(t.id)}async evalInitialState(t){if(Nt(t.tags,_t.INIT_STATE))return Nt(t.tags,_t.INIT_STATE);if(Nt(t.tags,_t.INIT_STATE_TX)){let e=Nt(t.tags,_t.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}setCache(){throw new Error("Method not implemented.")}setSrcCache(){throw new Error("Method not implemented.")}getCache(){throw new Error("Method not implemented.")}getSrcCache(){throw new Error("Method not implemented.")}type(){return"arweave"}set warp(t){this.arweaveWrapper=new le(t),this.arweaveTransactions=new Ie(t)}};at();var Br=100,ws=100,Nr=1057409,Rr=class{constructor(t,e){j(this,"logger",xt.INST.create(Rr.name));j(this,"arweaveFetcher");j(this,"arweaveWrapper");j(this,"_warp");j(this,"sorter");j(this,"tagsParser",new ee);this.arweave=t,this.environment=e,this.sorter=new ar(t)}async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let a=this.sorter.extractBlockHeight(e)||0,c=this.sorter.extractBlockHeight(r)||await this.currentBlockHeight(),l={tags:[{name:At.APP_NAME,values:["SmartWeaveAction"]},{name:At.CONTRACT_TX_ID,values:[t]},{name:_t.SEQUENCER,values:["RedStone"]}],blockFilter:{min:a,max:c+ws},first:Br},n=It.measure(),p=await this.arweaveFetcher.transactions(l);i.internalWrites&&(p=await this.appendInternalWriteInteractions(t,a,c,p)),n.stop(),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:p.length,time:n.elapsed()}),p.forEach(y=>{var k,b,U;y.node.sortKey=y.node.sortKey??((U=(b=(k=y.node)==null?void 0:k.tags)==null?void 0:b.find(C=>C.name===_t.SEQUENCER_SORT_KEY))==null?void 0:U.value)});let S=await this.sorter.sort(p),E=this.environment==="local"||this.environment==="testnet",L=this._warp.maybeLoadPlugin("vrf");return S.filter(y=>this.isNewerThenSortKeyBlockHeight(y)).filter(y=>this.isSortKeyInBounds(e,r,y)).map(y=>this.attachSequencerDataToInteraction(y)).map(y=>this.maybeAddMockVrf(E,y,L)).map((y,k,b)=>this.verifySortKeyIntegrity(y,k,b)).map(({node:y})=>y)}verifySortKeyIntegrity(t,e,r){var i;if(e!==0){let a=r[e-1],c=r[e];if(this.logger.debug(`prev: ${a.node.id} | current: ${c.node.id}`),c.node.block.height<=Nr||((i=c.node.lastSortKey)==null?void 0:i.split(",")[1])===ln)return t;a.node.source==="redstone-sequencer"&&a.node.sortKey!==c.node.lastSortKey&&this.logger.warn(`Interaction loading error: interaction ${c.node.id} lastSortKey is not pointing on prev interaction ${a.node.id}`)}return t}isSortKeyInBounds(t,e,r){return t&&e?r.node.sortKey.localeCompare(t)>0&&r.node.sortKey.localeCompare(e)<=0:t&&!e?r.node.sortKey.localeCompare(t)>0:!t&&e?r.node.sortKey.localeCompare(e)<=0:!0}attachSequencerDataToInteraction(t){let e=E=>{var L;return(L=t.node.tags.find(y=>y.name===E))==null?void 0:L.value},r=e(_t.SEQUENCER_TX_ID),i=e(_t.SEQUENCER_OWNER),a=e(_t.SEQUENCER_BLOCK_ID),c=e(_t.SEQUENCER_BLOCK_HEIGHT),l=e(_t.SEQUENCER_PREV_SORT_KEY)||e(_t.SEQUENCER_LAST_SORT_KEY),n=e(_t.SEQUENCER_SORT_KEY),p=e(_t.SEQUENCER_BLOCK_TIMESTAMP),S=Re(c);if(!i||!a||!c||!l&&S>Nr||!r||!n)throw Error(`Interaction ${t.node.id} is not sequenced by sequencer aborting. Only Sequenced transactions are supported by loader ${Rr.name}`);return{...t,node:{...t.node,owner:{address:i,key:null},block:{...t.node.block,height:Re(c),id:a,timestamp:p?Re(p):t.node.block.timestamp},sortKey:n,lastSortKey:l,id:r,source:"redstone-sequencer"}}}async appendInternalWriteInteractions(t,e,r,i){let a={tags:[{name:_t.INTERACT_WRITE,values:[t]}],blockFilter:{min:e,max:r},first:Br},c=await this.arweaveFetcher.transactions(a);return this.logger.debug("Inner writes interactions length:",c.length),i=i.concat(c),i}maybeAddMockVrf(t,e,r){return t&&this.tagsParser.hasVrfTag(e.node)&&(r?e.node.vrf=r.process().generateMockVrf(e.node.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e}isNewerThenSortKeyBlockHeight(t){if(t.node.sortKey){let e=t.node.sortKey.split(",")[0],r=Number.parseInt(e);return Number(t.node.block.height)-r>=0}return!0}async currentBlockHeight(){return(await this.arweaveWrapper.info()).height}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveWrapper=new le(t),this.arweaveFetcher=new Ie(t),this._warp=t}};/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

warp-arbundles/build/web/esm/bundle.js:
  (*! Bundled license information:
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  buffer/index.js:
    (*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     *)
  *)
*/export{an as AbstractContractHandler,ps as ArweaveGatewayBundledContractDefinitionLoader,Rr as ArweaveGatewayBundledInteractionLoader,go as ArweaveGatewayInteractionsLoader,le as ArweaveWrapper,It as Benchmark,Wt as CacheKey,Cr as CacheableInteractionsLoader,wo as CacheableStateEvaluator,Oi as ConsoleLogger,Li as ConsoleLoggerFactory,Ra as ContractCache,De as ContractCallRecord,_n as ContractDefinitionLoader,Gt as ContractError,Is as ContractMetadata,Ba as CustomEvent,Mn as DEFAULT_LEVEL_DB_LOCATION,La as DefaultEvaluationOptions,po as DefaultStateEvaluator,Rt as EvalStateResult,Xo as EvaluationOptionsEvaluator,$n as HandlerBasedContract,ba as HandlerExecutorFactory,ko as InnerWritesEvaluator,En as InteractionCall,Cs as InteractionCompleteEvent,mo as InteractionInput,Os as InteractionOutput,ka as JsHandlerApi,pa as KV,xa as KnownErrors,Ee as LevelDbCache,ar as LexicographicalInteractionsSorter,Ii as LogLevelOrder,xt as LoggerFactory,ms as MemCache,fe as NetworkCommunicationError,sn as NonWhitelistedSourceError,ss as PstContractImpl,Ls as REGISTER_PROVIDER,At as SMART_WEAVE_TAGS,hn as SUPPORTED_SRC_CONTENT_TYPES,rn as SWBlock,en as SWTransaction,nn as SWVrf,Qo as Signature,vo as SmartWeaveError,bo as SmartWeaveErrorType,da as SmartWeaveGlobal,Pt as SortKeyCacheResult,Ia as SourceType,Na as SrcCache,$t as Tag,ee as TagsParser,gn as Transaction,gs as WARP_GW_URL,_t as WARP_TAGS,Pn as Warp,us as WarpBuilder,Bs as WarpFactory,Zo as WarpFetchWrapper,co as WarpGatewayContractDefinitionLoader,Oa as WarpGatewayInteractionsLoader,ya as WasmHandlerApi,sr as WasmSrc,Ea as arrayToHex,Ts as asc,Ss as ascS,As as bufToBn,Ar as bundledTxsFilter,bs as checkJsSrc,xo as createDummyTx,xn as createInteractionTagsList,Ir as createInteractionTx,Te as deepCopy,ln as defaultArweaveMs,ue as defaultCacheOptions,Fe as defaultWarpGwOptions,xs as desc,ks as descS,ne as emptyTransfer,Ge as genesisSortKey,Zt as getJsonResponse,zt as indent,or as isBrowser,fs as knownWarpPlugins,hs as knownWarpPluginsPartial,vs as lastPossibleSortKey,dr as lvlToOrder,_s as mapReplacer,Es as mapReviver,Ns as matchMutClosureDtor,on as normalizeContractSource,wa as rustWasmImports,Ca as safeGet,Re as safeParseInt,un as sleep,Sa as sortingFirst,cn as sortingLast,we as stripTrailingSlash,Aa as timeout};
